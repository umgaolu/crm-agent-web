"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/templates/[id]/preview";
exports.ids = ["pages/api/templates/[id]/preview"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "xlsx":
/*!***********************!*\
  !*** external "xlsx" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("xlsx");

/***/ }),

/***/ "fs/promises":
/*!******************************!*\
  !*** external "fs/promises" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("fs/promises");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D%2Fpreview&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D%5Cpreview.ts&middlewareConfigBase64=e30%3D!":
/*!******************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D%2Fpreview&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D%5Cpreview.ts&middlewareConfigBase64=e30%3D! ***!
  \******************************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\templates\\[id]\\preview.ts */ \"(api)/./pages/api/templates/[id]/preview.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/templates/[id]/preview\",\n        pathname: \"/api/templates/[id]/preview\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_templates_id_preview_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnRlbXBsYXRlcyUyRiU1QmlkJTVEJTJGcHJldmlldyZwcmVmZXJyZWRSZWdpb249JmFic29sdXRlUGFnZVBhdGg9LiUyRnBhZ2VzJTVDYXBpJTVDdGVtcGxhdGVzJTVDJTVCaWQlNUQlNUNwcmV2aWV3LnRzJm1pZGRsZXdhcmVDb25maWdCYXNlNjQ9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNMO0FBQzFEO0FBQ3NFO0FBQ3RFO0FBQ0EsaUVBQWUsd0VBQUssQ0FBQywrREFBUSxZQUFZLEVBQUM7QUFDMUM7QUFDTyxlQUFlLHdFQUFLLENBQUMsK0RBQVE7QUFDcEM7QUFDTyx3QkFBd0IsZ0hBQW1CO0FBQ2xEO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLFlBQVk7QUFDWixDQUFDOztBQUVELHFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY3JtLWFnZW50LXdlYi8/ODczNSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvcGFnZXMtYXBpL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IGhvaXN0IH0gZnJvbSBcIm5leHQvZGlzdC9idWlsZC90ZW1wbGF0ZXMvaGVscGVyc1wiO1xuLy8gSW1wb3J0IHRoZSB1c2VybGFuZCBjb2RlLlxuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi4vcGFnZXNcXFxcYXBpXFxcXHRlbXBsYXRlc1xcXFxbaWRdXFxcXHByZXZpZXcudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS90ZW1wbGF0ZXMvW2lkXS9wcmV2aWV3XCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdGVtcGxhdGVzL1tpZF0vcHJldmlld1wiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcIlwiXG4gICAgfSxcbiAgICB1c2VybGFuZFxufSk7XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPXBhZ2VzLWFwaS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D%2Fpreview&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D%5Cpreview.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/templates/[id]/preview.ts":
/*!*********************************************!*\
  !*** ./pages/api/templates/[id]/preview.ts ***!
  \*********************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs/promises */ \"fs/promises\");\n/* harmony import */ var fs_promises__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs_promises__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! xlsx */ \"xlsx\");\n/* harmony import */ var xlsx__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(xlsx__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\nfunction readEnv(value) {\n    const raw = value !== null && value !== undefined ? String(value).trim() : \"\";\n    if (!raw) {\n        return \"\";\n    }\n    return raw.replace(/^['\"`]/, \"\").replace(/['\"`]$/, \"\").trim();\n}\nconst supabaseUrl = readEnv(\"https://vvrokpefmojngpoxvsan.supabase.co\");\nconst supabaseKey = readEnv(\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cm9rcGVmbW9qbmdwb3h2c2FuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzUzNTIsImV4cCI6MjA4MzQxMTM1Mn0.t-tHn0A7uzizGEytzeaNvz-i5BGL9sqq-yGOvGE2crQ\" || 0);\nconst supabaseServiceKey = readEnv(process.env.SUPABASE_SERVICE_KEY);\nconst adminSupabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey || supabaseKey || \"\");\nconst agentApiUrl = readEnv(process.env.CRM_V3_AGENT_API_URL);\nconst agentApiKey = readEnv(process.env.CRM_V3_AGENT_API_KEY);\nconst uploadedFileCache = new Map();\nconst uploadingFilePromises = new Map();\nfunction toStringSafe(value) {\n    if (value === null || value === undefined) {\n        return \"\";\n    }\n    return String(value);\n}\nasync function fetchTemplateMetaById(templateId) {\n    const selectColumnsCandidates = [\n        \"id,temp_id,template_id,temp_name,name,report_title,reportTitle\",\n        \"id,temp_id,template_id,temp_name,name,report_title\",\n        \"id,temp_id,template_id,temp_name,name\"\n    ];\n    const idFields = [\n        \"id\",\n        \"temp_id\",\n        \"template_id\"\n    ];\n    let lastError = null;\n    for (const selectColumns of selectColumnsCandidates){\n        for (const idField of idFields){\n            const { data, error } = await adminSupabase.from(\"document_templates\").select(selectColumns).eq(idField, templateId).maybeSingle();\n            if (!error) {\n                return data ? data : null;\n            }\n            lastError = error;\n            if (!/column .* does not exist/i.test(error.message || \"\")) {\n                break;\n            }\n        }\n    }\n    if (lastError) {\n        throw new Error(lastError.message || \"查询模板信息失败\");\n    }\n    return null;\n}\nfunction normalizeTargetFile(raw, templateId) {\n    let value = (raw || \"\").trim();\n    if (!value) {\n        value = `template-${templateId.slice(0, 12)}.html`;\n    }\n    value = value.replace(/[\\\\/]/g, \"-\");\n    if (!/\\.[a-z0-9]+$/i.test(value)) {\n        value = `${value}.html`;\n    }\n    if (!value.toLowerCase().endsWith(\".html\")) {\n        value = `${value}.html`;\n    }\n    if (value.length > 48) {\n        const ext = \".html\";\n        const baseMax = Math.max(1, 48 - ext.length);\n        value = `${value.slice(0, baseMax)}${ext}`;\n    }\n    return value;\n}\nfunction escapeHtml(text) {\n    return text.replace(/&/g, \"&amp;\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\").replace(/\"/g, \"&quot;\").replace(/'/g, \"&#39;\");\n}\nfunction stripThinkTags(text) {\n    let value = (text || \"\").replace(/\\r\\n/g, \"\\n\");\n    value = value.replace(/<think>[\\s\\S]*?<\\/think>/gi, \"\");\n    value = value.replace(/<\\/?think>/gi, \"\");\n    value = value.replace(/<analysis>[\\s\\S]*?<\\/analysis>/gi, \"\");\n    value = value.replace(/<\\/?analysis>/gi, \"\");\n    return value.trim();\n}\nfunction inlineMarkdownToHtml(escapedText) {\n    let value = escapedText;\n    value = value.replace(/!\\[([^\\]]*?)\\]\\(([^)]+?)\\)/g, (_m, altRaw, urlRaw)=>{\n        const alt = (altRaw || \"\").trim();\n        let url = (urlRaw || \"\").trim();\n        if (url.startsWith(\"<\") && url.endsWith(\">\")) {\n            url = url.slice(1, -1).trim();\n        }\n        const urlFirst = url.split(/\\s+/)[0] || \"\";\n        if (!urlFirst) {\n            return alt ? `<span>${alt}</span>` : \"\";\n        }\n        return `<img src=\"${urlFirst}\" alt=\"${alt}\" />`;\n    });\n    value = value.replace(/\\[([^\\]]+?)\\]\\(([^)]+?)\\)/g, (_m, textRaw, urlRaw)=>{\n        const text = (textRaw || \"\").trim();\n        let url = (urlRaw || \"\").trim();\n        if (url.startsWith(\"<\") && url.endsWith(\">\")) {\n            url = url.slice(1, -1).trim();\n        }\n        const urlFirst = url.split(/\\s+/)[0] || \"\";\n        if (!urlFirst) {\n            return text;\n        }\n        return `<a href=\"${urlFirst}\" target=\"_blank\" rel=\"noopener noreferrer\">${text}</a>`;\n    });\n    value = value.replace(/(^|[\\s(])((https?:\\/\\/)[^\\s)]+)(?=$|[\\s)])/g, (_m, prefix, url)=>`${prefix}<a href=\"${url}\" target=\"_blank\" rel=\"noopener noreferrer\">${url}</a>`);\n    value = value.replace(/`([^`]+?)`/g, \"<code>$1</code>\");\n    value = value.replace(/\\*\\*([^*]+?)\\*\\*/g, \"<strong>$1</strong>\");\n    value = value.replace(/__([^_]+?)__/g, \"<strong>$1</strong>\");\n    return value;\n}\nfunction markdownToHtml(markdown) {\n    const lines = (markdown || \"\").replace(/\\r\\n/g, \"\\n\").split(\"\\n\");\n    const html = [];\n    let inCode = false;\n    let codeLines = [];\n    let listType = null;\n    let inBlockquote = false;\n    const closeList = ()=>{\n        if (listType) {\n            html.push(listType === \"ul\" ? \"</ul>\" : \"</ol>\");\n            listType = null;\n        }\n    };\n    const closeBlockquote = ()=>{\n        if (inBlockquote) {\n            html.push(\"</blockquote>\");\n            inBlockquote = false;\n        }\n    };\n    const flushCode = ()=>{\n        if (!inCode) {\n            return;\n        }\n        const code = escapeHtml(codeLines.join(\"\\n\"));\n        html.push(`<pre><code>${code}</code></pre>`);\n        codeLines = [];\n        inCode = false;\n    };\n    const isTableSeparatorLine = (line)=>{\n        const trimmed = (line || \"\").trim();\n        if (!trimmed) {\n            return false;\n        }\n        if (!trimmed.includes(\"|\")) {\n            return false;\n        }\n        const withoutOuter = trimmed.replace(/^\\|/, \"\").replace(/\\|$/, \"\");\n        const cells = withoutOuter.split(\"|\").map((part)=>part.trim());\n        if (cells.length < 2) {\n            return false;\n        }\n        return cells.every((cell)=>/^:?-{3,}:?$/.test(cell));\n    };\n    const splitTableRow = (line)=>{\n        const trimmed = (line || \"\").trim();\n        const withoutOuter = trimmed.replace(/^\\|/, \"\").replace(/\\|$/, \"\");\n        return withoutOuter.split(\"|\").map((part)=>part.trim());\n    };\n    const getTableAlignments = (separatorLine)=>{\n        const cells = splitTableRow(separatorLine);\n        return cells.map((cell)=>{\n            const left = cell.startsWith(\":\");\n            const right = cell.endsWith(\":\");\n            if (left && right) {\n                return \"center\";\n            }\n            if (right) {\n                return \"right\";\n            }\n            if (left) {\n                return \"left\";\n            }\n            return \"\";\n        });\n    };\n    for(let i = 0; i < lines.length; i += 1){\n        const line = lines[i] ?? \"\";\n        if (inCode) {\n            if (/^\\s*```/.test(line)) {\n                flushCode();\n                continue;\n            }\n            codeLines.push(line);\n            continue;\n        }\n        if (/^\\s*```/.test(line)) {\n            closeList();\n            closeBlockquote();\n            inCode = true;\n            codeLines = [];\n            continue;\n        }\n        if (/^\\s*$/.test(line)) {\n            closeList();\n            closeBlockquote();\n            continue;\n        }\n        const nextLine = i + 1 < lines.length ? String(lines[i + 1] ?? \"\") : \"\";\n        const canStartTable = line.trim().includes(\"|\") && isTableSeparatorLine(nextLine) && !/^\\s*>/.test(line);\n        if (canStartTable) {\n            closeList();\n            closeBlockquote();\n            const headerCells = splitTableRow(line);\n            const alignments = getTableAlignments(nextLine);\n            const rows = [];\n            i += 2;\n            while(i < lines.length){\n                const rowLine = String(lines[i] ?? \"\");\n                if (!rowLine.trim()) {\n                    break;\n                }\n                if (!rowLine.includes(\"|\")) {\n                    break;\n                }\n                rows.push(splitTableRow(rowLine));\n                i += 1;\n            }\n            i -= 1;\n            const width = Math.max(headerCells.length, alignments.length, rows.reduce((max, row)=>Math.max(max, row.length), 0));\n            while(headerCells.length < width){\n                headerCells.push(\"\");\n            }\n            while(alignments.length < width){\n                alignments.push(\"\");\n            }\n            for (const row of rows){\n                while(row.length < width){\n                    row.push(\"\");\n                }\n            }\n            html.push(\"<table><thead><tr>\");\n            for(let c = 0; c < width; c += 1){\n                const content = inlineMarkdownToHtml(escapeHtml(headerCells[c] || \"\"));\n                const align = alignments[c] ? ` style=\"text-align:${alignments[c]}\"` : \"\";\n                html.push(`<th${align}>${content}</th>`);\n            }\n            html.push(\"</tr></thead><tbody>\");\n            for (const row of rows){\n                html.push(\"<tr>\");\n                for(let c = 0; c < width; c += 1){\n                    const content = inlineMarkdownToHtml(escapeHtml(row[c] || \"\"));\n                    const align = alignments[c] ? ` style=\"text-align:${alignments[c]}\"` : \"\";\n                    html.push(`<td${align}>${content}</td>`);\n                }\n                html.push(\"</tr>\");\n            }\n            html.push(\"</tbody></table>\");\n            continue;\n        }\n        const headingMatch = line.match(/^(#{1,6})\\s+(.*)$/);\n        if (headingMatch) {\n            closeList();\n            closeBlockquote();\n            const level = headingMatch[1].length;\n            const content = inlineMarkdownToHtml(escapeHtml(headingMatch[2] || \"\"));\n            html.push(`<h${level}>${content}</h${level}>`);\n            continue;\n        }\n        if (/^(\\*\\s*\\*\\s*\\*|-{3,}|_{3,})\\s*$/.test(line.trim())) {\n            closeList();\n            closeBlockquote();\n            html.push(\"<hr />\");\n            continue;\n        }\n        const blockquoteMatch = line.match(/^\\s*>\\s?(.*)$/);\n        if (blockquoteMatch) {\n            closeList();\n            if (!inBlockquote) {\n                html.push(\"<blockquote>\");\n                inBlockquote = true;\n            }\n            const content = inlineMarkdownToHtml(escapeHtml(blockquoteMatch[1] || \"\"));\n            html.push(`<p>${content}</p>`);\n            continue;\n        }\n        const olMatch = line.match(/^\\s*\\d+\\.\\s+(.*)$/);\n        if (olMatch) {\n            closeBlockquote();\n            if (listType !== \"ol\") {\n                closeList();\n                html.push(\"<ol>\");\n                listType = \"ol\";\n            }\n            const content = inlineMarkdownToHtml(escapeHtml(olMatch[1] || \"\"));\n            html.push(`<li>${content}</li>`);\n            continue;\n        }\n        const ulMatch = line.match(/^\\s*[-*+]\\s+(.*)$/);\n        if (ulMatch) {\n            closeBlockquote();\n            if (listType !== \"ul\") {\n                closeList();\n                html.push(\"<ul>\");\n                listType = \"ul\";\n            }\n            const content = inlineMarkdownToHtml(escapeHtml(ulMatch[1] || \"\"));\n            html.push(`<li>${content}</li>`);\n            continue;\n        }\n        closeList();\n        closeBlockquote();\n        const content = inlineMarkdownToHtml(escapeHtml(line));\n        html.push(`<p>${content}</p>`);\n    }\n    flushCode();\n    closeList();\n    closeBlockquote();\n    return html.join(\"\\n\");\n}\nfunction wrapAsMarkdownDocument(markdown) {\n    const bodyHtml = markdownToHtml(markdown);\n    return `<!doctype html><html><head><meta charset=\"utf-8\" /><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" /><title>Template Preview</title><style>body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\";padding:16px;line-height:1.7;color:#111827;background:#fff;}h1,h2,h3,h4,h5,h6{margin:16px 0 10px;line-height:1.25;}p{margin:10px 0;}ul,ol{margin:10px 0 10px 24px;}li{margin:6px 0;}hr{border:none;border-top:1px solid #e5e7eb;margin:16px 0;}blockquote{margin:12px 0;padding:8px 12px;border-left:4px solid #e5e7eb;background:#f9fafb;color:#374151;border-radius:6px;}a{color:#2563eb;text-decoration:underline;}img{max-width:100%;height:auto;display:block;border-radius:8px;border:1px solid #e5e7eb;background:#fff;margin:10px 0;}table{width:100%;border-collapse:collapse;margin:12px 0;font-size:14px;}th,td{border:1px solid #e5e7eb;padding:8px 10px;vertical-align:top;}th{background:#f9fafb;font-weight:600;}tbody tr:nth-child(even){background:#fcfcfd;}code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\\\"Liberation Mono\\\",\\\"Courier New\\\",monospace;font-size:.95em;background:#f3f4f6;border-radius:4px;padding:2px 6px;}pre{white-space:pre-wrap;word-break:break-word;background:#0b1220;color:#e5e7eb;border-radius:8px;padding:12px;overflow:auto;}pre code{background:transparent;padding:0;color:inherit;}</style></head><body>${bodyHtml}</body></html>`;\n}\nfunction looksLikeHtml(text) {\n    const trimmed = (text || \"\").trim();\n    if (!trimmed) {\n        return false;\n    }\n    if (trimmed.startsWith(\"<!doctype\") || trimmed.startsWith(\"<html\") || trimmed.startsWith(\"<\")) {\n        return true;\n    }\n    return /<body[\\s>]/i.test(trimmed) || /<\\/[a-z][\\s>]/i.test(trimmed);\n}\nfunction extractAgentOutput(agentData) {\n    const candidates = [\n        agentData?.answer,\n        agentData?.output,\n        agentData?.result,\n        agentData?.data?.answer,\n        agentData?.data?.output,\n        agentData?.data?.result,\n        agentData?.data?.outputs?.text,\n        agentData?.data?.outputs?.output,\n        agentData?.data?.outputs?.result,\n        agentData?.outputs?.text,\n        agentData?.outputs?.output,\n        agentData?.outputs?.result,\n        agentData?.message?.content\n    ];\n    for (const value of candidates){\n        if (typeof value === \"string\" && value.trim()) {\n            return value;\n        }\n    }\n    return \"\";\n}\nfunction isExcelAttachment(params) {\n    const name = (params.fileName || \"\").toLowerCase();\n    const mime = (params.mimeType || \"\").toLowerCase();\n    if (name.endsWith(\".xlsx\") || name.endsWith(\".xls\")) {\n        return true;\n    }\n    if (mime.includes(\"spreadsheet\") || mime.includes(\"excel\")) {\n        return true;\n    }\n    return false;\n}\nfunction sanitizeSheetName(name) {\n    const value = (name || \"\").trim();\n    if (!value) {\n        return \"Sheet\";\n    }\n    return value.length > 80 ? value.slice(0, 80) : value;\n}\nfunction extractExcelMarkdownFromBuffer(buffer, fileName) {\n    const workbook = xlsx__WEBPACK_IMPORTED_MODULE_2__.read(buffer, {\n        type: \"buffer\",\n        cellDates: true,\n        cellText: false\n    });\n    const sheetNames = Array.isArray(workbook.SheetNames) ? workbook.SheetNames : [];\n    const outputs = [];\n    const maxRowsPerSheet = 200;\n    for (const name of sheetNames){\n        const sheet = workbook.Sheets ? workbook.Sheets[name] : null;\n        if (!sheet) {\n            continue;\n        }\n        const matrix = xlsx__WEBPACK_IMPORTED_MODULE_2__.utils.sheet_to_json(sheet, {\n            header: 1,\n            raw: true,\n            blankrows: false,\n            defval: \"\"\n        });\n        const sliced = Array.isArray(matrix) ? matrix.slice(0, maxRowsPerSheet) : [];\n        if (!sliced.length) {\n            continue;\n        }\n        outputs.push(`### ${sanitizeSheetName(name)}\\n\\n\\`\\`\\`json\\n${JSON.stringify(sliced)}\\n\\`\\`\\``);\n    }\n    if (!outputs.length) {\n        return \"\";\n    }\n    return `## 附件Excel解析结果：${fileName}\\n\\n${outputs.join(\"\\n\\n\")}`;\n}\nasync function fetchWithTimeout(url, init, timeoutMs) {\n    const controller = new AbortController();\n    const timer = setTimeout(()=>controller.abort(), timeoutMs);\n    try {\n        return await fetch(url, {\n            ...init,\n            signal: controller.signal\n        });\n    } finally{\n        clearTimeout(timer);\n    }\n}\nfunction sleep(ms) {\n    return new Promise((resolve)=>setTimeout(resolve, ms));\n}\nfunction getFetchCauseInfo(error) {\n    const cause = error && typeof error === \"object\" ? error.cause : null;\n    const code = cause && typeof cause.code === \"string\" ? cause.code : \"\";\n    const message = cause && typeof cause.message === \"string\" ? cause.message : \"\";\n    return {\n        code,\n        message\n    };\n}\nfunction formatFetchError(error) {\n    const name = error && typeof error.name === \"string\" ? error.name : \"\";\n    const message = error && typeof error.message === \"string\" ? error.message : \"\";\n    const { code, message: causeMessage } = getFetchCauseInfo(error);\n    const parts = [\n        message || name || \"请求失败\"\n    ];\n    if (code) {\n        parts.push(`code=${code}`);\n    }\n    if (causeMessage && causeMessage !== message) {\n        parts.push(causeMessage);\n    }\n    return parts.join(\" | \");\n}\nfunction isRetryableFetchError(error) {\n    const message = error && typeof error.message === \"string\" ? error.message : \"\";\n    const lower = message.toLowerCase();\n    const { code } = getFetchCauseInfo(error);\n    if (lower.includes(\"fetch failed\")) {\n        return true;\n    }\n    if (lower.includes(\"socket hang up\")) {\n        return true;\n    }\n    if (lower.includes(\"the operation was aborted\")) {\n        return true;\n    }\n    const retryableCodes = new Set([\n        \"ECONNRESET\",\n        \"ECONNREFUSED\",\n        \"ETIMEDOUT\",\n        \"EAI_AGAIN\",\n        \"ENOTFOUND\",\n        \"EHOSTUNREACH\",\n        \"ENETUNREACH\"\n    ]);\n    if (code && retryableCodes.has(code)) {\n        return true;\n    }\n    return false;\n}\nasync function fetchWithTimeoutRetry(url, init, timeoutMs, retries) {\n    let lastError = null;\n    for(let attempt = 0; attempt <= retries; attempt += 1){\n        try {\n            return await fetchWithTimeout(url, init, timeoutMs);\n        } catch (e) {\n            lastError = e;\n            if (attempt >= retries || !isRetryableFetchError(e)) {\n                throw new Error(formatFetchError(e));\n            }\n            const delay = 500 * Math.pow(2, attempt);\n            await sleep(delay);\n        }\n    }\n    throw new Error(formatFetchError(lastError));\n}\nasync function mapWithConcurrency(items, limit, fn) {\n    const results = [];\n    let cursor = 0;\n    const worker = async ()=>{\n        while(cursor < items.length){\n            const current = items[cursor];\n            cursor += 1;\n            results.push(await fn(current));\n        }\n    };\n    const count = Math.max(1, Math.min(limit, items.length));\n    await Promise.all(Array.from({\n        length: count\n    }, ()=>worker()));\n    return results;\n}\nasync function callAgentStreaming(params) {\n    const retries = 1;\n    let lastError = null;\n    for(let attempt = 0; attempt <= retries; attempt += 1){\n        const controller = new AbortController();\n        const timeoutMs = 180000;\n        const timer = setTimeout(()=>controller.abort(), timeoutMs);\n        try {\n            const response = await fetch(params.url, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${params.apiKey}`\n                },\n                body: JSON.stringify({\n                    ...params.payload,\n                    response_mode: \"streaming\"\n                }),\n                signal: controller.signal\n            });\n            if (!response.ok) {\n                const rawText = await response.text();\n                let agentData = null;\n                try {\n                    agentData = rawText ? JSON.parse(rawText) : null;\n                } catch  {\n                    agentData = null;\n                }\n                const rawMessage = agentData && (agentData.error || agentData.message) || rawText || \"\";\n                const trimmedMessage = typeof rawMessage === \"string\" ? rawMessage.slice(0, 300) : String(rawMessage).slice(0, 300);\n                throw new Error(trimmedMessage ? `Agent请求失败: ${response.status} ${trimmedMessage}` : `Agent请求失败: ${response.status}`);\n            }\n            if (!response.body) {\n                const rawText = await response.text();\n                const trimmed = (rawText || \"\").trim();\n                if (trimmed.startsWith(\"<\")) {\n                    throw new Error(\"Agent返回非JSON（疑似HTML页面），请检查CRM_V3_AGENT_API_URL是否为/v1/chat-messages接口\");\n                }\n                const chunks = rawText.split(\"\\n\\n\");\n                let output = \"\";\n                for (const chunk of chunks){\n                    const lines = chunk.split(\"\\n\");\n                    for (const line of lines){\n                        const trimmedLine = line.trim();\n                        if (!trimmedLine.startsWith(\"data:\")) {\n                            continue;\n                        }\n                        const dataPart = trimmedLine.slice(5).trim();\n                        if (!dataPart || dataPart === \"[DONE]\") {\n                            continue;\n                        }\n                        let json = null;\n                        try {\n                            json = JSON.parse(dataPart);\n                        } catch  {\n                            json = null;\n                        }\n                        if (!json) {\n                            continue;\n                        }\n                        const piece = extractAgentOutput(json);\n                        if (piece) {\n                            output += piece;\n                        }\n                    }\n                }\n                return output.trim();\n            }\n            const decoder = new TextDecoder(\"utf-8\");\n            const reader = response.body.getReader();\n            let output = \"\";\n            let buffer = \"\";\n            let finished = false;\n            const processBlock = (block)=>{\n                const lines = block.split(\"\\n\");\n                for (const line of lines){\n                    const trimmedLine = line.trim();\n                    if (!trimmedLine.startsWith(\"data:\")) {\n                        continue;\n                    }\n                    const dataPart = trimmedLine.slice(5).trim();\n                    if (!dataPart || dataPart === \"[DONE]\") {\n                        continue;\n                    }\n                    let json = null;\n                    try {\n                        json = JSON.parse(dataPart);\n                    } catch  {\n                        json = null;\n                    }\n                    if (!json) {\n                        continue;\n                    }\n                    const piece = extractAgentOutput(json);\n                    if (piece) {\n                        if (json.event === \"message_end\") {\n                            if (piece.length > output.length) {\n                                output = piece;\n                            }\n                        } else {\n                            output += piece;\n                        }\n                    }\n                    if (json.event === \"message_end\" || json.event === \"workflow_finished\" || json.event === \"conversation_end\") {\n                        finished = true;\n                        return;\n                    }\n                }\n            };\n            while(true){\n                const { value, done } = await reader.read();\n                if (done) {\n                    break;\n                }\n                buffer += decoder.decode(value, {\n                    stream: true\n                });\n                let index = buffer.indexOf(\"\\n\\n\");\n                while(index >= 0){\n                    const block = buffer.slice(0, index);\n                    buffer = buffer.slice(index + 2);\n                    processBlock(block);\n                    if (finished) {\n                        break;\n                    }\n                    index = buffer.indexOf(\"\\n\\n\");\n                }\n                if (finished) {\n                    break;\n                }\n            }\n            if (!finished && buffer.trim()) {\n                processBlock(buffer);\n            }\n            return output.trim();\n        } catch (e) {\n            lastError = e;\n            if (attempt >= retries || !isRetryableFetchError(e)) {\n                throw new Error(formatFetchError(e));\n            }\n            await sleep(600 * (attempt + 1));\n        } finally{\n            clearTimeout(timer);\n        }\n    }\n    throw new Error(formatFetchError(lastError));\n}\nasync function fetchAttachmentsByTemplateId(templateId) {\n    const selectColumnsCandidates = [\n        \"id,file_name,file_path,file_size,mime_type,created_at,created_by,template_id\",\n        \"id,file_name,file_path,file_size,mime_type,created_at,created_by,temp_id\"\n    ];\n    const tryFields = [\n        \"template_id\",\n        \"temp_id\"\n    ];\n    let lastError = null;\n    for (const selectColumns of selectColumnsCandidates){\n        for (const field of tryFields){\n            const { data, error } = await adminSupabase.from(\"document_template_attachments\").select(selectColumns).eq(field, templateId).order(\"created_at\", {\n                ascending: false\n            });\n            if (!error) {\n                return Array.isArray(data) ? data : [];\n            }\n            lastError = error;\n            if (!/column .* does not exist/i.test(error.message || \"\")) {\n                break;\n            }\n        }\n    }\n    if (lastError) {\n        throw new Error(lastError.message || \"查询附件失败\");\n    }\n    return [];\n}\nfunction buildUploadUrl(chatMessagesUrl) {\n    const url = new URL(chatMessagesUrl);\n    const parts = url.pathname.split(\"/\").filter(Boolean);\n    const chatIndex = parts.lastIndexOf(\"chat-messages\");\n    const partsBeforeChat = chatIndex >= 0 ? parts.slice(0, chatIndex) : parts;\n    const v1Index = partsBeforeChat.lastIndexOf(\"v1\");\n    if (v1Index >= 0) {\n        const baseParts = partsBeforeChat.slice(0, v1Index + 1);\n        url.pathname = `/${baseParts.join(\"/\")}/files/upload`;\n        return url.toString();\n    }\n    url.pathname = \"/files/upload\";\n    return url.toString();\n}\nasync function uploadFileToDify(params) {\n    const retries = 1;\n    let lastError = null;\n    for(let attempt = 0; attempt <= retries; attempt += 1){\n        try {\n            const form = new FormData();\n            const blobPart = new Uint8Array(params.buffer);\n            const blob = new Blob([\n                blobPart\n            ], {\n                type: params.mimeType || \"application/octet-stream\"\n            });\n            form.append(\"file\", blob, params.fileName);\n            form.append(\"user\", params.user);\n            const controller = new AbortController();\n            const timer = setTimeout(()=>controller.abort(), 90000);\n            const uploadRes = await fetch(params.uploadUrl, {\n                method: \"POST\",\n                headers: {\n                    Authorization: `Bearer ${params.apiKey}`\n                },\n                body: form,\n                signal: controller.signal\n            }).finally(()=>clearTimeout(timer));\n            const uploadText = await uploadRes.text();\n            let uploadJson = null;\n            try {\n                uploadJson = uploadText ? JSON.parse(uploadText) : null;\n            } catch  {\n                uploadJson = null;\n            }\n            if (!uploadRes.ok) {\n                const rawMessage = uploadJson && (uploadJson.error || uploadJson.message) || uploadText || \"\";\n                const trimmedMessage = typeof rawMessage === \"string\" ? rawMessage.slice(0, 300) : String(rawMessage).slice(0, 300);\n                throw new Error(trimmedMessage ? `附件上传失败: ${uploadRes.status} ${trimmedMessage}` : `附件上传失败: ${uploadRes.status}`);\n            }\n            const uploadFileId = uploadJson && (uploadJson.id || uploadJson.file_id || uploadJson.fileId) || \"\";\n            if (!uploadFileId) {\n                throw new Error(\"附件上传未返回文件ID\");\n            }\n            return String(uploadFileId);\n        } catch (e) {\n            lastError = e;\n            if (attempt >= retries || !isRetryableFetchError(e)) {\n                throw new Error(formatFetchError(e));\n            }\n            await sleep(600 * (attempt + 1));\n        }\n    }\n    throw new Error(formatFetchError(lastError));\n}\nasync function handler(req, res) {\n    const expectedToken = process.env.CRM_API_TOKEN;\n    const headerToken = req.headers[\"x-crm-token\"];\n    const token = Array.isArray(headerToken) ? headerToken[0] : headerToken;\n    if (expectedToken && token !== expectedToken) {\n        res.status(401).json({\n            error: \"Unauthorized\"\n        });\n        return;\n    }\n    if (!supabaseUrl || !supabaseKey) {\n        res.status(500).json({\n            error: \"Supabase配置缺失\"\n        });\n        return;\n    }\n    if (!agentApiUrl) {\n        res.status(500).json({\n            error: \"CRM V3 Agent未配置（缺少CRM_V3_AGENT_API_URL）\"\n        });\n        return;\n    }\n    if (!agentApiKey) {\n        res.status(500).json({\n            error: \"CRM V3 Agent密钥未配置（缺少CRM_V3_AGENT_API_KEY）\"\n        });\n        return;\n    }\n    const { id } = req.query;\n    const templateId = typeof id === \"string\" ? id : \"\";\n    if (!templateId) {\n        res.status(400).json({\n            error: \"缺少模板ID\"\n        });\n        return;\n    }\n    if (req.method !== \"POST\") {\n        res.setHeader(\"Allow\", \"POST\");\n        res.status(405).end(\"Method Not Allowed\");\n        return;\n    }\n    const body = req.body || {};\n    const text = toStringSafe(body.text);\n    const targetFileRaw = toStringSafe(body.targetFile);\n    const targetFile = normalizeTargetFile(targetFileRaw, templateId);\n    let templateName = toStringSafe(body.templateName);\n    let reportTitle = toStringSafe(body.reportTitle);\n    const department = toStringSafe(body.department);\n    const reportDate = toStringSafe(body.reportDate);\n    const classificationRaw = body.classification;\n    const classification = typeof classificationRaw === \"number\" ? classificationRaw : typeof classificationRaw === \"string\" ? Number(classificationRaw) : NaN;\n    const classificationValue = Number.isFinite(classification) ? classification : 6;\n    const attachmentIdsRaw = Array.isArray(body.attachmentIds) ? body.attachmentIds : [];\n    const attachmentIds = attachmentIdsRaw.map((item)=>toStringSafe(item)).filter((value)=>value);\n    try {\n        const attachmentRows = await fetchAttachmentsByTemplateId(templateId);\n        const selectedRows = attachmentIds.length ? attachmentRows.filter((row)=>attachmentIds.includes(String(row.id))) : attachmentRows;\n        const user = `template-${templateId}`;\n        const files = [];\n        const attachmentExtracts = [];\n        if (selectedRows.length) {\n            const uploadUrl = buildUploadUrl(agentApiUrl);\n            const uploaded = await mapWithConcurrency(selectedRows, 3, async (row)=>{\n                const filePath = row && row.file_path ? String(row.file_path) : \"\";\n                const fileName = row && row.file_name ? String(row.file_name) : \"\";\n                if (!filePath || !fileName) {\n                    return null;\n                }\n                let stat = null;\n                try {\n                    stat = await fs_promises__WEBPACK_IMPORTED_MODULE_1___default().stat(filePath);\n                } catch  {\n                    stat = null;\n                }\n                const size = stat && typeof stat.size === \"number\" ? Number(stat.size) : -1;\n                const mtimeMs = stat && typeof stat.mtimeMs === \"number\" ? Number(stat.mtimeMs) : -1;\n                const cacheKey = `${user}::${filePath}::${size}::${mtimeMs}`;\n                const cached = uploadedFileCache.get(cacheKey);\n                if (cached && cached.uploadFileId) {\n                    if (cached.extracted) {\n                        attachmentExtracts.push(cached.extracted);\n                    }\n                    return {\n                        type: \"document\",\n                        transfer_method: \"local_file\",\n                        upload_file_id: cached.uploadFileId\n                    };\n                }\n                const existing = uploadingFilePromises.get(cacheKey);\n                if (existing) {\n                    const { uploadFileId, extracted } = await existing;\n                    if (extracted) {\n                        attachmentExtracts.push(extracted);\n                    }\n                    return {\n                        type: \"document\",\n                        transfer_method: \"local_file\",\n                        upload_file_id: uploadFileId\n                    };\n                }\n                const promise = (async ()=>{\n                    const buffer = await fs_promises__WEBPACK_IMPORTED_MODULE_1___default().readFile(filePath);\n                    const mimeType = row && row.mime_type ? String(row.mime_type) : \"application/octet-stream\";\n                    let extracted = \"\";\n                    if (isExcelAttachment({\n                        fileName,\n                        mimeType\n                    })) {\n                        try {\n                            extracted = extractExcelMarkdownFromBuffer(buffer, fileName);\n                            extracted = extracted ? String(extracted).trim() : \"\";\n                        } catch  {\n                            extracted = \"\";\n                        }\n                    }\n                    const uploadFileId = await uploadFileToDify({\n                        uploadUrl,\n                        apiKey: agentApiKey,\n                        user,\n                        fileName,\n                        mimeType,\n                        buffer\n                    });\n                    uploadedFileCache.set(cacheKey, {\n                        uploadFileId,\n                        extracted,\n                        size,\n                        mtimeMs,\n                        createdAt: Date.now()\n                    });\n                    return {\n                        uploadFileId,\n                        extracted\n                    };\n                })().finally(()=>uploadingFilePromises.delete(cacheKey));\n                uploadingFilePromises.set(cacheKey, promise);\n                const { uploadFileId, extracted } = await promise;\n                if (extracted) {\n                    attachmentExtracts.push(extracted);\n                }\n                return {\n                    type: \"document\",\n                    transfer_method: \"local_file\",\n                    upload_file_id: uploadFileId\n                };\n            });\n            for (const item of uploaded){\n                if (item) {\n                    files.push(item);\n                }\n            }\n        }\n        const templateMetaNeeded = !(templateName && templateName.trim()) || !(reportTitle && reportTitle.trim());\n        if (templateMetaNeeded) {\n            try {\n                const templateRow = await fetchTemplateMetaById(templateId);\n                if (templateRow) {\n                    if (!(templateName && templateName.trim())) {\n                        templateName = templateRow.temp_name ? String(templateRow.temp_name) : templateRow.name ? String(templateRow.name) : templateName;\n                    }\n                    if (!(reportTitle && reportTitle.trim())) {\n                        reportTitle = templateRow.report_title ? String(templateRow.report_title) : templateRow.reportTitle ? String(templateRow.reportTitle) : reportTitle;\n                    }\n                }\n            } catch  {}\n        }\n        const templatePrompt = text && text.trim() ? text.trim() : \"\";\n        const templateNameTrimmed = (templateName || \"\").trim();\n        const reportTitleTrimmed = (reportTitle || \"\").trim();\n        const departmentTrimmed = (department || \"\").trim();\n        const reportDateTrimmed = (reportDate || \"\").trim();\n        const attachmentExtractText = attachmentExtracts.map((item)=>String(item || \"\").trim()).filter(Boolean).join(\"\\n\\n\");\n        const promptPieces = [\n            classificationValue === 7 ? \"任务类型：周报生成类任务（分类7）\" : \"任务类型：模板周报生成类任务（分类6）\",\n            \"请仅输出最终内容，不要输出推理过程、不要输出<think>或<analysis>标签内容。\",\n            \"输出格式要求：Markdown。\",\n            templateNameTrimmed ? `模板名称：${templateNameTrimmed}` : \"\",\n            reportTitleTrimmed ? `周报标题：${reportTitleTrimmed}` : \"\",\n            reportDateTrimmed ? `日期：${reportDateTrimmed}` : \"\",\n            departmentTrimmed ? `部门：${departmentTrimmed}` : \"\",\n            templatePrompt ? `模板文字描述（template_text）：\\n${templatePrompt}` : \"\",\n            attachmentExtractText ? `附件内容（已从Excel解析，必须严格使用以下真实数据，禁止编造）：\\n\\n${attachmentExtractText}` : \"\",\n            files.length ? \"附件：已上传，请结合附件内容生成对应的周报内容。\" : \"附件：无。\",\n            \"请直接输出周报正文内容。\"\n        ].filter(Boolean);\n        const prompt = promptPieces.join(\"\\n\\n\");\n        const inputs = {\n            target_file: targetFile,\n            template_text: text,\n            classification: classificationValue\n        };\n        if (templateNameTrimmed) {\n            inputs.template_name = templateNameTrimmed;\n        }\n        if (reportTitleTrimmed) {\n            inputs.report_title = reportTitleTrimmed;\n        }\n        if (reportDateTrimmed) {\n            inputs.report_date = reportDateTrimmed;\n        }\n        if (departmentTrimmed) {\n            inputs.department = departmentTrimmed;\n        }\n        if (attachmentExtractText) {\n            inputs.attachment_excel_markdown = attachmentExtractText;\n        }\n        const agentPayload = {\n            inputs,\n            query: prompt,\n            response_mode: \"blocking\",\n            user,\n            files: files.length ? files : undefined\n        };\n        let normalizedOutput = \"\";\n        try {\n            const agentResponse = await fetchWithTimeoutRetry(agentApiUrl, {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\",\n                    Authorization: `Bearer ${agentApiKey}`\n                },\n                body: JSON.stringify(agentPayload)\n            }, 240000, 1);\n            const agentText = await agentResponse.text();\n            let agentData = null;\n            try {\n                agentData = agentText ? JSON.parse(agentText) : null;\n            } catch  {\n                agentData = null;\n            }\n            if (!agentResponse.ok) {\n                const rawMessage = agentData && (agentData.error || agentData.message) || agentText || \"\";\n                const trimmedMessage = typeof rawMessage === \"string\" ? rawMessage.slice(0, 300) : String(rawMessage).slice(0, 300);\n                throw new Error(trimmedMessage ? `Agent请求失败: ${agentResponse.status} ${trimmedMessage}` : `Agent请求失败: ${agentResponse.status}`);\n            }\n            if (!agentData) {\n                const trimmed = (agentText || \"\").trim();\n                if (trimmed.startsWith(\"<\")) {\n                    throw new Error(\"Agent返回非JSON（疑似HTML页面），请检查CRM_V3_AGENT_API_URL是否为/v1/chat-messages接口\");\n                }\n                const snippet = trimmed.length > 200 ? trimmed.slice(0, 200) : trimmed;\n                throw new Error(snippet ? `Agent返回非JSON，前200字符为: ${snippet}` : \"Agent返回非JSON\");\n            }\n            normalizedOutput = extractAgentOutput(agentData);\n            normalizedOutput = normalizedOutput ? String(normalizedOutput).trim() : \"\";\n        } catch (e) {\n            normalizedOutput = await callAgentStreaming({\n                url: agentApiUrl,\n                apiKey: agentApiKey,\n                payload: agentPayload\n            });\n            normalizedOutput = normalizedOutput ? String(normalizedOutput).trim() : \"\";\n            if (!normalizedOutput) {\n                throw e;\n            }\n        }\n        if (!normalizedOutput && files.length) {\n            const retryPayload = {\n                inputs: agentPayload.inputs,\n                query: agentPayload.query,\n                response_mode: \"blocking\",\n                user: agentPayload.user\n            };\n            try {\n                const retryRes = await fetchWithTimeoutRetry(agentApiUrl, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        Authorization: `Bearer ${agentApiKey}`\n                    },\n                    body: JSON.stringify(retryPayload)\n                }, 240000, 1);\n                const retryText = await retryRes.text();\n                let retryData = null;\n                try {\n                    retryData = retryText ? JSON.parse(retryText) : null;\n                } catch  {\n                    retryData = null;\n                }\n                if (retryRes.ok && retryData) {\n                    normalizedOutput = extractAgentOutput(retryData);\n                    normalizedOutput = normalizedOutput ? String(normalizedOutput).trim() : \"\";\n                }\n            } catch  {\n                normalizedOutput = \"\";\n            }\n            if (!normalizedOutput) {\n                normalizedOutput = await callAgentStreaming({\n                    url: agentApiUrl,\n                    apiKey: agentApiKey,\n                    payload: retryPayload\n                });\n                normalizedOutput = normalizedOutput ? String(normalizedOutput).trim() : \"\";\n            }\n        }\n        if (!normalizedOutput) {\n            const attachmentNames = selectedRows.map((row)=>row && row.file_name ? String(row.file_name) : \"\").filter(Boolean).join(\"、\");\n            const fallbackText = [\n                \"（Agent返回空内容）\",\n                \"\",\n                \"提示词：\",\n                prompt || \"（空）\",\n                \"\",\n                \"附件：\",\n                attachmentNames || \"（无）\"\n            ].join(\"\\n\");\n            const html = wrapAsMarkdownDocument(fallbackText);\n            res.status(200).json({\n                html,\n                markdown: fallbackText\n            });\n            return;\n        }\n        const cleaned = stripThinkTags(normalizedOutput);\n        const markdown = looksLikeHtml(cleaned) ? \"\" : String(cleaned || normalizedOutput);\n        const html = looksLikeHtml(cleaned) ? cleaned : wrapAsMarkdownDocument(markdown);\n        res.status(200).json({\n            html,\n            markdown\n        });\n        return;\n    } catch (e) {\n        const fallbackText = `（测试失败）\\n\\n${formatFetchError(e)}`;\n        res.status(200).json({\n            html: wrapAsMarkdownDocument(fallbackText),\n            markdown: fallbackText\n        });\n        return;\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvdGVtcGxhdGVzL1tpZF0vcHJldmlldy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFDcUQ7QUFDeEI7QUFDQTtBQUU3QixTQUFTRyxRQUFRQyxLQUFjO0lBQzdCLE1BQU1DLE1BQU1ELFVBQVUsUUFBUUEsVUFBVUUsWUFBWUMsT0FBT0gsT0FBT0ksSUFBSSxLQUFLO0lBQzNFLElBQUksQ0FBQ0gsS0FBSztRQUNSLE9BQU87SUFDVDtJQUNBLE9BQU9BLElBQUlJLE9BQU8sQ0FBQyxVQUFVLElBQUlBLE9BQU8sQ0FBQyxVQUFVLElBQUlELElBQUk7QUFDN0Q7QUFFQSxNQUFNRSxjQUFjUCxRQUFRUSwwQ0FBb0M7QUFDaEUsTUFBTUcsY0FBY1gsUUFDbEJRLGtOQUF5QyxJQUFJQSxDQUFnQztBQUUvRSxNQUFNTSxxQkFBcUJkLFFBQVFRLFFBQVFDLEdBQUcsQ0FBQ0ksb0JBQW9CO0FBQ25FLE1BQU1FLGdCQUFnQmxCLG1FQUFZQSxDQUNoQ1UsYUFDQU8sc0JBQXNCSCxlQUFlO0FBR3ZDLE1BQU1LLGNBQWNoQixRQUFRUSxRQUFRQyxHQUFHLENBQUNRLG9CQUFvQjtBQUM1RCxNQUFNQyxjQUFjbEIsUUFBUVEsUUFBUUMsR0FBRyxDQUFDVSxvQkFBb0I7QUFVNUQsTUFBTUMsb0JBQW9CLElBQUlDO0FBQzlCLE1BQU1DLHdCQUF3QixJQUFJRDtBQUtsQyxTQUFTRSxhQUFhdEIsS0FBYztJQUNsQyxJQUFJQSxVQUFVLFFBQVFBLFVBQVVFLFdBQVc7UUFDekMsT0FBTztJQUNUO0lBQ0EsT0FBT0MsT0FBT0g7QUFDaEI7QUFFQSxlQUFldUIsc0JBQXNCQyxVQUFrQjtJQUNyRCxNQUFNQywwQkFBMEI7UUFDOUI7UUFDQTtRQUNBO0tBQ0Q7SUFDRCxNQUFNQyxXQUFXO1FBQUM7UUFBTTtRQUFXO0tBQWM7SUFDakQsSUFBSUMsWUFBaUI7SUFFckIsS0FBSyxNQUFNQyxpQkFBaUJILHdCQUF5QjtRQUNuRCxLQUFLLE1BQU1JLFdBQVdILFNB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QUM7WUFDUCxNQUFNVixPQUFPNkMsdUJBQXVCc087WUFDcEM3RSxJQUFJekQsTUFBTSxDQUFDLEtBQUtLLElBQUksQ0FBQztnQkFBRWxKO2dCQUFNRixVQUFVcVI7WUFBYTtZQUNwRDtRQUNGO1FBRUEsTUFBTUMsVUFBVXBTLGVBQWUwUjtRQUMvQixNQUFNNVEsV0FBV2lELGNBQWNxTyxXQUFXLEtBQUtuVixPQUFPbVYsV0FBV1Y7UUFDakUsTUFBTTFRLE9BQU8rQyxjQUFjcU8sV0FBV0EsVUFBVXZPLHVCQUF1Qi9DO1FBQ3ZFd00sSUFBSXpELE1BQU0sQ0FBQyxLQUFLSyxJQUFJLENBQUM7WUFBRWxKO1lBQU1GO1FBQVM7UUFDdEM7SUFDRixFQUFFLE9BQU9tSCxHQUFRO1FBQ2YsTUFBTWtLLGVBQWUsQ0FBQyxVQUFVLEVBQUU3SyxpQkFBaUJXLEdBQUcsQ0FBQztRQUN2RHFGLElBQUl6RCxNQUFNLENBQUMsS0FBS0ssSUFBSSxDQUFDO1lBQUVsSixNQUFNNkMsdUJBQXVCc087WUFBZXJSLFVBQVVxUjtRQUFhO1FBQzFGO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2NybS1hZ2VudC13ZWIvLi9wYWdlcy9hcGkvdGVtcGxhdGVzL1tpZF0vcHJldmlldy50cz83MWI4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgTmV4dEFwaVJlcXVlc3QsIE5leHRBcGlSZXNwb25zZSB9IGZyb20gXCJuZXh0XCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5pbXBvcnQgZnMgZnJvbSBcImZzL3Byb21pc2VzXCI7XG5pbXBvcnQgKiBhcyBYTFNYIGZyb20gXCJ4bHN4XCI7XG5cbmZ1bmN0aW9uIHJlYWRFbnYodmFsdWU6IHVua25vd24pIHtcbiAgY29uc3QgcmF3ID0gdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZCA/IFN0cmluZyh2YWx1ZSkudHJpbSgpIDogXCJcIjtcbiAgaWYgKCFyYXcpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICByZXR1cm4gcmF3LnJlcGxhY2UoL15bJ1wiYF0vLCBcIlwiKS5yZXBsYWNlKC9bJ1wiYF0kLywgXCJcIikudHJpbSgpO1xufVxuXG5jb25zdCBzdXBhYmFzZVVybCA9IHJlYWRFbnYocHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMKTtcbmNvbnN0IHN1cGFiYXNlS2V5ID0gcmVhZEVudihcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkgfHwgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9LRVlcbik7XG5jb25zdCBzdXBhYmFzZVNlcnZpY2VLZXkgPSByZWFkRW52KHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfS0VZKTtcbmNvbnN0IGFkbWluU3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHN1cGFiYXNlVXJsLFxuICBzdXBhYmFzZVNlcnZpY2VLZXkgfHwgc3VwYWJhc2VLZXkgfHwgXCJcIlxuKTtcblxuY29uc3QgYWdlbnRBcGlVcmwgPSByZWFkRW52KHByb2Nlc3MuZW52LkNSTV9WM19BR0VOVF9BUElfVVJMKTtcbmNvbnN0IGFnZW50QXBpS2V5ID0gcmVhZEVudihwcm9jZXNzLmVudi5DUk1fVjNfQUdFTlRfQVBJX0tFWSk7XG5cbnR5cGUgVXBsb2FkZWRGaWxlQ2FjaGVJdGVtID0ge1xuICB1cGxvYWRGaWxlSWQ6IHN0cmluZztcbiAgZXh0cmFjdGVkOiBzdHJpbmc7XG4gIHNpemU6IG51bWJlcjtcbiAgbXRpbWVNczogbnVtYmVyO1xuICBjcmVhdGVkQXQ6IG51bWJlcjtcbn07XG5cbmNvbnN0IHVwbG9hZGVkRmlsZUNhY2hlID0gbmV3IE1hcDxzdHJpbmcsIFVwbG9hZGVkRmlsZUNhY2hlSXRlbT4oKTtcbmNvbnN0IHVwbG9hZGluZ0ZpbGVQcm9taXNlcyA9IG5ldyBNYXA8XG4gIHN0cmluZyxcbiAgUHJvbWlzZTx7IHVwbG9hZEZpbGVJZDogc3RyaW5nOyBleHRyYWN0ZWQ6IHN0cmluZyB9PlxuPigpO1xuXG5mdW5jdGlvbiB0b1N0cmluZ1NhZmUodmFsdWU6IHVua25vd24pIHtcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICByZXR1cm4gU3RyaW5nKHZhbHVlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZmV0Y2hUZW1wbGF0ZU1ldGFCeUlkKHRlbXBsYXRlSWQ6IHN0cmluZykge1xuICBjb25zdCBzZWxlY3RDb2x1bW5zQ2FuZGlkYXRlcyA9IFtcbiAgICBcImlkLHRlbXBfaWQsdGVtcGxhdGVfaWQsdGVtcF9uYW1lLG5hbWUscmVwb3J0X3RpdGxlLHJlcG9ydFRpdGxlXCIsXG4gICAgXCJpZCx0ZW1wX2lkLHRlbXBsYXRlX2lkLHRlbXBfbmFtZSxuYW1lLHJlcG9ydF90aXRsZVwiLFxuICAgIFwiaWQsdGVtcF9pZCx0ZW1wbGF0ZV9pZCx0ZW1wX25hbWUsbmFtZVwiXG4gIF07XG4gIGNvbnN0IGlkRmllbGRzID0gW1wiaWRcIiwgXCJ0ZW1wX2lkXCIsIFwidGVtcGxhdGVfaWRcIl07XG4gIGxldCBsYXN0RXJyb3I6IGFueSA9IG51bGw7XG5cbiAgZm9yIChjb25zdCBzZWxlY3RDb2x1bW5zIG9mIHNlbGVjdENvbHVtbnNDYW5kaWRhdGVzKSB7XG4gICAgZm9yIChjb25zdCBpZEZpZWxkIG9mIGlkRmllbGRzKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCAoYWRtaW5TdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKFwiZG9jdW1lbnRfdGVtcGxhdGVzXCIpXG4gICAgICAgIC5zZWxlY3Qoc2VsZWN0Q29sdW1ucylcbiAgICAgICAgLmVxKGlkRmllbGQsIHRlbXBsYXRlSWQpXG4gICAgICAgIC5tYXliZVNpbmdsZSgpO1xuICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICByZXR1cm4gZGF0YSA/IChkYXRhIGFzIGFueSkgOiBudWxsO1xuICAgICAgfVxuICAgICAgbGFzdEVycm9yID0gZXJyb3I7XG4gICAgICBpZiAoIS9jb2x1bW4gLiogZG9lcyBub3QgZXhpc3QvaS50ZXN0KGVycm9yLm1lc3NhZ2UgfHwgXCJcIikpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaWYgKGxhc3RFcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihsYXN0RXJyb3IubWVzc2FnZSB8fCBcIuafpeivouaooeadv+S/oeaBr+Wksei0pVwiKTtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplVGFyZ2V0RmlsZShyYXc6IHN0cmluZywgdGVtcGxhdGVJZDogc3RyaW5nKSB7XG4gIGxldCB2YWx1ZSA9IChyYXcgfHwgXCJcIikudHJpbSgpO1xuICBpZiAoIXZhbHVlKSB7XG4gICAgdmFsdWUgPSBgdGVtcGxhdGUtJHt0ZW1wbGF0ZUlkLnNsaWNlKDAsIDEyKX0uaHRtbGA7XG4gIH1cbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9bXFxcXC9dL2csIFwiLVwiKTtcbiAgaWYgKCEvXFwuW2EtejAtOV0rJC9pLnRlc3QodmFsdWUpKSB7XG4gICAgdmFsdWUgPSBgJHt2YWx1ZX0uaHRtbGA7XG4gIH1cbiAgaWYgKCF2YWx1ZS50b0xvd2VyQ2FzZSgpLmVuZHNXaXRoKFwiLmh0bWxcIikpIHtcbiAgICB2YWx1ZSA9IGAke3ZhbHVlfS5odG1sYDtcbiAgfVxuICBpZiAodmFsdWUubGVuZ3RoID4gNDgpIHtcbiAgICBjb25zdCBleHQgPSBcIi5odG1sXCI7XG4gICAgY29uc3QgYmFzZU1heCA9IE1hdGgubWF4KDEsIDQ4IC0gZXh0Lmxlbmd0aCk7XG4gICAgdmFsdWUgPSBgJHt2YWx1ZS5zbGljZSgwLCBiYXNlTWF4KX0ke2V4dH1gO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZXNjYXBlSHRtbCh0ZXh0OiBzdHJpbmcpIHtcbiAgcmV0dXJuIHRleHRcbiAgICAucmVwbGFjZSgvJi9nLCBcIiZhbXA7XCIpXG4gICAgLnJlcGxhY2UoLzwvZywgXCImbHQ7XCIpXG4gICAgLnJlcGxhY2UoLz4vZywgXCImZ3Q7XCIpXG4gICAgLnJlcGxhY2UoL1wiL2csIFwiJnF1b3Q7XCIpXG4gICAgLnJlcGxhY2UoLycvZywgXCImIzM5O1wiKTtcbn1cblxuZnVuY3Rpb24gc3RyaXBUaGlua1RhZ3ModGV4dDogc3RyaW5nKSB7XG4gIGxldCB2YWx1ZSA9ICh0ZXh0IHx8IFwiXCIpLnJlcGxhY2UoL1xcclxcbi9nLCBcIlxcblwiKTtcbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC88dGhpbms+W1xcc1xcU10qPzxcXC90aGluaz4vZ2ksIFwiXCIpO1xuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLzxcXC8/dGhpbms+L2dpLCBcIlwiKTtcbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC88YW5hbHlzaXM+W1xcc1xcU10qPzxcXC9hbmFseXNpcz4vZ2ksIFwiXCIpO1xuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoLzxcXC8/YW5hbHlzaXM+L2dpLCBcIlwiKTtcbiAgcmV0dXJuIHZhbHVlLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gaW5saW5lTWFya2Rvd25Ub0h0bWwoZXNjYXBlZFRleHQ6IHN0cmluZykge1xuICBsZXQgdmFsdWUgPSBlc2NhcGVkVGV4dDtcbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC8hXFxbKFteXFxdXSo/KVxcXVxcKChbXildKz8pXFwpL2csIChfbSwgYWx0UmF3LCB1cmxSYXcpID0+IHtcbiAgICBjb25zdCBhbHQgPSAoYWx0UmF3IHx8IFwiXCIpLnRyaW0oKTtcbiAgICBsZXQgdXJsID0gKHVybFJhdyB8fCBcIlwiKS50cmltKCk7XG4gICAgaWYgKHVybC5zdGFydHNXaXRoKFwiPFwiKSAmJiB1cmwuZW5kc1dpdGgoXCI+XCIpKSB7XG4gICAgICB1cmwgPSB1cmwuc2xpY2UoMSwgLTEpLnRyaW0oKTtcbiAgICB9XG4gICAgY29uc3QgdXJsRmlyc3QgPSB1cmwuc3BsaXQoL1xccysvKVswXSB8fCBcIlwiO1xuICAgIGlmICghdXJsRmlyc3QpIHtcbiAgICAgIHJldHVybiBhbHQgPyBgPHNwYW4+JHthbHR9PC9zcGFuPmAgOiBcIlwiO1xuICAgIH1cbiAgICByZXR1cm4gYDxpbWcgc3JjPVwiJHt1cmxGaXJzdH1cIiBhbHQ9XCIke2FsdH1cIiAvPmA7XG4gIH0pO1xuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcWyhbXlxcXV0rPylcXF1cXCgoW14pXSs/KVxcKS9nLCAoX20sIHRleHRSYXcsIHVybFJhdykgPT4ge1xuICAgIGNvbnN0IHRleHQgPSAodGV4dFJhdyB8fCBcIlwiKS50cmltKCk7XG4gICAgbGV0IHVybCA9ICh1cmxSYXcgfHwgXCJcIikudHJpbSgpO1xuICAgIGlmICh1cmwuc3RhcnRzV2l0aChcIjxcIikgJiYgdXJsLmVuZHNXaXRoKFwiPlwiKSkge1xuICAgICAgdXJsID0gdXJsLnNsaWNlKDEsIC0xKS50cmltKCk7XG4gICAgfVxuICAgIGNvbnN0IHVybEZpcnN0ID0gdXJsLnNwbGl0KC9cXHMrLylbMF0gfHwgXCJcIjtcbiAgICBpZiAoIXVybEZpcnN0KSB7XG4gICAgICByZXR1cm4gdGV4dDtcbiAgICB9XG4gICAgcmV0dXJuIGA8YSBocmVmPVwiJHt1cmxGaXJzdH1cIiB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub29wZW5lciBub3JlZmVycmVyXCI+JHt0ZXh0fTwvYT5gO1xuICB9KTtcbiAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKFxuICAgIC8oXnxbXFxzKF0pKChodHRwcz86XFwvXFwvKVteXFxzKV0rKSg/PSR8W1xccyldKS9nLFxuICAgIChfbSwgcHJlZml4LCB1cmwpID0+XG4gICAgICBgJHtwcmVmaXh9PGEgaHJlZj1cIiR7dXJsfVwiIHRhcmdldD1cIl9ibGFua1wiIHJlbD1cIm5vb3BlbmVyIG5vcmVmZXJyZXJcIj4ke3VybH08L2E+YFxuICApO1xuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL2AoW15gXSs/KWAvZywgXCI8Y29kZT4kMTwvY29kZT5cIik7XG4gIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFwqXFwqKFteKl0rPylcXCpcXCovZywgXCI8c3Ryb25nPiQxPC9zdHJvbmc+XCIpO1xuICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL19fKFteX10rPylfXy9nLCBcIjxzdHJvbmc+JDE8L3N0cm9uZz5cIik7XG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gbWFya2Rvd25Ub0h0bWwobWFya2Rvd246IHN0cmluZykge1xuICBjb25zdCBsaW5lcyA9IChtYXJrZG93biB8fCBcIlwiKS5yZXBsYWNlKC9cXHJcXG4vZywgXCJcXG5cIikuc3BsaXQoXCJcXG5cIik7XG4gIGNvbnN0IGh0bWw6IHN0cmluZ1tdID0gW107XG4gIGxldCBpbkNvZGUgPSBmYWxzZTtcbiAgbGV0IGNvZGVMaW5lczogc3RyaW5nW10gPSBbXTtcbiAgbGV0IGxpc3RUeXBlOiBcInVsXCIgfCBcIm9sXCIgfCBudWxsID0gbnVsbDtcbiAgbGV0IGluQmxvY2txdW90ZSA9IGZhbHNlO1xuXG4gIGNvbnN0IGNsb3NlTGlzdCA9ICgpID0+IHtcbiAgICBpZiAobGlzdFR5cGUpIHtcbiAgICAgIGh0bWwucHVzaChsaXN0VHlwZSA9PT0gXCJ1bFwiID8gXCI8L3VsPlwiIDogXCI8L29sPlwiKTtcbiAgICAgIGxpc3RUeXBlID0gbnVsbDtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2xvc2VCbG9ja3F1b3RlID0gKCkgPT4ge1xuICAgIGlmIChpbkJsb2NrcXVvdGUpIHtcbiAgICAgIGh0bWwucHVzaChcIjwvYmxvY2txdW90ZT5cIik7XG4gICAgICBpbkJsb2NrcXVvdGUgPSBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZmx1c2hDb2RlID0gKCkgPT4ge1xuICAgIGlmICghaW5Db2RlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGNvZGUgPSBlc2NhcGVIdG1sKGNvZGVMaW5lcy5qb2luKFwiXFxuXCIpKTtcbiAgICBodG1sLnB1c2goYDxwcmU+PGNvZGU+JHtjb2RlfTwvY29kZT48L3ByZT5gKTtcbiAgICBjb2RlTGluZXMgPSBbXTtcbiAgICBpbkNvZGUgPSBmYWxzZTtcbiAgfTtcblxuICBjb25zdCBpc1RhYmxlU2VwYXJhdG9yTGluZSA9IChsaW5lOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB0cmltbWVkID0gKGxpbmUgfHwgXCJcIikudHJpbSgpO1xuICAgIGlmICghdHJpbW1lZCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIXRyaW1tZWQuaW5jbHVkZXMoXCJ8XCIpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIGNvbnN0IHdpdGhvdXRPdXRlciA9IHRyaW1tZWQucmVwbGFjZSgvXlxcfC8sIFwiXCIpLnJlcGxhY2UoL1xcfCQvLCBcIlwiKTtcbiAgICBjb25zdCBjZWxscyA9IHdpdGhvdXRPdXRlci5zcGxpdChcInxcIikubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSk7XG4gICAgaWYgKGNlbGxzLmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGNlbGxzLmV2ZXJ5KChjZWxsKSA9PiAvXjo/LXszLH06PyQvLnRlc3QoY2VsbCkpO1xuICB9O1xuXG4gIGNvbnN0IHNwbGl0VGFibGVSb3cgPSAobGluZTogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgdHJpbW1lZCA9IChsaW5lIHx8IFwiXCIpLnRyaW0oKTtcbiAgICBjb25zdCB3aXRob3V0T3V0ZXIgPSB0cmltbWVkLnJlcGxhY2UoL15cXHwvLCBcIlwiKS5yZXBsYWNlKC9cXHwkLywgXCJcIik7XG4gICAgcmV0dXJuIHdpdGhvdXRPdXRlci5zcGxpdChcInxcIikubWFwKChwYXJ0KSA9PiBwYXJ0LnRyaW0oKSk7XG4gIH07XG5cbiAgY29uc3QgZ2V0VGFibGVBbGlnbm1lbnRzID0gKHNlcGFyYXRvckxpbmU6IHN0cmluZykgPT4ge1xuICAgIGNvbnN0IGNlbGxzID0gc3BsaXRUYWJsZVJvdyhzZXBhcmF0b3JMaW5lKTtcbiAgICByZXR1cm4gY2VsbHMubWFwKChjZWxsKSA9PiB7XG4gICAgICBjb25zdCBsZWZ0ID0gY2VsbC5zdGFydHNXaXRoKFwiOlwiKTtcbiAgICAgIGNvbnN0IHJpZ2h0ID0gY2VsbC5lbmRzV2l0aChcIjpcIik7XG4gICAgICBpZiAobGVmdCAmJiByaWdodCkge1xuICAgICAgICByZXR1cm4gXCJjZW50ZXJcIjtcbiAgICAgIH1cbiAgICAgIGlmIChyaWdodCkge1xuICAgICAgICByZXR1cm4gXCJyaWdodFwiO1xuICAgICAgfVxuICAgICAgaWYgKGxlZnQpIHtcbiAgICAgICAgcmV0dXJuIFwibGVmdFwiO1xuICAgICAgfVxuICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfSk7XG4gIH07XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7IGkgKz0gMSkge1xuICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXSA/PyBcIlwiO1xuXG4gICAgaWYgKGluQ29kZSkge1xuICAgICAgaWYgKC9eXFxzKmBgYC8udGVzdChsaW5lKSkge1xuICAgICAgICBmbHVzaENvZGUoKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBjb2RlTGluZXMucHVzaChsaW5lKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGlmICgvXlxccypgYGAvLnRlc3QobGluZSkpIHtcbiAgICAgIGNsb3NlTGlzdCgpO1xuICAgICAgY2xvc2VCbG9ja3F1b3RlKCk7XG4gICAgICBpbkNvZGUgPSB0cnVlO1xuICAgICAgY29kZUxpbmVzID0gW107XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoL15cXHMqJC8udGVzdChsaW5lKSkge1xuICAgICAgY2xvc2VMaXN0KCk7XG4gICAgICBjbG9zZUJsb2NrcXVvdGUoKTtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cblxuICAgIGNvbnN0IG5leHRMaW5lID0gaSArIDEgPCBsaW5lcy5sZW5ndGggPyBTdHJpbmcobGluZXNbaSArIDFdID8/IFwiXCIpIDogXCJcIjtcbiAgICBjb25zdCBjYW5TdGFydFRhYmxlID1cbiAgICAgIGxpbmUudHJpbSgpLmluY2x1ZGVzKFwifFwiKSAmJiBpc1RhYmxlU2VwYXJhdG9yTGluZShuZXh0TGluZSkgJiYgIS9eXFxzKj4vLnRlc3QobGluZSk7XG4gICAgaWYgKGNhblN0YXJ0VGFibGUpIHtcbiAgICAgIGNsb3NlTGlzdCgpO1xuICAgICAgY2xvc2VCbG9ja3F1b3RlKCk7XG4gICAgICBjb25zdCBoZWFkZXJDZWxscyA9IHNwbGl0VGFibGVSb3cobGluZSk7XG4gICAgICBjb25zdCBhbGlnbm1lbnRzID0gZ2V0VGFibGVBbGlnbm1lbnRzKG5leHRMaW5lKTtcbiAgICAgIGNvbnN0IHJvd3M6IHN0cmluZ1tdW10gPSBbXTtcbiAgICAgIGkgKz0gMjtcbiAgICAgIHdoaWxlIChpIDwgbGluZXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IHJvd0xpbmUgPSBTdHJpbmcobGluZXNbaV0gPz8gXCJcIik7XG4gICAgICAgIGlmICghcm93TGluZS50cmltKCkpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJvd0xpbmUuaW5jbHVkZXMoXCJ8XCIpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgcm93cy5wdXNoKHNwbGl0VGFibGVSb3cocm93TGluZSkpO1xuICAgICAgICBpICs9IDE7XG4gICAgICB9XG4gICAgICBpIC09IDE7XG5cbiAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5tYXgoXG4gICAgICAgIGhlYWRlckNlbGxzLmxlbmd0aCxcbiAgICAgICAgYWxpZ25tZW50cy5sZW5ndGgsXG4gICAgICAgIHJvd3MucmVkdWNlKChtYXgsIHJvdykgPT4gTWF0aC5tYXgobWF4LCByb3cubGVuZ3RoKSwgMClcbiAgICAgICk7XG4gICAgICB3aGlsZSAoaGVhZGVyQ2VsbHMubGVuZ3RoIDwgd2lkdGgpIHtcbiAgICAgICAgaGVhZGVyQ2VsbHMucHVzaChcIlwiKTtcbiAgICAgIH1cbiAgICAgIHdoaWxlIChhbGlnbm1lbnRzLmxlbmd0aCA8IHdpZHRoKSB7XG4gICAgICAgIGFsaWdubWVudHMucHVzaChcIlwiKTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3Qgcm93IG9mIHJvd3MpIHtcbiAgICAgICAgd2hpbGUgKHJvdy5sZW5ndGggPCB3aWR0aCkge1xuICAgICAgICAgIHJvdy5wdXNoKFwiXCIpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGh0bWwucHVzaChcIjx0YWJsZT48dGhlYWQ+PHRyPlwiKTtcbiAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgd2lkdGg7IGMgKz0gMSkge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gaW5saW5lTWFya2Rvd25Ub0h0bWwoZXNjYXBlSHRtbChoZWFkZXJDZWxsc1tjXSB8fCBcIlwiKSk7XG4gICAgICAgIGNvbnN0IGFsaWduID0gYWxpZ25tZW50c1tjXSA/IGAgc3R5bGU9XCJ0ZXh0LWFsaWduOiR7YWxpZ25tZW50c1tjXX1cImAgOiBcIlwiO1xuICAgICAgICBodG1sLnB1c2goYDx0aCR7YWxpZ259PiR7Y29udGVudH08L3RoPmApO1xuICAgICAgfVxuICAgICAgaHRtbC5wdXNoKFwiPC90cj48L3RoZWFkPjx0Ym9keT5cIik7XG4gICAgICBmb3IgKGNvbnN0IHJvdyBvZiByb3dzKSB7XG4gICAgICAgIGh0bWwucHVzaChcIjx0cj5cIik7XG4gICAgICAgIGZvciAobGV0IGMgPSAwOyBjIDwgd2lkdGg7IGMgKz0gMSkge1xuICAgICAgICAgIGNvbnN0IGNvbnRlbnQgPSBpbmxpbmVNYXJrZG93blRvSHRtbChlc2NhcGVIdG1sKHJvd1tjXSB8fCBcIlwiKSk7XG4gICAgICAgICAgY29uc3QgYWxpZ24gPSBhbGlnbm1lbnRzW2NdID8gYCBzdHlsZT1cInRleHQtYWxpZ246JHthbGlnbm1lbnRzW2NdfVwiYCA6IFwiXCI7XG4gICAgICAgICAgaHRtbC5wdXNoKGA8dGQke2FsaWdufT4ke2NvbnRlbnR9PC90ZD5gKTtcbiAgICAgICAgfVxuICAgICAgICBodG1sLnB1c2goXCI8L3RyPlwiKTtcbiAgICAgIH1cbiAgICAgIGh0bWwucHVzaChcIjwvdGJvZHk+PC90YWJsZT5cIik7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCBoZWFkaW5nTWF0Y2ggPSBsaW5lLm1hdGNoKC9eKCN7MSw2fSlcXHMrKC4qKSQvKTtcbiAgICBpZiAoaGVhZGluZ01hdGNoKSB7XG4gICAgICBjbG9zZUxpc3QoKTtcbiAgICAgIGNsb3NlQmxvY2txdW90ZSgpO1xuICAgICAgY29uc3QgbGV2ZWwgPSBoZWFkaW5nTWF0Y2hbMV0ubGVuZ3RoO1xuICAgICAgY29uc3QgY29udGVudCA9IGlubGluZU1hcmtkb3duVG9IdG1sKGVzY2FwZUh0bWwoaGVhZGluZ01hdGNoWzJdIHx8IFwiXCIpKTtcbiAgICAgIGh0bWwucHVzaChgPGgke2xldmVsfT4ke2NvbnRlbnR9PC9oJHtsZXZlbH0+YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAoL14oXFwqXFxzKlxcKlxccypcXCp8LXszLH18X3szLH0pXFxzKiQvLnRlc3QobGluZS50cmltKCkpKSB7XG4gICAgICBjbG9zZUxpc3QoKTtcbiAgICAgIGNsb3NlQmxvY2txdW90ZSgpO1xuICAgICAgaHRtbC5wdXNoKFwiPGhyIC8+XCIpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgY29uc3QgYmxvY2txdW90ZU1hdGNoID0gbGluZS5tYXRjaCgvXlxccyo+XFxzPyguKikkLyk7XG4gICAgaWYgKGJsb2NrcXVvdGVNYXRjaCkge1xuICAgICAgY2xvc2VMaXN0KCk7XG4gICAgICBpZiAoIWluQmxvY2txdW90ZSkge1xuICAgICAgICBodG1sLnB1c2goXCI8YmxvY2txdW90ZT5cIik7XG4gICAgICAgIGluQmxvY2txdW90ZSA9IHRydWU7XG4gICAgICB9XG4gICAgICBjb25zdCBjb250ZW50ID0gaW5saW5lTWFya2Rvd25Ub0h0bWwoZXNjYXBlSHRtbChibG9ja3F1b3RlTWF0Y2hbMV0gfHwgXCJcIikpO1xuICAgICAgaHRtbC5wdXNoKGA8cD4ke2NvbnRlbnR9PC9wPmApO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgY29uc3Qgb2xNYXRjaCA9IGxpbmUubWF0Y2goL15cXHMqXFxkK1xcLlxccysoLiopJC8pO1xuICAgIGlmIChvbE1hdGNoKSB7XG4gICAgICBjbG9zZUJsb2NrcXVvdGUoKTtcbiAgICAgIGlmIChsaXN0VHlwZSAhPT0gXCJvbFwiKSB7XG4gICAgICAgIGNsb3NlTGlzdCgpO1xuICAgICAgICBodG1sLnB1c2goXCI8b2w+XCIpO1xuICAgICAgICBsaXN0VHlwZSA9IFwib2xcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBpbmxpbmVNYXJrZG93blRvSHRtbChlc2NhcGVIdG1sKG9sTWF0Y2hbMV0gfHwgXCJcIikpO1xuICAgICAgaHRtbC5wdXNoKGA8bGk+JHtjb250ZW50fTwvbGk+YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjb25zdCB1bE1hdGNoID0gbGluZS5tYXRjaCgvXlxccypbLSorXVxccysoLiopJC8pO1xuICAgIGlmICh1bE1hdGNoKSB7XG4gICAgICBjbG9zZUJsb2NrcXVvdGUoKTtcbiAgICAgIGlmIChsaXN0VHlwZSAhPT0gXCJ1bFwiKSB7XG4gICAgICAgIGNsb3NlTGlzdCgpO1xuICAgICAgICBodG1sLnB1c2goXCI8dWw+XCIpO1xuICAgICAgICBsaXN0VHlwZSA9IFwidWxcIjtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBpbmxpbmVNYXJrZG93blRvSHRtbChlc2NhcGVIdG1sKHVsTWF0Y2hbMV0gfHwgXCJcIikpO1xuICAgICAgaHRtbC5wdXNoKGA8bGk+JHtjb250ZW50fTwvbGk+YCk7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBjbG9zZUxpc3QoKTtcbiAgICBjbG9zZUJsb2NrcXVvdGUoKTtcbiAgICBjb25zdCBjb250ZW50ID0gaW5saW5lTWFya2Rvd25Ub0h0bWwoZXNjYXBlSHRtbChsaW5lKSk7XG4gICAgaHRtbC5wdXNoKGA8cD4ke2NvbnRlbnR9PC9wPmApO1xuICB9XG5cbiAgZmx1c2hDb2RlKCk7XG4gIGNsb3NlTGlzdCgpO1xuICBjbG9zZUJsb2NrcXVvdGUoKTtcbiAgcmV0dXJuIGh0bWwuam9pbihcIlxcblwiKTtcbn1cblxuZnVuY3Rpb24gd3JhcEFzTWFya2Rvd25Eb2N1bWVudChtYXJrZG93bjogc3RyaW5nKSB7XG4gIGNvbnN0IGJvZHlIdG1sID0gbWFya2Rvd25Ub0h0bWwobWFya2Rvd24pO1xuICByZXR1cm4gYDwhZG9jdHlwZSBodG1sPjxodG1sPjxoZWFkPjxtZXRhIGNoYXJzZXQ9XCJ1dGYtOFwiIC8+PG1ldGEgbmFtZT1cInZpZXdwb3J0XCIgY29udGVudD1cIndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTFcIiAvPjx0aXRsZT5UZW1wbGF0ZSBQcmV2aWV3PC90aXRsZT48c3R5bGU+Ym9keXtmb250LWZhbWlseTp1aS1zYW5zLXNlcmlmLHN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxIZWx2ZXRpY2EsQXJpYWwsXFxcIkFwcGxlIENvbG9yIEVtb2ppXFxcIixcXFwiU2Vnb2UgVUkgRW1vamlcXFwiO3BhZGRpbmc6MTZweDtsaW5lLWhlaWdodDoxLjc7Y29sb3I6IzExMTgyNztiYWNrZ3JvdW5kOiNmZmY7fWgxLGgyLGgzLGg0LGg1LGg2e21hcmdpbjoxNnB4IDAgMTBweDtsaW5lLWhlaWdodDoxLjI1O31we21hcmdpbjoxMHB4IDA7fXVsLG9se21hcmdpbjoxMHB4IDAgMTBweCAyNHB4O31saXttYXJnaW46NnB4IDA7fWhye2JvcmRlcjpub25lO2JvcmRlci10b3A6MXB4IHNvbGlkICNlNWU3ZWI7bWFyZ2luOjE2cHggMDt9YmxvY2txdW90ZXttYXJnaW46MTJweCAwO3BhZGRpbmc6OHB4IDEycHg7Ym9yZGVyLWxlZnQ6NHB4IHNvbGlkICNlNWU3ZWI7YmFja2dyb3VuZDojZjlmYWZiO2NvbG9yOiMzNzQxNTE7Ym9yZGVyLXJhZGl1czo2cHg7fWF7Y29sb3I6IzI1NjNlYjt0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lO31pbWd7bWF4LXdpZHRoOjEwMCU7aGVpZ2h0OmF1dG87ZGlzcGxheTpibG9jaztib3JkZXItcmFkaXVzOjhweDtib3JkZXI6MXB4IHNvbGlkICNlNWU3ZWI7YmFja2dyb3VuZDojZmZmO21hcmdpbjoxMHB4IDA7fXRhYmxle3dpZHRoOjEwMCU7Ym9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlO21hcmdpbjoxMnB4IDA7Zm9udC1zaXplOjE0cHg7fXRoLHRke2JvcmRlcjoxcHggc29saWQgI2U1ZTdlYjtwYWRkaW5nOjhweCAxMHB4O3ZlcnRpY2FsLWFsaWduOnRvcDt9dGh7YmFja2dyb3VuZDojZjlmYWZiO2ZvbnQtd2VpZ2h0OjYwMDt9dGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4pe2JhY2tncm91bmQ6I2ZjZmNmZDt9Y29kZXtmb250LWZhbWlseTp1aS1tb25vc3BhY2UsU0ZNb25vLVJlZ3VsYXIsTWVubG8sTW9uYWNvLENvbnNvbGFzLFxcXCJMaWJlcmF0aW9uIE1vbm9cXFwiLFxcXCJDb3VyaWVyIE5ld1xcXCIsbW9ub3NwYWNlO2ZvbnQtc2l6ZTouOTVlbTtiYWNrZ3JvdW5kOiNmM2Y0ZjY7Ym9yZGVyLXJhZGl1czo0cHg7cGFkZGluZzoycHggNnB4O31wcmV7d2hpdGUtc3BhY2U6cHJlLXdyYXA7d29yZC1icmVhazpicmVhay13b3JkO2JhY2tncm91bmQ6IzBiMTIyMDtjb2xvcjojZTVlN2ViO2JvcmRlci1yYWRpdXM6OHB4O3BhZGRpbmc6MTJweDtvdmVyZmxvdzphdXRvO31wcmUgY29kZXtiYWNrZ3JvdW5kOnRyYW5zcGFyZW50O3BhZGRpbmc6MDtjb2xvcjppbmhlcml0O308L3N0eWxlPjwvaGVhZD48Ym9keT4ke2JvZHlIdG1sfTwvYm9keT48L2h0bWw+YDtcbn1cblxuZnVuY3Rpb24gbG9va3NMaWtlSHRtbCh0ZXh0OiBzdHJpbmcpIHtcbiAgY29uc3QgdHJpbW1lZCA9ICh0ZXh0IHx8IFwiXCIpLnRyaW0oKTtcbiAgaWYgKCF0cmltbWVkKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmICh0cmltbWVkLnN0YXJ0c1dpdGgoXCI8IWRvY3R5cGVcIikgfHwgdHJpbW1lZC5zdGFydHNXaXRoKFwiPGh0bWxcIikgfHwgdHJpbW1lZC5zdGFydHNXaXRoKFwiPFwiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiAvPGJvZHlbXFxzPl0vaS50ZXN0KHRyaW1tZWQpIHx8IC88XFwvW2Etel1bXFxzPl0vaS50ZXN0KHRyaW1tZWQpO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0QWdlbnRPdXRwdXQoYWdlbnREYXRhOiBhbnkpIHtcbiAgY29uc3QgY2FuZGlkYXRlcyA9IFtcbiAgICBhZ2VudERhdGE/LmFuc3dlcixcbiAgICBhZ2VudERhdGE/Lm91dHB1dCxcbiAgICBhZ2VudERhdGE/LnJlc3VsdCxcbiAgICBhZ2VudERhdGE/LmRhdGE/LmFuc3dlcixcbiAgICBhZ2VudERhdGE/LmRhdGE/Lm91dHB1dCxcbiAgICBhZ2VudERhdGE/LmRhdGE/LnJlc3VsdCxcbiAgICBhZ2VudERhdGE/LmRhdGE/Lm91dHB1dHM/LnRleHQsXG4gICAgYWdlbnREYXRhPy5kYXRhPy5vdXRwdXRzPy5vdXRwdXQsXG4gICAgYWdlbnREYXRhPy5kYXRhPy5vdXRwdXRzPy5yZXN1bHQsXG4gICAgYWdlbnREYXRhPy5vdXRwdXRzPy50ZXh0LFxuICAgIGFnZW50RGF0YT8ub3V0cHV0cz8ub3V0cHV0LFxuICAgIGFnZW50RGF0YT8ub3V0cHV0cz8ucmVzdWx0LFxuICAgIGFnZW50RGF0YT8ubWVzc2FnZT8uY29udGVudFxuICBdO1xuXG4gIGZvciAoY29uc3QgdmFsdWUgb2YgY2FuZGlkYXRlcykge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgJiYgdmFsdWUudHJpbSgpKSB7XG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBcIlwiO1xufVxuXG5mdW5jdGlvbiBpc0V4Y2VsQXR0YWNobWVudChwYXJhbXM6IHsgZmlsZU5hbWU6IHN0cmluZzsgbWltZVR5cGU6IHN0cmluZyB9KSB7XG4gIGNvbnN0IG5hbWUgPSAocGFyYW1zLmZpbGVOYW1lIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IG1pbWUgPSAocGFyYW1zLm1pbWVUeXBlIHx8IFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gIGlmIChuYW1lLmVuZHNXaXRoKFwiLnhsc3hcIikgfHwgbmFtZS5lbmRzV2l0aChcIi54bHNcIikpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAobWltZS5pbmNsdWRlcyhcInNwcmVhZHNoZWV0XCIpIHx8IG1pbWUuaW5jbHVkZXMoXCJleGNlbFwiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gc2FuaXRpemVTaGVldE5hbWUobmFtZTogc3RyaW5nKSB7XG4gIGNvbnN0IHZhbHVlID0gKG5hbWUgfHwgXCJcIikudHJpbSgpO1xuICBpZiAoIXZhbHVlKSB7XG4gICAgcmV0dXJuIFwiU2hlZXRcIjtcbiAgfVxuICByZXR1cm4gdmFsdWUubGVuZ3RoID4gODAgPyB2YWx1ZS5zbGljZSgwLCA4MCkgOiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZXh0cmFjdEV4Y2VsTWFya2Rvd25Gcm9tQnVmZmVyKGJ1ZmZlcjogQnVmZmVyLCBmaWxlTmFtZTogc3RyaW5nKSB7XG4gIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGJ1ZmZlciwgeyB0eXBlOiBcImJ1ZmZlclwiLCBjZWxsRGF0ZXM6IHRydWUsIGNlbGxUZXh0OiBmYWxzZSB9KTtcbiAgY29uc3Qgc2hlZXROYW1lcyA9IEFycmF5LmlzQXJyYXkod29ya2Jvb2suU2hlZXROYW1lcykgPyB3b3JrYm9vay5TaGVldE5hbWVzIDogW107XG4gIGNvbnN0IG91dHB1dHM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IG1heFJvd3NQZXJTaGVldCA9IDIwMDtcblxuICBmb3IgKGNvbnN0IG5hbWUgb2Ygc2hlZXROYW1lcykge1xuICAgIGNvbnN0IHNoZWV0ID0gd29ya2Jvb2suU2hlZXRzID8gKHdvcmtib29rLlNoZWV0cyBhcyBhbnkpW25hbWVdIDogbnVsbDtcbiAgICBpZiAoIXNoZWV0KSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgY29uc3QgbWF0cml4ID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHNoZWV0LCB7XG4gICAgICBoZWFkZXI6IDEsXG4gICAgICByYXc6IHRydWUsXG4gICAgICBibGFua3Jvd3M6IGZhbHNlLFxuICAgICAgZGVmdmFsOiBcIlwiXG4gICAgfSkgYXMgYW55W11bXTtcbiAgICBjb25zdCBzbGljZWQgPSBBcnJheS5pc0FycmF5KG1hdHJpeCkgPyBtYXRyaXguc2xpY2UoMCwgbWF4Um93c1BlclNoZWV0KSA6IFtdO1xuICAgIGlmICghc2xpY2VkLmxlbmd0aCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIG91dHB1dHMucHVzaChcbiAgICAgIGAjIyMgJHtzYW5pdGl6ZVNoZWV0TmFtZShuYW1lKX1cXG5cXG5cXGBcXGBcXGBqc29uXFxuJHtKU09OLnN0cmluZ2lmeShzbGljZWQpfVxcblxcYFxcYFxcYGBcbiAgICApO1xuICB9XG5cbiAgaWYgKCFvdXRwdXRzLmxlbmd0aCkge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiBgIyMg6ZmE5Lu2RXhjZWzop6PmnpDnu5PmnpzvvJoke2ZpbGVOYW1lfVxcblxcbiR7b3V0cHV0cy5qb2luKFwiXFxuXFxuXCIpfWA7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoV2l0aFRpbWVvdXQodXJsOiBzdHJpbmcsIGluaXQ6IFJlcXVlc3RJbml0LCB0aW1lb3V0TXM6IG51bWJlcikge1xuICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCB0aW1lb3V0TXMpO1xuICB0cnkge1xuICAgIHJldHVybiBhd2FpdCBmZXRjaCh1cmwsIHsgLi4uaW5pdCwgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCB9KTtcbiAgfSBmaW5hbGx5IHtcbiAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNsZWVwKG1zOiBudW1iZXIpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlPHZvaWQ+KChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbmZ1bmN0aW9uIGdldEZldGNoQ2F1c2VJbmZvKGVycm9yOiBhbnkpIHtcbiAgY29uc3QgY2F1c2UgPSBlcnJvciAmJiB0eXBlb2YgZXJyb3IgPT09IFwib2JqZWN0XCIgPyAoZXJyb3IgYXMgYW55KS5jYXVzZSA6IG51bGw7XG4gIGNvbnN0IGNvZGUgPSBjYXVzZSAmJiB0eXBlb2YgY2F1c2UuY29kZSA9PT0gXCJzdHJpbmdcIiA/IGNhdXNlLmNvZGUgOiBcIlwiO1xuICBjb25zdCBtZXNzYWdlID0gY2F1c2UgJiYgdHlwZW9mIGNhdXNlLm1lc3NhZ2UgPT09IFwic3RyaW5nXCIgPyBjYXVzZS5tZXNzYWdlIDogXCJcIjtcbiAgcmV0dXJuIHsgY29kZSwgbWVzc2FnZSB9O1xufVxuXG5mdW5jdGlvbiBmb3JtYXRGZXRjaEVycm9yKGVycm9yOiBhbnkpIHtcbiAgY29uc3QgbmFtZSA9IGVycm9yICYmIHR5cGVvZiBlcnJvci5uYW1lID09PSBcInN0cmluZ1wiID8gZXJyb3IubmFtZSA6IFwiXCI7XG4gIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gXCJzdHJpbmdcIiA/IGVycm9yLm1lc3NhZ2UgOiBcIlwiO1xuICBjb25zdCB7IGNvZGUsIG1lc3NhZ2U6IGNhdXNlTWVzc2FnZSB9ID0gZ2V0RmV0Y2hDYXVzZUluZm8oZXJyb3IpO1xuICBjb25zdCBwYXJ0cyA9IFttZXNzYWdlIHx8IG5hbWUgfHwgXCLor7fmsYLlpLHotKVcIl07XG4gIGlmIChjb2RlKSB7XG4gICAgcGFydHMucHVzaChgY29kZT0ke2NvZGV9YCk7XG4gIH1cbiAgaWYgKGNhdXNlTWVzc2FnZSAmJiBjYXVzZU1lc3NhZ2UgIT09IG1lc3NhZ2UpIHtcbiAgICBwYXJ0cy5wdXNoKGNhdXNlTWVzc2FnZSk7XG4gIH1cbiAgcmV0dXJuIHBhcnRzLmpvaW4oXCIgfCBcIik7XG59XG5cbmZ1bmN0aW9uIGlzUmV0cnlhYmxlRmV0Y2hFcnJvcihlcnJvcjogYW55KSB7XG4gIGNvbnN0IG1lc3NhZ2UgPSBlcnJvciAmJiB0eXBlb2YgZXJyb3IubWVzc2FnZSA9PT0gXCJzdHJpbmdcIiA/IGVycm9yLm1lc3NhZ2UgOiBcIlwiO1xuICBjb25zdCBsb3dlciA9IG1lc3NhZ2UudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgeyBjb2RlIH0gPSBnZXRGZXRjaENhdXNlSW5mbyhlcnJvcik7XG4gIGlmIChsb3dlci5pbmNsdWRlcyhcImZldGNoIGZhaWxlZFwiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChsb3dlci5pbmNsdWRlcyhcInNvY2tldCBoYW5nIHVwXCIpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKGxvd2VyLmluY2x1ZGVzKFwidGhlIG9wZXJhdGlvbiB3YXMgYWJvcnRlZFwiKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHJldHJ5YWJsZUNvZGVzID0gbmV3IFNldChbXG4gICAgXCJFQ09OTlJFU0VUXCIsXG4gICAgXCJFQ09OTlJFRlVTRURcIixcbiAgICBcIkVUSU1FRE9VVFwiLFxuICAgIFwiRUFJX0FHQUlOXCIsXG4gICAgXCJFTk9URk9VTkRcIixcbiAgICBcIkVIT1NUVU5SRUFDSFwiLFxuICAgIFwiRU5FVFVOUkVBQ0hcIlxuICBdKTtcbiAgaWYgKGNvZGUgJiYgcmV0cnlhYmxlQ29kZXMuaGFzKGNvZGUpKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFdpdGhUaW1lb3V0UmV0cnkoXG4gIHVybDogc3RyaW5nLFxuICBpbml0OiBSZXF1ZXN0SW5pdCxcbiAgdGltZW91dE1zOiBudW1iZXIsXG4gIHJldHJpZXM6IG51bWJlclxuKSB7XG4gIGxldCBsYXN0RXJyb3I6IGFueSA9IG51bGw7XG4gIGZvciAobGV0IGF0dGVtcHQgPSAwOyBhdHRlbXB0IDw9IHJldHJpZXM7IGF0dGVtcHQgKz0gMSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgZmV0Y2hXaXRoVGltZW91dCh1cmwsIGluaXQsIHRpbWVvdXRNcyk7XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICBsYXN0RXJyb3IgPSBlO1xuICAgICAgaWYgKGF0dGVtcHQgPj0gcmV0cmllcyB8fCAhaXNSZXRyeWFibGVGZXRjaEVycm9yKGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXRGZXRjaEVycm9yKGUpKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGRlbGF5ID0gNTAwICogTWF0aC5wb3coMiwgYXR0ZW1wdCk7XG4gICAgICBhd2FpdCBzbGVlcChkZWxheSk7XG4gICAgfVxuICB9XG4gIHRocm93IG5ldyBFcnJvcihmb3JtYXRGZXRjaEVycm9yKGxhc3RFcnJvcikpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBtYXBXaXRoQ29uY3VycmVuY3k8VCwgUj4oXG4gIGl0ZW1zOiBUW10sXG4gIGxpbWl0OiBudW1iZXIsXG4gIGZuOiAoaXRlbTogVCkgPT4gUHJvbWlzZTxSPlxuKTogUHJvbWlzZTxSW10+IHtcbiAgY29uc3QgcmVzdWx0czogUltdID0gW107XG4gIGxldCBjdXJzb3IgPSAwO1xuICBjb25zdCB3b3JrZXIgPSBhc3luYyAoKSA9PiB7XG4gICAgd2hpbGUgKGN1cnNvciA8IGl0ZW1zLmxlbmd0aCkge1xuICAgICAgY29uc3QgY3VycmVudCA9IGl0ZW1zW2N1cnNvcl07XG4gICAgICBjdXJzb3IgKz0gMTtcbiAgICAgIHJlc3VsdHMucHVzaChhd2FpdCBmbihjdXJyZW50KSk7XG4gICAgfVxuICB9O1xuICBjb25zdCBjb3VudCA9IE1hdGgubWF4KDEsIE1hdGgubWluKGxpbWl0LCBpdGVtcy5sZW5ndGgpKTtcbiAgYXdhaXQgUHJvbWlzZS5hbGwoQXJyYXkuZnJvbSh7IGxlbmd0aDogY291bnQgfSwgKCkgPT4gd29ya2VyKCkpKTtcbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGNhbGxBZ2VudFN0cmVhbWluZyhwYXJhbXM6IHtcbiAgdXJsOiBzdHJpbmc7XG4gIGFwaUtleTogc3RyaW5nO1xuICBwYXlsb2FkOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufSkge1xuICBjb25zdCByZXRyaWVzID0gMTtcbiAgbGV0IGxhc3RFcnJvcjogYW55ID0gbnVsbDtcblxuICBmb3IgKGxldCBhdHRlbXB0ID0gMDsgYXR0ZW1wdCA8PSByZXRyaWVzOyBhdHRlbXB0ICs9IDEpIHtcbiAgICBjb25zdCBjb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO1xuICAgIGNvbnN0IHRpbWVvdXRNcyA9IDE4MF8wMDA7XG4gICAgY29uc3QgdGltZXIgPSBzZXRUaW1lb3V0KCgpID0+IGNvbnRyb2xsZXIuYWJvcnQoKSwgdGltZW91dE1zKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChwYXJhbXMudXJsLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7cGFyYW1zLmFwaUtleX1gXG4gICAgICAgIH0sXG4gICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgLi4ucGFyYW1zLnBheWxvYWQsIHJlc3BvbnNlX21vZGU6IFwic3RyZWFtaW5nXCIgfSksXG4gICAgICAgIHNpZ25hbDogY29udHJvbGxlci5zaWduYWxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IHJhd1RleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7XG4gICAgICAgIGxldCBhZ2VudERhdGE6IGFueSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYWdlbnREYXRhID0gcmF3VGV4dCA/IEpTT04ucGFyc2UocmF3VGV4dCkgOiBudWxsO1xuICAgICAgICB9IGNhdGNoIHtcbiAgICAgICAgICBhZ2VudERhdGEgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJhd01lc3NhZ2UgPSAoYWdlbnREYXRhICYmIChhZ2VudERhdGEuZXJyb3IgfHwgYWdlbnREYXRhLm1lc3NhZ2UpKSB8fCByYXdUZXh0IHx8IFwiXCI7XG4gICAgICAgIGNvbnN0IHRyaW1tZWRNZXNzYWdlID1cbiAgICAgICAgICB0eXBlb2YgcmF3TWVzc2FnZSA9PT0gXCJzdHJpbmdcIlxuICAgICAgICAgICAgPyByYXdNZXNzYWdlLnNsaWNlKDAsIDMwMClcbiAgICAgICAgICAgIDogU3RyaW5nKHJhd01lc3NhZ2UpLnNsaWNlKDAsIDMwMCk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICB0cmltbWVkTWVzc2FnZVxuICAgICAgICAgICAgPyBgQWdlbnTor7fmsYLlpLHotKU6ICR7cmVzcG9uc2Uuc3RhdHVzfSAke3RyaW1tZWRNZXNzYWdlfWBcbiAgICAgICAgICAgIDogYEFnZW506K+35rGC5aSx6LSlOiAke3Jlc3BvbnNlLnN0YXR1c31gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghcmVzcG9uc2UuYm9keSkge1xuICAgICAgICBjb25zdCByYXdUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpO1xuICAgICAgICBjb25zdCB0cmltbWVkID0gKHJhd1RleHQgfHwgXCJcIikudHJpbSgpO1xuICAgICAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKFwiPFwiKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiQWdlbnTov5Tlm57pnZ5KU09O77yI55aR5Ly8SFRNTOmhtemdou+8ie+8jOivt+ajgOafpUNSTV9WM19BR0VOVF9BUElfVVJM5piv5ZCm5Li6L3YxL2NoYXQtbWVzc2FnZXPmjqXlj6NcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2h1bmtzID0gcmF3VGV4dC5zcGxpdChcIlxcblxcblwiKTtcbiAgICAgICAgbGV0IG91dHB1dCA9IFwiXCI7XG4gICAgICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7XG4gICAgICAgICAgY29uc3QgbGluZXMgPSBjaHVuay5zcGxpdChcIlxcblwiKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWRMaW5lID0gbGluZS50cmltKCk7XG4gICAgICAgICAgICBpZiAoIXRyaW1tZWRMaW5lLnN0YXJ0c1dpdGgoXCJkYXRhOlwiKSkge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRhdGFQYXJ0ID0gdHJpbW1lZExpbmUuc2xpY2UoNSkudHJpbSgpO1xuICAgICAgICAgICAgaWYgKCFkYXRhUGFydCB8fCBkYXRhUGFydCA9PT0gXCJbRE9ORV1cIikge1xuICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBqc29uOiBhbnkgPSBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAganNvbiA9IEpTT04ucGFyc2UoZGF0YVBhcnQpO1xuICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgIGpzb24gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFqc29uKSB7XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcGllY2UgPSBleHRyYWN0QWdlbnRPdXRwdXQoanNvbik7XG4gICAgICAgICAgICBpZiAocGllY2UpIHtcbiAgICAgICAgICAgICAgb3V0cHV0ICs9IHBpZWNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0cHV0LnRyaW0oKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcihcInV0Zi04XCIpO1xuICAgICAgY29uc3QgcmVhZGVyID0gKHJlc3BvbnNlLmJvZHkgYXMgYW55KS5nZXRSZWFkZXIoKTtcblxuICAgICAgbGV0IG91dHB1dCA9IFwiXCI7XG4gICAgICBsZXQgYnVmZmVyID0gXCJcIjtcbiAgICAgIGxldCBmaW5pc2hlZCA9IGZhbHNlO1xuXG4gICAgICBjb25zdCBwcm9jZXNzQmxvY2sgPSAoYmxvY2s6IHN0cmluZykgPT4ge1xuICAgICAgICBjb25zdCBsaW5lcyA9IGJsb2NrLnNwbGl0KFwiXFxuXCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICBjb25zdCB0cmltbWVkTGluZSA9IGxpbmUudHJpbSgpO1xuICAgICAgICAgIGlmICghdHJpbW1lZExpbmUuc3RhcnRzV2l0aChcImRhdGE6XCIpKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgZGF0YVBhcnQgPSB0cmltbWVkTGluZS5zbGljZSg1KS50cmltKCk7XG4gICAgICAgICAgaWYgKCFkYXRhUGFydCB8fCBkYXRhUGFydCA9PT0gXCJbRE9ORV1cIikge1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCBqc29uOiBhbnkgPSBudWxsO1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBqc29uID0gSlNPTi5wYXJzZShkYXRhUGFydCk7XG4gICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICBqc29uID0gbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFqc29uKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgcGllY2UgPSBleHRyYWN0QWdlbnRPdXRwdXQoanNvbik7XG4gICAgICAgICAgaWYgKHBpZWNlKSB7XG4gICAgICAgICAgICBpZiAoanNvbi5ldmVudCA9PT0gXCJtZXNzYWdlX2VuZFwiKSB7XG4gICAgICAgICAgICAgIGlmIChwaWVjZS5sZW5ndGggPiBvdXRwdXQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgb3V0cHV0ID0gcGllY2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG91dHB1dCArPSBwaWVjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAganNvbi5ldmVudCA9PT0gXCJtZXNzYWdlX2VuZFwiIHx8XG4gICAgICAgICAgICBqc29uLmV2ZW50ID09PSBcIndvcmtmbG93X2ZpbmlzaGVkXCIgfHxcbiAgICAgICAgICAgIGpzb24uZXZlbnQgPT09IFwiY29udmVyc2F0aW9uX2VuZFwiXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICBmaW5pc2hlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBjb25zdCB7IHZhbHVlLCBkb25lIH0gPSBhd2FpdCByZWFkZXIucmVhZCgpO1xuICAgICAgICBpZiAoZG9uZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGJ1ZmZlciArPSBkZWNvZGVyLmRlY29kZSh2YWx1ZSwgeyBzdHJlYW06IHRydWUgfSk7XG4gICAgICAgIGxldCBpbmRleCA9IGJ1ZmZlci5pbmRleE9mKFwiXFxuXFxuXCIpO1xuICAgICAgICB3aGlsZSAoaW5kZXggPj0gMCkge1xuICAgICAgICAgIGNvbnN0IGJsb2NrID0gYnVmZmVyLnNsaWNlKDAsIGluZGV4KTtcbiAgICAgICAgICBidWZmZXIgPSBidWZmZXIuc2xpY2UoaW5kZXggKyAyKTtcbiAgICAgICAgICBwcm9jZXNzQmxvY2soYmxvY2spO1xuICAgICAgICAgIGlmIChmaW5pc2hlZCkge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIGluZGV4ID0gYnVmZmVyLmluZGV4T2YoXCJcXG5cXG5cIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbmlzaGVkKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFmaW5pc2hlZCAmJiBidWZmZXIudHJpbSgpKSB7XG4gICAgICAgIHByb2Nlc3NCbG9jayhidWZmZXIpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gb3V0cHV0LnRyaW0oKTtcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIGxhc3RFcnJvciA9IGU7XG4gICAgICBpZiAoYXR0ZW1wdCA+PSByZXRyaWVzIHx8ICFpc1JldHJ5YWJsZUZldGNoRXJyb3IoZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdEZldGNoRXJyb3IoZSkpO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2xlZXAoNjAwICogKGF0dGVtcHQgKyAxKSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgfVxuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdEZldGNoRXJyb3IobGFzdEVycm9yKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZldGNoQXR0YWNobWVudHNCeVRlbXBsYXRlSWQodGVtcGxhdGVJZDogc3RyaW5nKSB7XG4gIGNvbnN0IHNlbGVjdENvbHVtbnNDYW5kaWRhdGVzID0gW1xuICAgIFwiaWQsZmlsZV9uYW1lLGZpbGVfcGF0aCxmaWxlX3NpemUsbWltZV90eXBlLGNyZWF0ZWRfYXQsY3JlYXRlZF9ieSx0ZW1wbGF0ZV9pZFwiLFxuICAgIFwiaWQsZmlsZV9uYW1lLGZpbGVfcGF0aCxmaWxlX3NpemUsbWltZV90eXBlLGNyZWF0ZWRfYXQsY3JlYXRlZF9ieSx0ZW1wX2lkXCJcbiAgXTtcbiAgY29uc3QgdHJ5RmllbGRzID0gW1widGVtcGxhdGVfaWRcIiwgXCJ0ZW1wX2lkXCJdO1xuICBsZXQgbGFzdEVycm9yOiBhbnkgPSBudWxsO1xuXG4gIGZvciAoY29uc3Qgc2VsZWN0Q29sdW1ucyBvZiBzZWxlY3RDb2x1bW5zQ2FuZGlkYXRlcykge1xuICAgIGZvciAoY29uc3QgZmllbGQgb2YgdHJ5RmllbGRzKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCAoYWRtaW5TdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKFwiZG9jdW1lbnRfdGVtcGxhdGVfYXR0YWNobWVudHNcIilcbiAgICAgICAgLnNlbGVjdChzZWxlY3RDb2x1bW5zKVxuICAgICAgICAuZXEoZmllbGQsIHRlbXBsYXRlSWQpXG4gICAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiBbXTtcbiAgICAgIH1cbiAgICAgIGxhc3RFcnJvciA9IGVycm9yO1xuICAgICAgaWYgKCEvY29sdW1uIC4qIGRvZXMgbm90IGV4aXN0L2kudGVzdChlcnJvci5tZXNzYWdlIHx8IFwiXCIpKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChsYXN0RXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IobGFzdEVycm9yLm1lc3NhZ2UgfHwgXCLmn6Xor6LpmYTku7blpLHotKVcIik7XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuXG5mdW5jdGlvbiBidWlsZFVwbG9hZFVybChjaGF0TWVzc2FnZXNVcmw6IHN0cmluZykge1xuICBjb25zdCB1cmwgPSBuZXcgVVJMKGNoYXRNZXNzYWdlc1VybCk7XG4gIGNvbnN0IHBhcnRzID0gdXJsLnBhdGhuYW1lLnNwbGl0KFwiL1wiKS5maWx0ZXIoQm9vbGVhbik7XG4gIGNvbnN0IGNoYXRJbmRleCA9IHBhcnRzLmxhc3RJbmRleE9mKFwiY2hhdC1tZXNzYWdlc1wiKTtcbiAgY29uc3QgcGFydHNCZWZvcmVDaGF0ID0gY2hhdEluZGV4ID49IDAgPyBwYXJ0cy5zbGljZSgwLCBjaGF0SW5kZXgpIDogcGFydHM7XG4gIGNvbnN0IHYxSW5kZXggPSBwYXJ0c0JlZm9yZUNoYXQubGFzdEluZGV4T2YoXCJ2MVwiKTtcblxuICBpZiAodjFJbmRleCA+PSAwKSB7XG4gICAgY29uc3QgYmFzZVBhcnRzID0gcGFydHNCZWZvcmVDaGF0LnNsaWNlKDAsIHYxSW5kZXggKyAxKTtcbiAgICB1cmwucGF0aG5hbWUgPSBgLyR7YmFzZVBhcnRzLmpvaW4oXCIvXCIpfS9maWxlcy91cGxvYWRgO1xuICAgIHJldHVybiB1cmwudG9TdHJpbmcoKTtcbiAgfVxuXG4gIHVybC5wYXRobmFtZSA9IFwiL2ZpbGVzL3VwbG9hZFwiO1xuICByZXR1cm4gdXJsLnRvU3RyaW5nKCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZEZpbGVUb0RpZnkocGFyYW1zOiB7XG4gIHVwbG9hZFVybDogc3RyaW5nO1xuICBhcGlLZXk6IHN0cmluZztcbiAgdXNlcjogc3RyaW5nO1xuICBmaWxlTmFtZTogc3RyaW5nO1xuICBtaW1lVHlwZTogc3RyaW5nO1xuICBidWZmZXI6IEJ1ZmZlcjtcbn0pIHtcbiAgY29uc3QgcmV0cmllcyA9IDE7XG4gIGxldCBsYXN0RXJyb3I6IGFueSA9IG51bGw7XG5cbiAgZm9yIChsZXQgYXR0ZW1wdCA9IDA7IGF0dGVtcHQgPD0gcmV0cmllczsgYXR0ZW1wdCArPSAxKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZvcm0gPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgIGNvbnN0IGJsb2JQYXJ0ID0gbmV3IFVpbnQ4QXJyYXkocGFyYW1zLmJ1ZmZlcik7XG4gICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2Jsb2JQYXJ0XSwge1xuICAgICAgICB0eXBlOiBwYXJhbXMubWltZVR5cGUgfHwgXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIlxuICAgICAgfSk7XG4gICAgICBmb3JtLmFwcGVuZChcImZpbGVcIiwgYmxvYiwgcGFyYW1zLmZpbGVOYW1lKTtcbiAgICAgIGZvcm0uYXBwZW5kKFwidXNlclwiLCBwYXJhbXMudXNlcik7XG5cbiAgICAgIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7XG4gICAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCA5MF8wMDApO1xuICAgICAgY29uc3QgdXBsb2FkUmVzID0gYXdhaXQgZmV0Y2gocGFyYW1zLnVwbG9hZFVybCwge1xuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3BhcmFtcy5hcGlLZXl9YFxuICAgICAgICB9LFxuICAgICAgICBib2R5OiBmb3JtIGFzIGFueSxcbiAgICAgICAgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbFxuICAgICAgfSkuZmluYWxseSgoKSA9PiBjbGVhclRpbWVvdXQodGltZXIpKTtcblxuICAgICAgY29uc3QgdXBsb2FkVGV4dCA9IGF3YWl0IHVwbG9hZFJlcy50ZXh0KCk7XG4gICAgICBsZXQgdXBsb2FkSnNvbjogYW55ID0gbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIHVwbG9hZEpzb24gPSB1cGxvYWRUZXh0ID8gSlNPTi5wYXJzZSh1cGxvYWRUZXh0KSA6IG51bGw7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgdXBsb2FkSnNvbiA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIGlmICghdXBsb2FkUmVzLm9rKSB7XG4gICAgICAgIGNvbnN0IHJhd01lc3NhZ2UgPVxuICAgICAgICAgICh1cGxvYWRKc29uICYmICh1cGxvYWRKc29uLmVycm9yIHx8IHVwbG9hZEpzb24ubWVzc2FnZSkpIHx8IHVwbG9hZFRleHQgfHwgXCJcIjtcbiAgICAgICAgY29uc3QgdHJpbW1lZE1lc3NhZ2UgPVxuICAgICAgICAgIHR5cGVvZiByYXdNZXNzYWdlID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgICA/IHJhd01lc3NhZ2Uuc2xpY2UoMCwgMzAwKVxuICAgICAgICAgICAgOiBTdHJpbmcocmF3TWVzc2FnZSkuc2xpY2UoMCwgMzAwKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIHRyaW1tZWRNZXNzYWdlXG4gICAgICAgICAgICA/IGDpmYTku7bkuIrkvKDlpLHotKU6ICR7dXBsb2FkUmVzLnN0YXR1c30gJHt0cmltbWVkTWVzc2FnZX1gXG4gICAgICAgICAgICA6IGDpmYTku7bkuIrkvKDlpLHotKU6ICR7dXBsb2FkUmVzLnN0YXR1c31gXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwbG9hZEZpbGVJZCA9XG4gICAgICAgICh1cGxvYWRKc29uICYmICh1cGxvYWRKc29uLmlkIHx8IHVwbG9hZEpzb24uZmlsZV9pZCB8fCB1cGxvYWRKc29uLmZpbGVJZCkpIHx8IFwiXCI7XG4gICAgICBpZiAoIXVwbG9hZEZpbGVJZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCLpmYTku7bkuIrkvKDmnKrov5Tlm57mlofku7ZJRFwiKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIFN0cmluZyh1cGxvYWRGaWxlSWQpO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbGFzdEVycm9yID0gZTtcbiAgICAgIGlmIChhdHRlbXB0ID49IHJldHJpZXMgfHwgIWlzUmV0cnlhYmxlRmV0Y2hFcnJvcihlKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0RmV0Y2hFcnJvcihlKSk7XG4gICAgICB9XG4gICAgICBhd2FpdCBzbGVlcCg2MDAgKiAoYXR0ZW1wdCArIDEpKTtcbiAgICB9XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0RmV0Y2hFcnJvcihsYXN0RXJyb3IpKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXE6IE5leHRBcGlSZXF1ZXN0LCByZXM6IE5leHRBcGlSZXNwb25zZSkge1xuICBjb25zdCBleHBlY3RlZFRva2VuID0gcHJvY2Vzcy5lbnYuQ1JNX0FQSV9UT0tFTjtcbiAgY29uc3QgaGVhZGVyVG9rZW4gPSByZXEuaGVhZGVyc1tcIngtY3JtLXRva2VuXCJdO1xuICBjb25zdCB0b2tlbiA9IEFycmF5LmlzQXJyYXkoaGVhZGVyVG9rZW4pID8gaGVhZGVyVG9rZW5bMF0gOiBoZWFkZXJUb2tlbjtcbiAgaWYgKGV4cGVjdGVkVG9rZW4gJiYgdG9rZW4gIT09IGV4cGVjdGVkVG9rZW4pIHtcbiAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7IGVycm9yOiBcIlVuYXV0aG9yaXplZFwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghc3VwYWJhc2VVcmwgfHwgIXN1cGFiYXNlS2V5KSB7XG4gICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogXCJTdXBhYmFzZemFjee9rue8uuWksVwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghYWdlbnRBcGlVcmwpIHtcbiAgICByZXNcbiAgICAgIC5zdGF0dXMoNTAwKVxuICAgICAgLmpzb24oeyBlcnJvcjogXCJDUk0gVjMgQWdlbnTmnKrphY3nva7vvIjnvLrlsJFDUk1fVjNfQUdFTlRfQVBJX1VSTO+8iVwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICghYWdlbnRBcGlLZXkpIHtcbiAgICByZXNcbiAgICAgIC5zdGF0dXMoNTAwKVxuICAgICAgLmpzb24oeyBlcnJvcjogXCJDUk0gVjMgQWdlbnTlr4bpkqXmnKrphY3nva7vvIjnvLrlsJFDUk1fVjNfQUdFTlRfQVBJX0tFWe+8iVwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IHsgaWQgfSA9IHJlcS5xdWVyeTtcbiAgY29uc3QgdGVtcGxhdGVJZCA9IHR5cGVvZiBpZCA9PT0gXCJzdHJpbmdcIiA/IGlkIDogXCJcIjtcbiAgaWYgKCF0ZW1wbGF0ZUlkKSB7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCLnvLrlsJHmqKHmnb9JRFwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikge1xuICAgIHJlcy5zZXRIZWFkZXIoXCJBbGxvd1wiLCBcIlBPU1RcIik7XG4gICAgcmVzLnN0YXR1cyg0MDUpLmVuZChcIk1ldGhvZCBOb3QgQWxsb3dlZFwiKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCBib2R5ID0gKHJlcS5ib2R5IHx8IHt9KSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBjb25zdCB0ZXh0ID0gdG9TdHJpbmdTYWZlKGJvZHkudGV4dCk7XG4gIGNvbnN0IHRhcmdldEZpbGVSYXcgPSB0b1N0cmluZ1NhZmUoYm9keS50YXJnZXRGaWxlKTtcbiAgY29uc3QgdGFyZ2V0RmlsZSA9IG5vcm1hbGl6ZVRhcmdldEZpbGUodGFyZ2V0RmlsZVJhdywgdGVtcGxhdGVJZCk7XG4gIGxldCB0ZW1wbGF0ZU5hbWUgPSB0b1N0cmluZ1NhZmUoYm9keS50ZW1wbGF0ZU5hbWUpO1xuICBsZXQgcmVwb3J0VGl0bGUgPSB0b1N0cmluZ1NhZmUoYm9keS5yZXBvcnRUaXRsZSk7XG4gIGNvbnN0IGRlcGFydG1lbnQgPSB0b1N0cmluZ1NhZmUoYm9keS5kZXBhcnRtZW50KTtcbiAgY29uc3QgcmVwb3J0RGF0ZSA9IHRvU3RyaW5nU2FmZShib2R5LnJlcG9ydERhdGUpO1xuICBjb25zdCBjbGFzc2lmaWNhdGlvblJhdyA9IGJvZHkuY2xhc3NpZmljYXRpb247XG4gIGNvbnN0IGNsYXNzaWZpY2F0aW9uID1cbiAgICB0eXBlb2YgY2xhc3NpZmljYXRpb25SYXcgPT09IFwibnVtYmVyXCJcbiAgICAgID8gY2xhc3NpZmljYXRpb25SYXdcbiAgICAgIDogdHlwZW9mIGNsYXNzaWZpY2F0aW9uUmF3ID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gTnVtYmVyKGNsYXNzaWZpY2F0aW9uUmF3KVxuICAgICAgICA6IE5hTjtcbiAgY29uc3QgY2xhc3NpZmljYXRpb25WYWx1ZSA9IE51bWJlci5pc0Zpbml0ZShjbGFzc2lmaWNhdGlvbikgPyBjbGFzc2lmaWNhdGlvbiA6IDY7XG4gIGNvbnN0IGF0dGFjaG1lbnRJZHNSYXcgPSBBcnJheS5pc0FycmF5KGJvZHkuYXR0YWNobWVudElkcykgPyBib2R5LmF0dGFjaG1lbnRJZHMgOiBbXTtcbiAgY29uc3QgYXR0YWNobWVudElkcyA9IGF0dGFjaG1lbnRJZHNSYXdcbiAgICAubWFwKChpdGVtOiBhbnkpID0+IHRvU3RyaW5nU2FmZShpdGVtKSlcbiAgICAuZmlsdGVyKCh2YWx1ZSkgPT4gdmFsdWUpO1xuXG4gIHRyeSB7XG4gICAgY29uc3QgYXR0YWNobWVudFJvd3MgPSBhd2FpdCBmZXRjaEF0dGFjaG1lbnRzQnlUZW1wbGF0ZUlkKHRlbXBsYXRlSWQpO1xuICAgIGNvbnN0IHNlbGVjdGVkUm93cyA9IGF0dGFjaG1lbnRJZHMubGVuZ3RoXG4gICAgICA/IGF0dGFjaG1lbnRSb3dzLmZpbHRlcigocm93OiBhbnkpID0+IGF0dGFjaG1lbnRJZHMuaW5jbHVkZXMoU3RyaW5nKHJvdy5pZCkpKVxuICAgICAgOiBhdHRhY2htZW50Um93cztcblxuICAgIGNvbnN0IHVzZXIgPSBgdGVtcGxhdGUtJHt0ZW1wbGF0ZUlkfWA7XG5cbiAgICBjb25zdCBmaWxlczogYW55W10gPSBbXTtcbiAgICBjb25zdCBhdHRhY2htZW50RXh0cmFjdHM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoc2VsZWN0ZWRSb3dzLmxlbmd0aCkge1xuICAgICAgY29uc3QgdXBsb2FkVXJsID0gYnVpbGRVcGxvYWRVcmwoYWdlbnRBcGlVcmwpO1xuICAgICAgY29uc3QgdXBsb2FkZWQgPSBhd2FpdCBtYXBXaXRoQ29uY3VycmVuY3koc2VsZWN0ZWRSb3dzLCAzLCBhc3luYyAocm93OiBhbnkpID0+IHtcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSByb3cgJiYgcm93LmZpbGVfcGF0aCA/IFN0cmluZyhyb3cuZmlsZV9wYXRoKSA6IFwiXCI7XG4gICAgICAgIGNvbnN0IGZpbGVOYW1lID0gcm93ICYmIHJvdy5maWxlX25hbWUgPyBTdHJpbmcocm93LmZpbGVfbmFtZSkgOiBcIlwiO1xuICAgICAgICBpZiAoIWZpbGVQYXRoIHx8ICFmaWxlTmFtZSkge1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGxldCBzdGF0OiBhbnkgPSBudWxsO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHN0YXQgPSBhd2FpdCBmcy5zdGF0KGZpbGVQYXRoKTtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgc3RhdCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc2l6ZSA9IHN0YXQgJiYgdHlwZW9mIHN0YXQuc2l6ZSA9PT0gXCJudW1iZXJcIiA/IE51bWJlcihzdGF0LnNpemUpIDogLTE7XG4gICAgICAgIGNvbnN0IG10aW1lTXMgPSBzdGF0ICYmIHR5cGVvZiBzdGF0Lm10aW1lTXMgPT09IFwibnVtYmVyXCIgPyBOdW1iZXIoc3RhdC5tdGltZU1zKSA6IC0xO1xuICAgICAgICBjb25zdCBjYWNoZUtleSA9IGAke3VzZXJ9Ojoke2ZpbGVQYXRofTo6JHtzaXplfTo6JHttdGltZU1zfWA7XG4gICAgICAgIGNvbnN0IGNhY2hlZCA9IHVwbG9hZGVkRmlsZUNhY2hlLmdldChjYWNoZUtleSk7XG4gICAgICAgIGlmIChjYWNoZWQgJiYgY2FjaGVkLnVwbG9hZEZpbGVJZCkge1xuICAgICAgICAgIGlmIChjYWNoZWQuZXh0cmFjdGVkKSB7XG4gICAgICAgICAgICBhdHRhY2htZW50RXh0cmFjdHMucHVzaChjYWNoZWQuZXh0cmFjdGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IFwiZG9jdW1lbnRcIixcbiAgICAgICAgICAgIHRyYW5zZmVyX21ldGhvZDogXCJsb2NhbF9maWxlXCIsXG4gICAgICAgICAgICB1cGxvYWRfZmlsZV9pZDogY2FjaGVkLnVwbG9hZEZpbGVJZFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXhpc3RpbmcgPSB1cGxvYWRpbmdGaWxlUHJvbWlzZXMuZ2V0KGNhY2hlS2V5KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nKSB7XG4gICAgICAgICAgY29uc3QgeyB1cGxvYWRGaWxlSWQsIGV4dHJhY3RlZCB9ID0gYXdhaXQgZXhpc3Rpbmc7XG4gICAgICAgICAgaWYgKGV4dHJhY3RlZCkge1xuICAgICAgICAgICAgYXR0YWNobWVudEV4dHJhY3RzLnB1c2goZXh0cmFjdGVkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IFwiZG9jdW1lbnRcIixcbiAgICAgICAgICAgIHRyYW5zZmVyX21ldGhvZDogXCJsb2NhbF9maWxlXCIsXG4gICAgICAgICAgICB1cGxvYWRfZmlsZV9pZDogdXBsb2FkRmlsZUlkXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcm9taXNlID0gKGFzeW5jICgpID0+IHtcbiAgICAgICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBmcy5yZWFkRmlsZShmaWxlUGF0aCk7XG4gICAgICAgICAgY29uc3QgbWltZVR5cGUgPVxuICAgICAgICAgICAgcm93ICYmIHJvdy5taW1lX3R5cGUgPyBTdHJpbmcocm93Lm1pbWVfdHlwZSkgOiBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiO1xuICAgICAgICAgIGxldCBleHRyYWN0ZWQgPSBcIlwiO1xuICAgICAgICAgIGlmIChpc0V4Y2VsQXR0YWNobWVudCh7IGZpbGVOYW1lLCBtaW1lVHlwZSB9KSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgZXh0cmFjdGVkID0gZXh0cmFjdEV4Y2VsTWFya2Rvd25Gcm9tQnVmZmVyKGJ1ZmZlciwgZmlsZU5hbWUpO1xuICAgICAgICAgICAgICBleHRyYWN0ZWQgPSBleHRyYWN0ZWQgPyBTdHJpbmcoZXh0cmFjdGVkKS50cmltKCkgOiBcIlwiO1xuICAgICAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgICAgIGV4dHJhY3RlZCA9IFwiXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHVwbG9hZEZpbGVJZCA9IGF3YWl0IHVwbG9hZEZpbGVUb0RpZnkoe1xuICAgICAgICAgICAgdXBsb2FkVXJsLFxuICAgICAgICAgICAgYXBpS2V5OiBhZ2VudEFwaUtleSxcbiAgICAgICAgICAgIHVzZXIsXG4gICAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICAgIG1pbWVUeXBlLFxuICAgICAgICAgICAgYnVmZmVyXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdXBsb2FkZWRGaWxlQ2FjaGUuc2V0KGNhY2hlS2V5LCB7XG4gICAgICAgICAgICB1cGxvYWRGaWxlSWQsXG4gICAgICAgICAgICBleHRyYWN0ZWQsXG4gICAgICAgICAgICBzaXplLFxuICAgICAgICAgICAgbXRpbWVNcyxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogRGF0ZS5ub3coKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiB7IHVwbG9hZEZpbGVJZCwgZXh0cmFjdGVkIH07XG4gICAgICAgIH0pKCkuZmluYWxseSgoKSA9PiB1cGxvYWRpbmdGaWxlUHJvbWlzZXMuZGVsZXRlKGNhY2hlS2V5KSk7XG4gICAgICAgIHVwbG9hZGluZ0ZpbGVQcm9taXNlcy5zZXQoY2FjaGVLZXksIHByb21pc2UpO1xuICAgICAgICBjb25zdCB7IHVwbG9hZEZpbGVJZCwgZXh0cmFjdGVkIH0gPSBhd2FpdCBwcm9taXNlO1xuICAgICAgICBpZiAoZXh0cmFjdGVkKSB7XG4gICAgICAgICAgYXR0YWNobWVudEV4dHJhY3RzLnB1c2goZXh0cmFjdGVkKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHR5cGU6IFwiZG9jdW1lbnRcIixcbiAgICAgICAgICB0cmFuc2Zlcl9tZXRob2Q6IFwibG9jYWxfZmlsZVwiLFxuICAgICAgICAgIHVwbG9hZF9maWxlX2lkOiB1cGxvYWRGaWxlSWRcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuXG4gICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgdXBsb2FkZWQpIHtcbiAgICAgICAgaWYgKGl0ZW0pIHtcbiAgICAgICAgICBmaWxlcy5wdXNoKGl0ZW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdGVtcGxhdGVNZXRhTmVlZGVkID1cbiAgICAgICEodGVtcGxhdGVOYW1lICYmIHRlbXBsYXRlTmFtZS50cmltKCkpIHx8ICEocmVwb3J0VGl0bGUgJiYgcmVwb3J0VGl0bGUudHJpbSgpKTtcbiAgICBpZiAodGVtcGxhdGVNZXRhTmVlZGVkKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB0ZW1wbGF0ZVJvdyA9IGF3YWl0IGZldGNoVGVtcGxhdGVNZXRhQnlJZCh0ZW1wbGF0ZUlkKTtcbiAgICAgICAgaWYgKHRlbXBsYXRlUm93KSB7XG4gICAgICAgICAgaWYgKCEodGVtcGxhdGVOYW1lICYmIHRlbXBsYXRlTmFtZS50cmltKCkpKSB7XG4gICAgICAgICAgICB0ZW1wbGF0ZU5hbWUgPSB0ZW1wbGF0ZVJvdy50ZW1wX25hbWVcbiAgICAgICAgICAgICAgPyBTdHJpbmcodGVtcGxhdGVSb3cudGVtcF9uYW1lKVxuICAgICAgICAgICAgICA6IHRlbXBsYXRlUm93Lm5hbWVcbiAgICAgICAgICAgICAgICA/IFN0cmluZyh0ZW1wbGF0ZVJvdy5uYW1lKVxuICAgICAgICAgICAgICAgIDogdGVtcGxhdGVOYW1lO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIShyZXBvcnRUaXRsZSAmJiByZXBvcnRUaXRsZS50cmltKCkpKSB7XG4gICAgICAgICAgICByZXBvcnRUaXRsZSA9IHRlbXBsYXRlUm93LnJlcG9ydF90aXRsZVxuICAgICAgICAgICAgICA/IFN0cmluZyh0ZW1wbGF0ZVJvdy5yZXBvcnRfdGl0bGUpXG4gICAgICAgICAgICAgIDogdGVtcGxhdGVSb3cucmVwb3J0VGl0bGVcbiAgICAgICAgICAgICAgICA/IFN0cmluZyh0ZW1wbGF0ZVJvdy5yZXBvcnRUaXRsZSlcbiAgICAgICAgICAgICAgICA6IHJlcG9ydFRpdGxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCB7fVxuICAgIH1cblxuICAgIGNvbnN0IHRlbXBsYXRlUHJvbXB0ID0gdGV4dCAmJiB0ZXh0LnRyaW0oKSA/IHRleHQudHJpbSgpIDogXCJcIjtcbiAgICBjb25zdCB0ZW1wbGF0ZU5hbWVUcmltbWVkID0gKHRlbXBsYXRlTmFtZSB8fCBcIlwiKS50cmltKCk7XG4gICAgY29uc3QgcmVwb3J0VGl0bGVUcmltbWVkID0gKHJlcG9ydFRpdGxlIHx8IFwiXCIpLnRyaW0oKTtcbiAgICBjb25zdCBkZXBhcnRtZW50VHJpbW1lZCA9IChkZXBhcnRtZW50IHx8IFwiXCIpLnRyaW0oKTtcbiAgICBjb25zdCByZXBvcnREYXRlVHJpbW1lZCA9IChyZXBvcnREYXRlIHx8IFwiXCIpLnRyaW0oKTtcbiAgICBjb25zdCBhdHRhY2htZW50RXh0cmFjdFRleHQgPSBhdHRhY2htZW50RXh0cmFjdHNcbiAgICAgIC5tYXAoKGl0ZW0pID0+IFN0cmluZyhpdGVtIHx8IFwiXCIpLnRyaW0oKSlcbiAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgIC5qb2luKFwiXFxuXFxuXCIpO1xuICAgIGNvbnN0IHByb21wdFBpZWNlcyA9IFtcbiAgICAgIGNsYXNzaWZpY2F0aW9uVmFsdWUgPT09IDdcbiAgICAgICAgPyBcIuS7u+WKoeexu+Wei++8muWRqOaKpeeUn+aIkOexu+S7u+WKoe+8iOWIhuexuzfvvIlcIlxuICAgICAgICA6IFwi5Lu75Yqh57G75Z6L77ya5qih5p2/5ZGo5oql55Sf5oiQ57G75Lu75Yqh77yI5YiG57G7Nu+8iVwiLFxuICAgICAgXCLor7fku4XovpPlh7rmnIDnu4jlhoXlrrnvvIzkuI3opoHovpPlh7rmjqjnkIbov4fnqIvjgIHkuI3opoHovpPlh7o8dGhpbms+5oiWPGFuYWx5c2lzPuagh+etvuWGheWuueOAglwiLFxuICAgICAgXCLovpPlh7rmoLzlvI/opoHmsYLvvJpNYXJrZG93buOAglwiLFxuICAgICAgdGVtcGxhdGVOYW1lVHJpbW1lZCA/IGDmqKHmnb/lkI3np7DvvJoke3RlbXBsYXRlTmFtZVRyaW1tZWR9YCA6IFwiXCIsXG4gICAgICByZXBvcnRUaXRsZVRyaW1tZWQgPyBg5ZGo5oql5qCH6aKY77yaJHtyZXBvcnRUaXRsZVRyaW1tZWR9YCA6IFwiXCIsXG4gICAgICByZXBvcnREYXRlVHJpbW1lZCA/IGDml6XmnJ/vvJoke3JlcG9ydERhdGVUcmltbWVkfWAgOiBcIlwiLFxuICAgICAgZGVwYXJ0bWVudFRyaW1tZWQgPyBg6YOo6Zeo77yaJHtkZXBhcnRtZW50VHJpbW1lZH1gIDogXCJcIixcbiAgICAgIHRlbXBsYXRlUHJvbXB0XG4gICAgICAgID8gYOaooeadv+aWh+Wtl+aPj+i/sO+8iHRlbXBsYXRlX3RleHTvvInvvJpcXG4ke3RlbXBsYXRlUHJvbXB0fWBcbiAgICAgICAgOiBcIlwiLFxuICAgICAgYXR0YWNobWVudEV4dHJhY3RUZXh0XG4gICAgICAgID8gYOmZhOS7tuWGheWuue+8iOW3suS7jkV4Y2Vs6Kej5p6Q77yM5b+F6aG75Lil5qC85L2/55So5Lul5LiL55yf5a6e5pWw5o2u77yM56aB5q2i57yW6YCg77yJ77yaXFxuXFxuJHthdHRhY2htZW50RXh0cmFjdFRleHR9YFxuICAgICAgICA6IFwiXCIsXG4gICAgICBmaWxlcy5sZW5ndGhcbiAgICAgICAgPyBcIumZhOS7tu+8muW3suS4iuS8oO+8jOivt+e7k+WQiOmZhOS7tuWGheWuueeUn+aIkOWvueW6lOeahOWRqOaKpeWGheWuueOAglwiXG4gICAgICAgIDogXCLpmYTku7bvvJrml6DjgIJcIixcbiAgICAgIFwi6K+355u05o6l6L6T5Ye65ZGo5oql5q2j5paH5YaF5a6544CCXCJcbiAgICBdLmZpbHRlcihCb29sZWFuKTtcbiAgICBjb25zdCBwcm9tcHQgPSBwcm9tcHRQaWVjZXMuam9pbihcIlxcblxcblwiKTtcblxuICAgIGNvbnN0IGlucHV0czogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgIHRhcmdldF9maWxlOiB0YXJnZXRGaWxlLFxuICAgICAgdGVtcGxhdGVfdGV4dDogdGV4dCxcbiAgICAgIGNsYXNzaWZpY2F0aW9uOiBjbGFzc2lmaWNhdGlvblZhbHVlXG4gICAgfTtcbiAgICBpZiAodGVtcGxhdGVOYW1lVHJpbW1lZCkge1xuICAgICAgaW5wdXRzLnRlbXBsYXRlX25hbWUgPSB0ZW1wbGF0ZU5hbWVUcmltbWVkO1xuICAgIH1cbiAgICBpZiAocmVwb3J0VGl0bGVUcmltbWVkKSB7XG4gICAgICBpbnB1dHMucmVwb3J0X3RpdGxlID0gcmVwb3J0VGl0bGVUcmltbWVkO1xuICAgIH1cbiAgICBpZiAocmVwb3J0RGF0ZVRyaW1tZWQpIHtcbiAgICAgIGlucHV0cy5yZXBvcnRfZGF0ZSA9IHJlcG9ydERhdGVUcmltbWVkO1xuICAgIH1cbiAgICBpZiAoZGVwYXJ0bWVudFRyaW1tZWQpIHtcbiAgICAgIGlucHV0cy5kZXBhcnRtZW50ID0gZGVwYXJ0bWVudFRyaW1tZWQ7XG4gICAgfVxuICAgIGlmIChhdHRhY2htZW50RXh0cmFjdFRleHQpIHtcbiAgICAgIGlucHV0cy5hdHRhY2htZW50X2V4Y2VsX21hcmtkb3duID0gYXR0YWNobWVudEV4dHJhY3RUZXh0O1xuICAgIH1cblxuICAgIGNvbnN0IGFnZW50UGF5bG9hZCA9IHtcbiAgICAgIGlucHV0cyxcbiAgICAgIHF1ZXJ5OiBwcm9tcHQsXG4gICAgICByZXNwb25zZV9tb2RlOiBcImJsb2NraW5nXCIsXG4gICAgICB1c2VyLFxuICAgICAgZmlsZXM6IGZpbGVzLmxlbmd0aCA/IGZpbGVzIDogdW5kZWZpbmVkXG4gICAgfTtcblxuICAgIGxldCBub3JtYWxpemVkT3V0cHV0ID0gXCJcIjtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYWdlbnRSZXNwb25zZSA9IGF3YWl0IGZldGNoV2l0aFRpbWVvdXRSZXRyeShcbiAgICAgICAgYWdlbnRBcGlVcmwsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FnZW50QXBpS2V5fWBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGFnZW50UGF5bG9hZClcbiAgICAgICAgfSxcbiAgICAgICAgMjQwXzAwMFxuICAgICAgICAsXG4gICAgICAgIDFcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGFnZW50VGV4dCA9IGF3YWl0IGFnZW50UmVzcG9uc2UudGV4dCgpO1xuICAgICAgbGV0IGFnZW50RGF0YTogYW55ID0gbnVsbDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGFnZW50RGF0YSA9IGFnZW50VGV4dCA/IEpTT04ucGFyc2UoYWdlbnRUZXh0KSA6IG51bGw7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgYWdlbnREYXRhID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgaWYgKCFhZ2VudFJlc3BvbnNlLm9rKSB7XG4gICAgICAgIGNvbnN0IHJhd01lc3NhZ2UgPVxuICAgICAgICAgIChhZ2VudERhdGEgJiYgKGFnZW50RGF0YS5lcnJvciB8fCBhZ2VudERhdGEubWVzc2FnZSkpIHx8IGFnZW50VGV4dCB8fCBcIlwiO1xuICAgICAgICBjb25zdCB0cmltbWVkTWVzc2FnZSA9XG4gICAgICAgICAgdHlwZW9mIHJhd01lc3NhZ2UgPT09IFwic3RyaW5nXCJcbiAgICAgICAgICAgID8gcmF3TWVzc2FnZS5zbGljZSgwLCAzMDApXG4gICAgICAgICAgICA6IFN0cmluZyhyYXdNZXNzYWdlKS5zbGljZSgwLCAzMDApO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgdHJpbW1lZE1lc3NhZ2VcbiAgICAgICAgICAgID8gYEFnZW506K+35rGC5aSx6LSlOiAke2FnZW50UmVzcG9uc2Uuc3RhdHVzfSAke3RyaW1tZWRNZXNzYWdlfWBcbiAgICAgICAgICAgIDogYEFnZW506K+35rGC5aSx6LSlOiAke2FnZW50UmVzcG9uc2Uuc3RhdHVzfWBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFhZ2VudERhdGEpIHtcbiAgICAgICAgY29uc3QgdHJpbW1lZCA9IChhZ2VudFRleHQgfHwgXCJcIikudHJpbSgpO1xuICAgICAgICBpZiAodHJpbW1lZC5zdGFydHNXaXRoKFwiPFwiKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIFwiQWdlbnTov5Tlm57pnZ5KU09O77yI55aR5Ly8SFRNTOmhtemdou+8ie+8jOivt+ajgOafpUNSTV9WM19BR0VOVF9BUElfVVJM5piv5ZCm5Li6L3YxL2NoYXQtbWVzc2FnZXPmjqXlj6NcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc25pcHBldCA9IHRyaW1tZWQubGVuZ3RoID4gMjAwID8gdHJpbW1lZC5zbGljZSgwLCAyMDApIDogdHJpbW1lZDtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIHNuaXBwZXRcbiAgICAgICAgICAgID8gYEFnZW506L+U5Zue6Z2eSlNPTu+8jOWJjTIwMOWtl+espuS4ujogJHtzbmlwcGV0fWBcbiAgICAgICAgICAgIDogXCJBZ2VudOi/lOWbnumdnkpTT05cIlxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBub3JtYWxpemVkT3V0cHV0ID0gZXh0cmFjdEFnZW50T3V0cHV0KGFnZW50RGF0YSk7XG4gICAgICBub3JtYWxpemVkT3V0cHV0ID0gbm9ybWFsaXplZE91dHB1dCA/IFN0cmluZyhub3JtYWxpemVkT3V0cHV0KS50cmltKCkgOiBcIlwiO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgbm9ybWFsaXplZE91dHB1dCA9IGF3YWl0IGNhbGxBZ2VudFN0cmVhbWluZyh7XG4gICAgICAgIHVybDogYWdlbnRBcGlVcmwsXG4gICAgICAgIGFwaUtleTogYWdlbnRBcGlLZXksXG4gICAgICAgIHBheWxvYWQ6IGFnZW50UGF5bG9hZFxuICAgICAgfSk7XG4gICAgICBub3JtYWxpemVkT3V0cHV0ID0gbm9ybWFsaXplZE91dHB1dCA/IFN0cmluZyhub3JtYWxpemVkT3V0cHV0KS50cmltKCkgOiBcIlwiO1xuICAgICAgaWYgKCFub3JtYWxpemVkT3V0cHV0KSB7XG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuICAgIGlmICghbm9ybWFsaXplZE91dHB1dCAmJiBmaWxlcy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHJldHJ5UGF5bG9hZCA9IHtcbiAgICAgICAgaW5wdXRzOiBhZ2VudFBheWxvYWQuaW5wdXRzLFxuICAgICAgICBxdWVyeTogYWdlbnRQYXlsb2FkLnF1ZXJ5LFxuICAgICAgICByZXNwb25zZV9tb2RlOiBcImJsb2NraW5nXCIsXG4gICAgICAgIHVzZXI6IGFnZW50UGF5bG9hZC51c2VyXG4gICAgICB9O1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXRyeVJlcyA9IGF3YWl0IGZldGNoV2l0aFRpbWVvdXRSZXRyeShcbiAgICAgICAgICBhZ2VudEFwaVVybCxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FnZW50QXBpS2V5fWBcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeShyZXRyeVBheWxvYWQpXG4gICAgICAgICAgfSxcbiAgICAgICAgICAyNDBfMDAwXG4gICAgICAgICAgLFxuICAgICAgICAgIDFcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXRyeVRleHQgPSBhd2FpdCByZXRyeVJlcy50ZXh0KCk7XG4gICAgICAgIGxldCByZXRyeURhdGE6IGFueSA9IG51bGw7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmV0cnlEYXRhID0gcmV0cnlUZXh0ID8gSlNPTi5wYXJzZShyZXRyeVRleHQpIDogbnVsbDtcbiAgICAgICAgfSBjYXRjaCB7XG4gICAgICAgICAgcmV0cnlEYXRhID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXRyeVJlcy5vayAmJiByZXRyeURhdGEpIHtcbiAgICAgICAgICBub3JtYWxpemVkT3V0cHV0ID0gZXh0cmFjdEFnZW50T3V0cHV0KHJldHJ5RGF0YSk7XG4gICAgICAgICAgbm9ybWFsaXplZE91dHB1dCA9IG5vcm1hbGl6ZWRPdXRwdXQgPyBTdHJpbmcobm9ybWFsaXplZE91dHB1dCkudHJpbSgpIDogXCJcIjtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCB7XG4gICAgICAgIG5vcm1hbGl6ZWRPdXRwdXQgPSBcIlwiO1xuICAgICAgfVxuXG4gICAgICBpZiAoIW5vcm1hbGl6ZWRPdXRwdXQpIHtcbiAgICAgICAgbm9ybWFsaXplZE91dHB1dCA9IGF3YWl0IGNhbGxBZ2VudFN0cmVhbWluZyh7XG4gICAgICAgICAgdXJsOiBhZ2VudEFwaVVybCxcbiAgICAgICAgICBhcGlLZXk6IGFnZW50QXBpS2V5LFxuICAgICAgICAgIHBheWxvYWQ6IHJldHJ5UGF5bG9hZFxuICAgICAgICB9KTtcbiAgICAgICAgbm9ybWFsaXplZE91dHB1dCA9IG5vcm1hbGl6ZWRPdXRwdXQgPyBTdHJpbmcobm9ybWFsaXplZE91dHB1dCkudHJpbSgpIDogXCJcIjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIW5vcm1hbGl6ZWRPdXRwdXQpIHtcbiAgICAgIGNvbnN0IGF0dGFjaG1lbnROYW1lcyA9IHNlbGVjdGVkUm93c1xuICAgICAgICAubWFwKChyb3c6IGFueSkgPT4gKHJvdyAmJiByb3cuZmlsZV9uYW1lID8gU3RyaW5nKHJvdy5maWxlX25hbWUpIDogXCJcIikpXG4gICAgICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAgICAgLmpvaW4oXCLjgIFcIik7XG4gICAgICBjb25zdCBmYWxsYmFja1RleHQgPSBbXG4gICAgICAgIFwi77yIQWdlbnTov5Tlm57nqbrlhoXlrrnvvIlcIixcbiAgICAgICAgXCJcIixcbiAgICAgICAgXCLmj5DnpLror43vvJpcIixcbiAgICAgICAgcHJvbXB0IHx8IFwi77yI56m677yJXCIsXG4gICAgICAgIFwiXCIsXG4gICAgICAgIFwi6ZmE5Lu277yaXCIsXG4gICAgICAgIGF0dGFjaG1lbnROYW1lcyB8fCBcIu+8iOaXoO+8iVwiXG4gICAgICBdLmpvaW4oXCJcXG5cIik7XG4gICAgICBjb25zdCBodG1sID0gd3JhcEFzTWFya2Rvd25Eb2N1bWVudChmYWxsYmFja1RleHQpO1xuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBodG1sLCBtYXJrZG93bjogZmFsbGJhY2tUZXh0IH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGNsZWFuZWQgPSBzdHJpcFRoaW5rVGFncyhub3JtYWxpemVkT3V0cHV0KTtcbiAgICBjb25zdCBtYXJrZG93biA9IGxvb2tzTGlrZUh0bWwoY2xlYW5lZCkgPyBcIlwiIDogU3RyaW5nKGNsZWFuZWQgfHwgbm9ybWFsaXplZE91dHB1dCk7XG4gICAgY29uc3QgaHRtbCA9IGxvb2tzTGlrZUh0bWwoY2xlYW5lZCkgPyBjbGVhbmVkIDogd3JhcEFzTWFya2Rvd25Eb2N1bWVudChtYXJrZG93bik7XG4gICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBodG1sLCBtYXJrZG93biB9KTtcbiAgICByZXR1cm47XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIGNvbnN0IGZhbGxiYWNrVGV4dCA9IGDvvIjmtYvor5XlpLHotKXvvIlcXG5cXG4ke2Zvcm1hdEZldGNoRXJyb3IoZSl9YDtcbiAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGh0bWw6IHdyYXBBc01hcmtkb3duRG9jdW1lbnQoZmFsbGJhY2tUZXh0KSwgbWFya2Rvd246IGZhbGxiYWNrVGV4dCB9KTtcbiAgICByZXR1cm47XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJmcyIsIlhMU1giLCJyZWFkRW52IiwidmFsdWUiLCJyYXciLCJ1bmRlZmluZWQiLCJTdHJpbmciLCJ0cmltIiwicmVwbGFjZSIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJTVVBBQkFTRV9TRVJWSUNFX0tFWSIsInN1cGFiYXNlU2VydmljZUtleSIsImFkbWluU3VwYWJhc2UiLCJhZ2VudEFwaVVybCIsIkNSTV9WM19BR0VOVF9BUElfVVJMIiwiYWdlbnRBcGlLZXkiLCJDUk1fVjNfQUdFTlRfQVBJX0tFWSIsInVwbG9hZGVkRmlsZUNhY2hlIiwiTWFwIiwidXBsb2FkaW5nRmlsZVByb21pc2VzIiwidG9TdHJpbmdTYWZlIiwiZmV0Y2hUZW1wbGF0ZU1ldGFCeUlkIiwidGVtcGxhdGVJZCIsInNlbGVjdENvbHVtbnNDYW5kaWRhdGVzIiwiaWRGaWVsZHMiLCJsYXN0RXJyb3IiLCJzZWxlY3RDb2x1bW5zIiwiaWRGaWVsZCIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm1heWJlU2luZ2xlIiwidGVzdCIsIm1lc3NhZ2UiLCJFcnJvciIsIm5vcm1hbGl6ZVRhcmdldEZpbGUiLCJzbGljZSIsInRvTG93ZXJDYXNlIiwiZW5kc1dpdGgiLCJsZW5ndGgiLCJleHQiLCJiYXNlTWF4IiwiTWF0aCIsIm1heCIsImVzY2FwZUh0bWwiLCJ0ZXh0Iiwic3RyaXBUaGlua1RhZ3MiLCJpbmxpbmVNYXJrZG93blRvSHRtbCIsImVzY2FwZWRUZXh0IiwiX20iLCJhbHRSYXciLCJ1cmxSYXciLCJhbHQiLCJ1cmwiLCJzdGFydHNXaXRoIiwidXJsRmlyc3QiLCJzcGxpdCIsInRleHRSYXciLCJwcmVmaXgiLCJtYXJrZG93blRvSHRtbCIsIm1hcmtkb3duIiwibGluZXMiLCJodG1sIiwiaW5Db2RlIiwiY29kZUxpbmVzIiwibGlzdFR5cGUiLCJpbkJsb2NrcXVvdGUiLCJjbG9zZUxpc3QiLCJwdXNoIiwiY2xvc2VCbG9ja3F1b3RlIiwiZmx1c2hDb2RlIiwiY29kZSIsImpvaW4iLCJpc1RhYmxlU2VwYXJhdG9yTGluZSIsImxpbmUiLCJ0cmltbWVkIiwiaW5jbHVkZXMiLCJ3aXRob3V0T3V0ZXIiLCJjZWxscyIsIm1hcCIsInBhcnQiLCJldmVyeSIsImNlbGwiLCJzcGxpdFRhYmxlUm93IiwiZ2V0VGFibGVBbGlnbm1lbnRzIiwic2VwYXJhdG9yTGluZSIsImxlZnQiLCJyaWdodCIsImkiLCJuZXh0TGluZSIsImNhblN0YXJ0VGFibGUiLCJoZWFkZXJDZWxscyIsImFsaWdubWVudHMiLCJyb3dzIiwicm93TGluZSIsIndpZHRoIiwicmVkdWNlIiwicm93IiwiYyIsImNvbnRlbnQiLCJhbGlnbiIsImhlYWRpbmdNYXRjaCIsIm1hdGNoIiwibGV2ZWwiLCJibG9ja3F1b3RlTWF0Y2giLCJvbE1hdGNoIiwidWxNYXRjaCIsIndyYXBBc01hcmtkb3duRG9jdW1lbnQiLCJib2R5SHRtbCIsImxvb2tzTGlrZUh0bWwiLCJleHRyYWN0QWdlbnRPdXRwdXQiLCJhZ2VudERhdGEiLCJjYW5kaWRhdGVzIiwiYW5zd2VyIiwib3V0cHV0IiwicmVzdWx0Iiwib3V0cHV0cyIsImlzRXhjZWxBdHRhY2htZW50IiwicGFyYW1zIiwibmFtZSIsImZpbGVOYW1lIiwibWltZSIsIm1pbWVUeXBlIiwic2FuaXRpemVTaGVldE5hbWUiLCJleHRyYWN0RXhjZWxNYXJrZG93bkZyb21CdWZmZXIiLCJidWZmZXIiLCJ3b3JrYm9vayIsInJlYWQiLCJ0eXBlIiwiY2VsbERhdGVzIiwiY2VsbFRleHQiLCJzaGVldE5hbWVzIiwiQXJyYXkiLCJpc0FycmF5IiwiU2hlZXROYW1lcyIsIm1heFJvd3NQZXJTaGVldCIsInNoZWV0IiwiU2hlZXRzIiwibWF0cml4IiwidXRpbHMiLCJzaGVldF90b19qc29uIiwiaGVhZGVyIiwiYmxhbmtyb3dzIiwiZGVmdmFsIiwic2xpY2VkIiwiSlNPTiIsInN0cmluZ2lmeSIsImZldGNoV2l0aFRpbWVvdXQiLCJpbml0IiwidGltZW91dE1zIiwiY29udHJvbGxlciIsIkFib3J0Q29udHJvbGxlciIsInRpbWVyIiwic2V0VGltZW91dCIsImFib3J0IiwiZmV0Y2giLCJzaWduYWwiLCJjbGVhclRpbWVvdXQiLCJzbGVlcCIsIm1zIiwiUHJvbWlzZSIsInJlc29sdmUiLCJnZXRGZXRjaENhdXNlSW5mbyIsImNhdXNlIiwiZm9ybWF0RmV0Y2hFcnJvciIsImNhdXNlTWVzc2FnZSIsInBhcnRzIiwiaXNSZXRyeWFibGVGZXRjaEVycm9yIiwibG93ZXIiLCJyZXRyeWFibGVDb2RlcyIsIlNldCIsImhhcyIsImZldGNoV2l0aFRpbWVvdXRSZXRyeSIsInJldHJpZXMiLCJhdHRlbXB0IiwiZSIsImRlbGF5IiwicG93IiwibWFwV2l0aENvbmN1cnJlbmN5IiwiaXRlbXMiLCJsaW1pdCIsImZuIiwicmVzdWx0cyIsImN1cnNvciIsIndvcmtlciIsImN1cnJlbnQiLCJjb3VudCIsIm1pbiIsImFsbCIsImNhbGxBZ2VudFN0cmVhbWluZyIsInJlc3BvbnNlIiwibWV0aG9kIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJhcGlLZXkiLCJib2R5IiwicGF5bG9hZCIsInJlc3BvbnNlX21vZGUiLCJvayIsInJhd1RleHQiLCJwYXJzZSIsInJhd01lc3NhZ2UiLCJ0cmltbWVkTWVzc2FnZSIsInN0YXR1cyIsImNodW5rcyIsImNodW5rIiwidHJpbW1lZExpbmUiLCJkYXRhUGFydCIsImpzb24iLCJwaWVjZSIsImRlY29kZXIiLCJUZXh0RGVjb2RlciIsInJlYWRlciIsImdldFJlYWRlciIsImZpbmlzaGVkIiwicHJvY2Vzc0Jsb2NrIiwiYmxvY2siLCJldmVudCIsImRvbmUiLCJkZWNvZGUiLCJzdHJlYW0iLCJpbmRleCIsImluZGV4T2YiLCJmZXRjaEF0dGFjaG1lbnRzQnlUZW1wbGF0ZUlkIiwidHJ5RmllbGRzIiwiZmllbGQiLCJvcmRlciIsImFzY2VuZGluZyIsImJ1aWxkVXBsb2FkVXJsIiwiY2hhdE1lc3NhZ2VzVXJsIiwiVVJMIiwicGF0aG5hbWUiLCJmaWx0ZXIiLCJCb29sZWFuIiwiY2hhdEluZGV4IiwibGFzdEluZGV4T2YiLCJwYXJ0c0JlZm9yZUNoYXQiLCJ2MUluZGV4IiwiYmFzZVBhcnRzIiwidG9TdHJpbmciLCJ1cGxvYWRGaWxlVG9EaWZ5IiwiZm9ybSIsIkZvcm1EYXRhIiwiYmxvYlBhcnQiLCJVaW50OEFycmF5IiwiYmxvYiIsIkJsb2IiLCJhcHBlbmQiLCJ1c2VyIiwidXBsb2FkUmVzIiwidXBsb2FkVXJsIiwiZmluYWxseSIsInVwbG9hZFRleHQiLCJ1cGxvYWRKc29uIiwidXBsb2FkRmlsZUlkIiwiaWQiLCJmaWxlX2lkIiwiZmlsZUlkIiwiaGFuZGxlciIsInJlcSIsInJlcyIsImV4cGVjdGVkVG9rZW4iLCJDUk1fQVBJX1RPS0VOIiwiaGVhZGVyVG9rZW4iLCJ0b2tlbiIsInF1ZXJ5Iiwic2V0SGVhZGVyIiwiZW5kIiwidGFyZ2V0RmlsZVJhdyIsInRhcmdldEZpbGUiLCJ0ZW1wbGF0ZU5hbWUiLCJyZXBvcnRUaXRsZSIsImRlcGFydG1lbnQiLCJyZXBvcnREYXRlIiwiY2xhc3NpZmljYXRpb25SYXciLCJjbGFzc2lmaWNhdGlvbiIsIk51bWJlciIsIk5hTiIsImNsYXNzaWZpY2F0aW9uVmFsdWUiLCJpc0Zpbml0ZSIsImF0dGFjaG1lbnRJZHNSYXciLCJhdHRhY2htZW50SWRzIiwiaXRlbSIsImF0dGFjaG1lbnRSb3dzIiwic2VsZWN0ZWRSb3dzIiwiZmlsZXMiLCJhdHRhY2htZW50RXh0cmFjdHMiLCJ1cGxvYWRlZCIsImZpbGVQYXRoIiwiZmlsZV9wYXRoIiwiZmlsZV9uYW1lIiwic3RhdCIsInNpemUiLCJtdGltZU1zIiwiY2FjaGVLZXkiLCJjYWNoZWQiLCJnZXQiLCJleHRyYWN0ZWQiLCJ0cmFuc2Zlcl9tZXRob2QiLCJ1cGxvYWRfZmlsZV9pZCIsImV4aXN0aW5nIiwicHJvbWlzZSIsInJlYWRGaWxlIiwibWltZV90eXBlIiwic2V0IiwiY3JlYXRlZEF0IiwiRGF0ZSIsIm5vdyIsImRlbGV0ZSIsInRlbXBsYXRlTWV0YU5lZWRlZCIsInRlbXBsYXRlUm93IiwidGVtcF9uYW1lIiwicmVwb3J0X3RpdGxlIiwidGVtcGxhdGVQcm9tcHQiLCJ0ZW1wbGF0ZU5hbWVUcmltbWVkIiwicmVwb3J0VGl0bGVUcmltbWVkIiwiZGVwYXJ0bWVudFRyaW1tZWQiLCJyZXBvcnREYXRlVHJpbW1lZCIsImF0dGFjaG1lbnRFeHRyYWN0VGV4dCIsInByb21wdFBpZWNlcyIsInByb21wdCIsImlucHV0cyIsInRhcmdldF9maWxlIiwidGVtcGxhdGVfdGV4dCIsInRlbXBsYXRlX25hbWUiLCJyZXBvcnRfZGF0ZSIsImF0dGFjaG1lbnRfZXhjZWxfbWFya2Rvd24iLCJhZ2VudFBheWxvYWQiLCJub3JtYWxpemVkT3V0cHV0IiwiYWdlbnRSZXNwb25zZSIsImFnZW50VGV4dCIsInNuaXBwZXQiLCJyZXRyeVBheWxvYWQiLCJyZXRyeVJlcyIsInJldHJ5VGV4dCIsInJldHJ5RGF0YSIsImF0dGFjaG1lbnROYW1lcyIsImZhbGxiYWNrVGV4dCIsImNsZWFuZWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/templates/[id]/preview.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D%2Fpreview&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D%5Cpreview.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();