"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/templates/[id]";
exports.ids = ["pages/api/templates/[id]"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D.ts&middlewareConfigBase64=e30%3D!":
/*!**********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D.ts&middlewareConfigBase64=e30%3D! ***!
  \**********************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\templates\\[id].ts */ \"(api)/./pages/api/templates/[id].ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/templates/[id]\",\n        pathname: \"/api/templates/[id]\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_templates_id_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRnRlbXBsYXRlcyUyRiU1QmlkJTVEJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUN0ZW1wbGF0ZXMlNUMlNUJpZCU1RC50cyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUM2RDtBQUM3RDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsdURBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLHVEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL2NybS1hZ2VudC13ZWIvPzljMzciXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFx0ZW1wbGF0ZXNcXFxcW2lkXS50c1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL3RlbXBsYXRlcy9baWRdXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvdGVtcGxhdGVzL1tpZF1cIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/templates/[id].ts":
/*!*************************************!*\
  !*** ./pages/api/templates/[id].ts ***!
  \*************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nfunction readEnv(value) {\n    const raw = value !== null && value !== undefined ? String(value).trim() : \"\";\n    if (!raw) {\n        return \"\";\n    }\n    return raw.replace(/^['\"`]/, \"\").replace(/['\"`]$/, \"\").trim();\n}\nconst supabaseUrl = readEnv(\"https://vvrokpefmojngpoxvsan.supabase.co\");\nconst supabaseKey = readEnv(\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cm9rcGVmbW9qbmdwb3h2c2FuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzUzNTIsImV4cCI6MjA4MzQxMTM1Mn0.t-tHn0A7uzizGEytzeaNvz-i5BGL9sqq-yGOvGE2crQ\" || 0);\nconst supabaseServiceKey = readEnv(process.env.SUPABASE_SERVICE_KEY);\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseKey || \"\");\nconst adminSupabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey || supabaseKey || \"\");\nfunction getTemplateId(source) {\n    const value = source.id ?? source.temp_id ?? source.template_id ?? source.tempId ?? source.templateId ?? source.uuid ?? \"\";\n    return value !== null && value !== undefined ? String(value) : \"\";\n}\nfunction normalizeTemplateRow(row) {\n    const source = row || {};\n    const rawPath = source.temp_path ?? source.path ?? source.file_path ?? source.filePath ?? \"\";\n    const text = source.temp_content ?? source.temp_text ?? source.temp_desc ?? source.description ?? source.content ?? source.text ?? \"\";\n    const reportTitle = source.report_title ?? source.reportTitle ?? \"\";\n    const paramType = source.param_type ?? source.paramType ?? \"\";\n    return {\n        id: getTemplateId(source),\n        name: source.temp_name ? String(source.temp_name) : source.name ? String(source.name) : \"\",\n        type: source.temp_type ? String(source.temp_type) : source.type ? String(source.type) : \"\",\n        path: rawPath ? String(rawPath) : \"\",\n        creator: source.created_by ? String(source.created_by) : \"\",\n        createdAt: source.created_at ? String(source.created_at) : \"\",\n        updatedAt: source.updated_at ? String(source.updated_at) : \"\",\n        text: typeof text === \"string\" ? text : String(text || \"\"),\n        reportTitle: reportTitle ? String(reportTitle) : \"\",\n        paramType: paramType ? String(paramType) : \"\"\n    };\n}\nfunction normalizeAttachmentRow(row) {\n    const source = row || {};\n    return {\n        id: source.id !== null && source.id !== undefined ? String(source.id) : \"\",\n        fileName: source.file_name ? String(source.file_name) : \"\",\n        filePath: source.file_path ? String(source.file_path) : \"\",\n        fileSize: source.file_size !== null && source.file_size !== undefined ? Number(source.file_size) : null,\n        mimeType: source.mime_type ? String(source.mime_type) : \"\",\n        createdAt: source.created_at ? String(source.created_at) : \"\",\n        createdBy: source.created_by ? String(source.created_by) : \"\"\n    };\n}\nasync function fetchAttachmentsByTemplateId(templateId) {\n    const selectColumnsCandidates = [\n        \"id,file_name,file_path,file_size,mime_type,created_at,created_by,template_id\",\n        \"id,file_name,file_path,file_size,mime_type,created_at,created_by,temp_id\"\n    ];\n    const tryFields = [\n        \"template_id\",\n        \"temp_id\"\n    ];\n    let lastError = null;\n    for (const selectColumns of selectColumnsCandidates){\n        for (const field of tryFields){\n            const { data, error } = await adminSupabase.from(\"document_template_attachments\").select(selectColumns).eq(field, templateId).order(\"created_at\", {\n                ascending: false\n            });\n            if (!error) {\n                return Array.isArray(data) ? data : [];\n            }\n            lastError = error;\n            if (!/column .* does not exist/i.test(error.message || \"\")) {\n                break;\n            }\n        }\n    }\n    if (lastError) {\n        throw new Error(lastError.message || \"查询附件失败\");\n    }\n    return [];\n}\nfunction toStringSafe(value) {\n    if (value === null || value === undefined) {\n        return \"\";\n    }\n    return String(value);\n}\nasync function updateTemplate(params) {\n    const nowIso = new Date().toISOString();\n    const idFields = [\n        \"id\",\n        \"temp_id\",\n        \"template_id\"\n    ];\n    let lastError = null;\n    const isSchemaCacheMissing = (msg)=>{\n        const value = (msg || \"\").toLowerCase();\n        if (!value.includes(\"schema cache\")) {\n            return false;\n        }\n        return /could not find the '.+?' column of '.+?' in the schema cache/i.test(msg) || /could not find the '.+?' table in the schema cache/i.test(msg);\n    };\n    const getMissingColumnName = (msg)=>{\n        const fromDoesNotExist = msg.match(/column ['\"]?([a-z0-9_]+)['\"]? does not exist/i);\n        if (fromDoesNotExist && fromDoesNotExist[1]) {\n            return fromDoesNotExist[1];\n        }\n        const fromSchemaCache = msg.match(/could not find the '([^']+?)' column of 'document_templates' in the schema cache/i);\n        if (fromSchemaCache && fromSchemaCache[1]) {\n            return fromSchemaCache[1];\n        }\n        return \"\";\n    };\n    const textCandidates = [\n        \"temp_content\",\n        \"temp_text\",\n        \"temp_desc\",\n        \"description\",\n        \"content\",\n        \"text\"\n    ];\n    const nameCandidates = params.name !== undefined ? [\n        \"temp_name\",\n        \"name\",\n        \"\"\n    ] : [\n        \"\"\n    ];\n    const reportTitleCandidates = params.reportTitle !== undefined ? [\n        \"report_title\",\n        \"reportTitle\",\n        \"\"\n    ] : [\n        \"\"\n    ];\n    const paramTypeCandidates = params.paramType !== undefined ? [\n        \"param_type\",\n        \"paramType\",\n        \"\"\n    ] : [\n        \"\"\n    ];\n    for (const idField of idFields){\n        for (const textColumn of textCandidates){\n            let updatedAtEnabled = true;\n            let nameIndex = 0;\n            let reportTitleIndex = 0;\n            let paramTypeIndex = 0;\n            for(let attempts = 0; attempts < 12; attempts += 1){\n                const payload = {\n                    [textColumn]: params.text\n                };\n                if (updatedAtEnabled) {\n                    payload.updated_at = nowIso;\n                }\n                const nameColumn = nameCandidates[nameIndex] || \"\";\n                const reportTitleColumn = reportTitleCandidates[reportTitleIndex] || \"\";\n                const paramTypeColumn = paramTypeCandidates[paramTypeIndex] || \"\";\n                if (params.name !== undefined && nameColumn) {\n                    payload[nameColumn] = params.name;\n                }\n                if (params.reportTitle !== undefined && reportTitleColumn) {\n                    payload[reportTitleColumn] = params.reportTitle;\n                }\n                if (params.paramType !== undefined && paramTypeColumn) {\n                    payload[paramTypeColumn] = params.paramType;\n                }\n                const attempt = await supabase.from(\"document_templates\").update(payload).eq(idField, params.id).select(\"*\").maybeSingle();\n                if (!attempt.error && attempt.data) {\n                    return attempt.data;\n                }\n                if (!attempt.error && !attempt.data) {\n                    lastError = new Error(\"未找到模板\");\n                    break;\n                }\n                lastError = attempt.error;\n                const msg = attempt.error?.message || \"\";\n                if (/could not find the 'document_templates' table in the schema cache/i.test(msg)) {\n                    throw new Error(\"Supabase中未找到document_templates表（schema cache），请确认数据库表名或权限\");\n                }\n                const missingColumn = getMissingColumnName(msg);\n                const updatedAtMissing = missingColumn === \"updated_at\" || /column .*updated_at.* does not exist/i.test(msg) || /could not find the 'updated_at' column of 'document_templates' in the schema cache/i.test(msg);\n                if (updatedAtMissing) {\n                    updatedAtEnabled = false;\n                    continue;\n                }\n                if (missingColumn === textColumn || isSchemaCacheMissing(msg) || /column .* does not exist/i.test(msg)) {\n                    if (missingColumn && missingColumn === nameColumn && nameIndex + 1 < nameCandidates.length) {\n                        nameIndex += 1;\n                        continue;\n                    }\n                    if (missingColumn && missingColumn === reportTitleColumn && reportTitleIndex + 1 < reportTitleCandidates.length) {\n                        reportTitleIndex += 1;\n                        continue;\n                    }\n                    if (missingColumn && missingColumn === paramTypeColumn && paramTypeIndex + 1 < paramTypeCandidates.length) {\n                        paramTypeIndex += 1;\n                        continue;\n                    }\n                    if (missingColumn && missingColumn === textColumn) {\n                        break;\n                    }\n                    if (!missingColumn) {\n                        break;\n                    }\n                    continue;\n                }\n                break;\n            }\n        }\n    }\n    throw new Error(lastError?.message || \"保存失败\");\n}\nasync function fetchTemplateById(templateId) {\n    const idFields = [\n        \"id\",\n        \"temp_id\",\n        \"template_id\"\n    ];\n    for (const idField of idFields){\n        const { data, error } = await supabase.from(\"document_templates\").select(\"*\").eq(idField, templateId).maybeSingle();\n        if (!error) {\n            if (data) {\n                return data;\n            }\n            continue;\n        }\n        const msg = error.message || \"\";\n        if (/column .* does not exist/i.test(msg)) {\n            continue;\n        }\n        throw new Error(msg || \"查询失败\");\n    }\n    return null;\n}\nasync function deleteTemplateById(templateId) {\n    const idFields = [\n        \"id\",\n        \"temp_id\",\n        \"template_id\"\n    ];\n    let lastError = null;\n    for (const idField of idFields){\n        const { error } = await adminSupabase.from(\"document_templates\").delete().eq(idField, templateId);\n        if (!error) {\n            return;\n        }\n        lastError = error;\n        const msg = error.message || \"\";\n        if (/column .* does not exist/i.test(msg)) {\n            continue;\n        }\n        if (/could not find the 'document_templates' table in the schema cache/i.test(msg)) {\n            throw new Error(\"Supabase中未找到document_templates表（schema cache），请确认数据库表名或权限\");\n        }\n        break;\n    }\n    if (lastError) {\n        throw new Error(lastError.message || \"删除失败\");\n    }\n}\nasync function handler(req, res) {\n    const expectedToken = process.env.CRM_API_TOKEN;\n    const headerToken = req.headers[\"x-crm-token\"];\n    const token = Array.isArray(headerToken) ? headerToken[0] : headerToken;\n    if (expectedToken && token !== expectedToken) {\n        res.status(401).json({\n            error: \"Unauthorized\"\n        });\n        return;\n    }\n    if (!supabaseUrl || !supabaseKey) {\n        res.status(500).json({\n            error: \"Supabase配置缺失\"\n        });\n        return;\n    }\n    const { id } = req.query;\n    const templateId = typeof id === \"string\" ? id : \"\";\n    if (!templateId) {\n        res.status(400).json({\n            error: \"缺少模板ID\"\n        });\n        return;\n    }\n    if (req.method === \"GET\") {\n        try {\n            const data = await fetchTemplateById(templateId);\n            const attachmentsRows = await fetchAttachmentsByTemplateId(templateId);\n            res.status(200).json({\n                item: data ? normalizeTemplateRow(data) : null,\n                attachments: attachmentsRows.map((row)=>normalizeAttachmentRow(row))\n            });\n            return;\n        } catch (e) {\n            res.status(500).json({\n                error: e?.message || \"查询失败\"\n            });\n            return;\n        }\n    }\n    if (req.method === \"PUT\") {\n        const body = req.body || {};\n        const text = toStringSafe(body.text);\n        const name = body.name !== undefined ? toStringSafe(body.name) : undefined;\n        const reportTitle = body.reportTitle !== undefined ? toStringSafe(body.reportTitle) : undefined;\n        const paramType = body.paramType !== undefined ? toStringSafe(body.paramType) : undefined;\n        try {\n            const updated = await updateTemplate({\n                id: templateId,\n                text,\n                name,\n                reportTitle,\n                paramType\n            });\n            const attachmentsRows = await fetchAttachmentsByTemplateId(templateId);\n            res.status(200).json({\n                item: normalizeTemplateRow(updated),\n                attachments: attachmentsRows.map((row)=>normalizeAttachmentRow(row))\n            });\n            return;\n        } catch (e) {\n            res.status(500).json({\n                error: e?.message || \"保存失败\"\n            });\n            return;\n        }\n    }\n    if (req.method === \"DELETE\") {\n        try {\n            await deleteTemplateById(templateId);\n            res.status(204).end();\n            return;\n        } catch (e) {\n            res.status(500).json({\n                error: e?.message || \"删除失败\"\n            });\n            return;\n        }\n    }\n    res.setHeader(\"Allow\", \"GET,PUT,DELETE\");\n    res.status(405).end(\"Method Not Allowed\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q2ZkLElBQUlNLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUUzRCxPQUFPa0UsR0FBR3pELFdBQVc7WUFBTztZQUNuRDtRQUNGO0lBQ0Y7SUFFQTJDLElBQUlrQixTQUFTLENBQUMsU0FBUztJQUN2QmxCLElBQUlNLE1BQU0sQ0FBQyxLQUFLVyxHQUFHLENBQUM7QUFDdEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcm0tYWdlbnQtd2ViLy4vcGFnZXMvYXBpL3RlbXBsYXRlcy9baWRdLnRzPzkyYzIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZnVuY3Rpb24gcmVhZEVudih2YWx1ZTogdW5rbm93bikge1xuICBjb25zdCByYXcgPSB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gU3RyaW5nKHZhbHVlKS50cmltKCkgOiBcIlwiO1xuICBpZiAoIXJhdykge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiByYXcucmVwbGFjZSgvXlsnXCJgXS8sIFwiXCIpLnJlcGxhY2UoL1snXCJgXSQvLCBcIlwiKS50cmltKCk7XG59XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcmVhZEVudihwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwpO1xuY29uc3Qgc3VwYWJhc2VLZXkgPSByZWFkRW52KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX0tFWVxuKTtcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHJlYWRFbnYocHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9LRVkpO1xuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkgfHwgXCJcIik7XG5jb25zdCBhZG1pblN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICBzdXBhYmFzZVVybCxcbiAgc3VwYWJhc2VTZXJ2aWNlS2V5IHx8IHN1cGFiYXNlS2V5IHx8IFwiXCJcbik7XG5cbmZ1bmN0aW9uIGdldFRlbXBsYXRlSWQoc291cmNlOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSB7XG4gIGNvbnN0IHZhbHVlID1cbiAgICBzb3VyY2UuaWQgPz9cbiAgICBzb3VyY2UudGVtcF9pZCA/P1xuICAgIHNvdXJjZS50ZW1wbGF0ZV9pZCA/P1xuICAgIHNvdXJjZS50ZW1wSWQgPz9cbiAgICBzb3VyY2UudGVtcGxhdGVJZCA/P1xuICAgIHNvdXJjZS51dWlkID8/XG4gICAgXCJcIjtcbiAgcmV0dXJuIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgPyBTdHJpbmcodmFsdWUpIDogXCJcIjtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplVGVtcGxhdGVSb3cocm93OiBhbnkpIHtcbiAgY29uc3Qgc291cmNlID0gKHJvdyB8fCB7fSkgYXMgUmVjb3JkPHN0cmluZywgYW55PjtcbiAgY29uc3QgcmF3UGF0aCA9XG4gICAgc291cmNlLnRlbXBfcGF0aCA/PyBzb3VyY2UucGF0aCA/PyBzb3VyY2UuZmlsZV9wYXRoID8/IHNvdXJjZS5maWxlUGF0aCA/PyBcIlwiO1xuICBjb25zdCB0ZXh0ID1cbiAgICBzb3VyY2UudGVtcF9jb250ZW50ID8/XG4gICAgc291cmNlLnRlbXBfdGV4dCA/P1xuICAgIHNvdXJjZS50ZW1wX2Rlc2MgPz9cbiAgICBzb3VyY2UuZGVzY3JpcHRpb24gPz9cbiAgICBzb3VyY2UuY29udGVudCA/P1xuICAgIHNvdXJjZS50ZXh0ID8/XG4gICAgXCJcIjtcbiAgY29uc3QgcmVwb3J0VGl0bGUgPSBzb3VyY2UucmVwb3J0X3RpdGxlID8/IHNvdXJjZS5yZXBvcnRUaXRsZSA/PyBcIlwiO1xuICBjb25zdCBwYXJhbVR5cGUgPSBzb3VyY2UucGFyYW1fdHlwZSA/PyBzb3VyY2UucGFyYW1UeXBlID8/IFwiXCI7XG4gIHJldHVybiB7XG4gICAgaWQ6IGdldFRlbXBsYXRlSWQoc291cmNlKSxcbiAgICBuYW1lOiBzb3VyY2UudGVtcF9uYW1lID8gU3RyaW5nKHNvdXJjZS50ZW1wX25hbWUpIDogc291cmNlLm5hbWUgPyBTdHJpbmcoc291cmNlLm5hbWUpIDogXCJcIixcbiAgICB0eXBlOiBzb3VyY2UudGVtcF90eXBlID8gU3RyaW5nKHNvdXJjZS50ZW1wX3R5cGUpIDogc291cmNlLnR5cGUgPyBTdHJpbmcoc291cmNlLnR5cGUpIDogXCJcIixcbiAgICBwYXRoOiByYXdQYXRoID8gU3RyaW5nKHJhd1BhdGgpIDogXCJcIixcbiAgICBjcmVhdG9yOiBzb3VyY2UuY3JlYXRlZF9ieSA/IFN0cmluZyhzb3VyY2UuY3JlYXRlZF9ieSkgOiBcIlwiLFxuICAgIGNyZWF0ZWRBdDogc291cmNlLmNyZWF0ZWRfYXQgPyBTdHJpbmcoc291cmNlLmNyZWF0ZWRfYXQpIDogXCJcIixcbiAgICB1cGRhdGVkQXQ6IHNvdXJjZS51cGRhdGVkX2F0ID8gU3RyaW5nKHNvdXJjZS51cGRhdGVkX2F0KSA6IFwiXCIsXG4gICAgdGV4dDogdHlwZW9mIHRleHQgPT09IFwic3RyaW5nXCIgPyB0ZXh0IDogU3RyaW5nKHRleHQgfHwgXCJcIiksXG4gICAgcmVwb3J0VGl0bGU6IHJlcG9ydFRpdGxlID8gU3RyaW5nKHJlcG9ydFRpdGxlKSA6IFwiXCIsXG4gICAgcGFyYW1UeXBlOiBwYXJhbVR5cGUgPyBTdHJpbmcocGFyYW1UeXBlKSA6IFwiXCJcbiAgfTtcbn1cblxuZnVuY3Rpb24gbm9ybWFsaXplQXR0YWNobWVudFJvdyhyb3c6IGFueSkge1xuICBjb25zdCBzb3VyY2UgPSAocm93IHx8IHt9KSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICByZXR1cm4ge1xuICAgIGlkOiBzb3VyY2UuaWQgIT09IG51bGwgJiYgc291cmNlLmlkICE9PSB1bmRlZmluZWQgPyBTdHJpbmcoc291cmNlLmlkKSA6IFwiXCIsXG4gICAgZmlsZU5hbWU6IHNvdXJjZS5maWxlX25hbWUgPyBTdHJpbmcoc291cmNlLmZpbGVfbmFtZSkgOiBcIlwiLFxuICAgIGZpbGVQYXRoOiBzb3VyY2UuZmlsZV9wYXRoID8gU3RyaW5nKHNvdXJjZS5maWxlX3BhdGgpIDogXCJcIixcbiAgICBmaWxlU2l6ZTpcbiAgICAgIHNvdXJjZS5maWxlX3NpemUgIT09IG51bGwgJiYgc291cmNlLmZpbGVfc2l6ZSAhPT0gdW5kZWZpbmVkXG4gICAgICAgID8gTnVtYmVyKHNvdXJjZS5maWxlX3NpemUpXG4gICAgICAgIDogbnVsbCxcbiAgICBtaW1lVHlwZTogc291cmNlLm1pbWVfdHlwZSA/IFN0cmluZyhzb3VyY2UubWltZV90eXBlKSA6IFwiXCIsXG4gICAgY3JlYXRlZEF0OiBzb3VyY2UuY3JlYXRlZF9hdCA/IFN0cmluZyhzb3VyY2UuY3JlYXRlZF9hdCkgOiBcIlwiLFxuICAgIGNyZWF0ZWRCeTogc291cmNlLmNyZWF0ZWRfYnkgPyBTdHJpbmcoc291cmNlLmNyZWF0ZWRfYnkpIDogXCJcIlxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaEF0dGFjaG1lbnRzQnlUZW1wbGF0ZUlkKHRlbXBsYXRlSWQ6IHN0cmluZykge1xuICBjb25zdCBzZWxlY3RDb2x1bW5zQ2FuZGlkYXRlcyA9IFtcbiAgICBcImlkLGZpbGVfbmFtZSxmaWxlX3BhdGgsZmlsZV9zaXplLG1pbWVfdHlwZSxjcmVhdGVkX2F0LGNyZWF0ZWRfYnksdGVtcGxhdGVfaWRcIixcbiAgICBcImlkLGZpbGVfbmFtZSxmaWxlX3BhdGgsZmlsZV9zaXplLG1pbWVfdHlwZSxjcmVhdGVkX2F0LGNyZWF0ZWRfYnksdGVtcF9pZFwiXG4gIF07XG5cbiAgY29uc3QgdHJ5RmllbGRzID0gW1widGVtcGxhdGVfaWRcIiwgXCJ0ZW1wX2lkXCJdO1xuICBsZXQgbGFzdEVycm9yOiBhbnkgPSBudWxsO1xuXG4gIGZvciAoY29uc3Qgc2VsZWN0Q29sdW1ucyBvZiBzZWxlY3RDb2x1bW5zQ2FuZGlkYXRlcykge1xuICAgIGZvciAoY29uc3QgZmllbGQgb2YgdHJ5RmllbGRzKSB7XG4gICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCAoYWRtaW5TdXBhYmFzZSBhcyBhbnkpXG4gICAgICAgIC5mcm9tKFwiZG9jdW1lbnRfdGVtcGxhdGVfYXR0YWNobWVudHNcIilcbiAgICAgICAgLnNlbGVjdChzZWxlY3RDb2x1bW5zKVxuICAgICAgICAuZXEoZmllbGQsIHRlbXBsYXRlSWQpXG4gICAgICAgIC5vcmRlcihcImNyZWF0ZWRfYXRcIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pO1xuICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhKSA/IGRhdGEgOiBbXTtcbiAgICAgIH1cbiAgICAgIGxhc3RFcnJvciA9IGVycm9yO1xuICAgICAgaWYgKCEvY29sdW1uIC4qIGRvZXMgbm90IGV4aXN0L2kudGVzdChlcnJvci5tZXNzYWdlIHx8IFwiXCIpKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChsYXN0RXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IobGFzdEVycm9yLm1lc3NhZ2UgfHwgXCLmn6Xor6LpmYTku7blpLHotKVcIik7XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuXG5mdW5jdGlvbiB0b1N0cmluZ1NhZmUodmFsdWU6IHVua25vd24pIHtcbiAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gXCJcIjtcbiAgfVxuICByZXR1cm4gU3RyaW5nKHZhbHVlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlVGVtcGxhdGUocGFyYW1zOiB7XG4gIGlkOiBzdHJpbmc7XG4gIHRleHQ6IHN0cmluZztcbiAgbmFtZT86IHN0cmluZztcbiAgcmVwb3J0VGl0bGU/OiBzdHJpbmc7XG4gIHBhcmFtVHlwZT86IHN0cmluZztcbn0pIHtcbiAgY29uc3Qgbm93SXNvID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICBjb25zdCBpZEZpZWxkcyA9IFtcImlkXCIsIFwidGVtcF9pZFwiLCBcInRlbXBsYXRlX2lkXCJdO1xuXG4gIGxldCBsYXN0RXJyb3I6IGFueSA9IG51bGw7XG5cbiAgY29uc3QgaXNTY2hlbWFDYWNoZU1pc3NpbmcgPSAobXNnOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IChtc2cgfHwgXCJcIikudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoIXZhbHVlLmluY2x1ZGVzKFwic2NoZW1hIGNhY2hlXCIpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiAoXG4gICAgICAvY291bGQgbm90IGZpbmQgdGhlICcuKz8nIGNvbHVtbiBvZiAnLis/JyBpbiB0aGUgc2NoZW1hIGNhY2hlL2kudGVzdChtc2cpIHx8XG4gICAgICAvY291bGQgbm90IGZpbmQgdGhlICcuKz8nIHRhYmxlIGluIHRoZSBzY2hlbWEgY2FjaGUvaS50ZXN0KG1zZylcbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IGdldE1pc3NpbmdDb2x1bW5OYW1lID0gKG1zZzogc3RyaW5nKSA9PiB7XG4gICAgY29uc3QgZnJvbURvZXNOb3RFeGlzdCA9IG1zZy5tYXRjaCgvY29sdW1uIFsnXCJdPyhbYS16MC05X10rKVsnXCJdPyBkb2VzIG5vdCBleGlzdC9pKTtcbiAgICBpZiAoZnJvbURvZXNOb3RFeGlzdCAmJiBmcm9tRG9lc05vdEV4aXN0WzFdKSB7XG4gICAgICByZXR1cm4gZnJvbURvZXNOb3RFeGlzdFsxXTtcbiAgICB9XG4gICAgY29uc3QgZnJvbVNjaGVtYUNhY2hlID0gbXNnLm1hdGNoKC9jb3VsZCBub3QgZmluZCB0aGUgJyhbXiddKz8pJyBjb2x1bW4gb2YgJ2RvY3VtZW50X3RlbXBsYXRlcycgaW4gdGhlIHNjaGVtYSBjYWNoZS9pKTtcbiAgICBpZiAoZnJvbVNjaGVtYUNhY2hlICYmIGZyb21TY2hlbWFDYWNoZVsxXSkge1xuICAgICAgcmV0dXJuIGZyb21TY2hlbWFDYWNoZVsxXTtcbiAgICB9XG4gICAgcmV0dXJuIFwiXCI7XG4gIH07XG5cbiAgY29uc3QgdGV4dENhbmRpZGF0ZXMgPSBbXCJ0ZW1wX2NvbnRlbnRcIiwgXCJ0ZW1wX3RleHRcIiwgXCJ0ZW1wX2Rlc2NcIiwgXCJkZXNjcmlwdGlvblwiLCBcImNvbnRlbnRcIiwgXCJ0ZXh0XCJdO1xuICBjb25zdCBuYW1lQ2FuZGlkYXRlcyA9IHBhcmFtcy5uYW1lICE9PSB1bmRlZmluZWQgPyBbXCJ0ZW1wX25hbWVcIiwgXCJuYW1lXCIsIFwiXCJdIDogW1wiXCJdO1xuICBjb25zdCByZXBvcnRUaXRsZUNhbmRpZGF0ZXMgPVxuICAgIHBhcmFtcy5yZXBvcnRUaXRsZSAhPT0gdW5kZWZpbmVkID8gW1wicmVwb3J0X3RpdGxlXCIsIFwicmVwb3J0VGl0bGVcIiwgXCJcIl0gOiBbXCJcIl07XG4gIGNvbnN0IHBhcmFtVHlwZUNhbmRpZGF0ZXMgPSBwYXJhbXMucGFyYW1UeXBlICE9PSB1bmRlZmluZWQgPyBbXCJwYXJhbV90eXBlXCIsIFwicGFyYW1UeXBlXCIsIFwiXCJdIDogW1wiXCJdO1xuXG4gIGZvciAoY29uc3QgaWRGaWVsZCBvZiBpZEZpZWxkcykge1xuICAgIGZvciAoY29uc3QgdGV4dENvbHVtbiBvZiB0ZXh0Q2FuZGlkYXRlcykge1xuICAgICAgbGV0IHVwZGF0ZWRBdEVuYWJsZWQgPSB0cnVlO1xuICAgICAgbGV0IG5hbWVJbmRleCA9IDA7XG4gICAgICBsZXQgcmVwb3J0VGl0bGVJbmRleCA9IDA7XG4gICAgICBsZXQgcGFyYW1UeXBlSW5kZXggPSAwO1xuXG4gICAgICBmb3IgKGxldCBhdHRlbXB0cyA9IDA7IGF0dGVtcHRzIDwgMTI7IGF0dGVtcHRzICs9IDEpIHtcbiAgICAgICAgY29uc3QgcGF5bG9hZDogUmVjb3JkPHN0cmluZywgYW55PiA9IHtcbiAgICAgICAgICBbdGV4dENvbHVtbl06IHBhcmFtcy50ZXh0XG4gICAgICAgIH07XG4gICAgICAgIGlmICh1cGRhdGVkQXRFbmFibGVkKSB7XG4gICAgICAgICAgcGF5bG9hZC51cGRhdGVkX2F0ID0gbm93SXNvO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgbmFtZUNvbHVtbiA9IG5hbWVDYW5kaWRhdGVzW25hbWVJbmRleF0gfHwgXCJcIjtcbiAgICAgICAgY29uc3QgcmVwb3J0VGl0bGVDb2x1bW4gPSByZXBvcnRUaXRsZUNhbmRpZGF0ZXNbcmVwb3J0VGl0bGVJbmRleF0gfHwgXCJcIjtcbiAgICAgICAgY29uc3QgcGFyYW1UeXBlQ29sdW1uID0gcGFyYW1UeXBlQ2FuZGlkYXRlc1twYXJhbVR5cGVJbmRleF0gfHwgXCJcIjtcblxuICAgICAgICBpZiAocGFyYW1zLm5hbWUgIT09IHVuZGVmaW5lZCAmJiBuYW1lQ29sdW1uKSB7XG4gICAgICAgICAgcGF5bG9hZFtuYW1lQ29sdW1uXSA9IHBhcmFtcy5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMucmVwb3J0VGl0bGUgIT09IHVuZGVmaW5lZCAmJiByZXBvcnRUaXRsZUNvbHVtbikge1xuICAgICAgICAgIHBheWxvYWRbcmVwb3J0VGl0bGVDb2x1bW5dID0gcGFyYW1zLnJlcG9ydFRpdGxlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMucGFyYW1UeXBlICE9PSB1bmRlZmluZWQgJiYgcGFyYW1UeXBlQ29sdW1uKSB7XG4gICAgICAgICAgcGF5bG9hZFtwYXJhbVR5cGVDb2x1bW5dID0gcGFyYW1zLnBhcmFtVHlwZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGF0dGVtcHQgPSBhd2FpdCAoc3VwYWJhc2UgYXMgYW55KVxuICAgICAgICAgIC5mcm9tKFwiZG9jdW1lbnRfdGVtcGxhdGVzXCIpXG4gICAgICAgICAgLnVwZGF0ZShwYXlsb2FkKVxuICAgICAgICAgIC5lcShpZEZpZWxkLCBwYXJhbXMuaWQpXG4gICAgICAgICAgLnNlbGVjdChcIipcIilcbiAgICAgICAgICAubWF5YmVTaW5nbGUoKTtcblxuICAgICAgICBpZiAoIWF0dGVtcHQuZXJyb3IgJiYgYXR0ZW1wdC5kYXRhKSB7XG4gICAgICAgICAgcmV0dXJuIGF0dGVtcHQuZGF0YTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghYXR0ZW1wdC5lcnJvciAmJiAhYXR0ZW1wdC5kYXRhKSB7XG4gICAgICAgICAgbGFzdEVycm9yID0gbmV3IEVycm9yKFwi5pyq5om+5Yiw5qih5p2/XCIpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgbGFzdEVycm9yID0gYXR0ZW1wdC5lcnJvcjtcbiAgICAgICAgY29uc3QgbXNnID0gYXR0ZW1wdC5lcnJvcj8ubWVzc2FnZSB8fCBcIlwiO1xuICAgICAgICBpZiAoL2NvdWxkIG5vdCBmaW5kIHRoZSAnZG9jdW1lbnRfdGVtcGxhdGVzJyB0YWJsZSBpbiB0aGUgc2NoZW1hIGNhY2hlL2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2XkuK3mnKrmib7liLBkb2N1bWVudF90ZW1wbGF0ZXPooajvvIhzY2hlbWEgY2FjaGXvvInvvIzor7fnoa7orqTmlbDmja7lupPooajlkI3miJbmnYPpmZBcIik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtaXNzaW5nQ29sdW1uID0gZ2V0TWlzc2luZ0NvbHVtbk5hbWUobXNnKTtcbiAgICAgICAgY29uc3QgdXBkYXRlZEF0TWlzc2luZyA9XG4gICAgICAgICAgbWlzc2luZ0NvbHVtbiA9PT0gXCJ1cGRhdGVkX2F0XCIgfHxcbiAgICAgICAgICAvY29sdW1uIC4qdXBkYXRlZF9hdC4qIGRvZXMgbm90IGV4aXN0L2kudGVzdChtc2cpIHx8XG4gICAgICAgICAgL2NvdWxkIG5vdCBmaW5kIHRoZSAndXBkYXRlZF9hdCcgY29sdW1uIG9mICdkb2N1bWVudF90ZW1wbGF0ZXMnIGluIHRoZSBzY2hlbWEgY2FjaGUvaS50ZXN0KG1zZyk7XG4gICAgICAgIGlmICh1cGRhdGVkQXRNaXNzaW5nKSB7XG4gICAgICAgICAgdXBkYXRlZEF0RW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1pc3NpbmdDb2x1bW4gPT09IHRleHRDb2x1bW4gfHwgaXNTY2hlbWFDYWNoZU1pc3NpbmcobXNnKSB8fCAvY29sdW1uIC4qIGRvZXMgbm90IGV4aXN0L2kudGVzdChtc2cpKSB7XG4gICAgICAgICAgaWYgKG1pc3NpbmdDb2x1bW4gJiYgbWlzc2luZ0NvbHVtbiA9PT0gbmFtZUNvbHVtbiAmJiBuYW1lSW5kZXggKyAxIDwgbmFtZUNhbmRpZGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBuYW1lSW5kZXggKz0gMTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICBtaXNzaW5nQ29sdW1uICYmXG4gICAgICAgICAgICBtaXNzaW5nQ29sdW1uID09PSByZXBvcnRUaXRsZUNvbHVtbiAmJlxuICAgICAgICAgICAgcmVwb3J0VGl0bGVJbmRleCArIDEgPCByZXBvcnRUaXRsZUNhbmRpZGF0ZXMubGVuZ3RoXG4gICAgICAgICAgKSB7XG4gICAgICAgICAgICByZXBvcnRUaXRsZUluZGV4ICs9IDE7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgbWlzc2luZ0NvbHVtbiAmJlxuICAgICAgICAgICAgbWlzc2luZ0NvbHVtbiA9PT0gcGFyYW1UeXBlQ29sdW1uICYmXG4gICAgICAgICAgICBwYXJhbVR5cGVJbmRleCArIDEgPCBwYXJhbVR5cGVDYW5kaWRhdGVzLmxlbmd0aFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgcGFyYW1UeXBlSW5kZXggKz0gMTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobWlzc2luZ0NvbHVtbiAmJiBtaXNzaW5nQ29sdW1uID09PSB0ZXh0Q29sdW1uKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFtaXNzaW5nQ29sdW1uKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICB0aHJvdyBuZXcgRXJyb3IobGFzdEVycm9yPy5tZXNzYWdlIHx8IFwi5L+d5a2Y5aSx6LSlXCIpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFRlbXBsYXRlQnlJZCh0ZW1wbGF0ZUlkOiBzdHJpbmcpIHtcbiAgY29uc3QgaWRGaWVsZHMgPSBbXCJpZFwiLCBcInRlbXBfaWRcIiwgXCJ0ZW1wbGF0ZV9pZFwiXTtcbiAgZm9yIChjb25zdCBpZEZpZWxkIG9mIGlkRmllbGRzKSB7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgKHN1cGFiYXNlIGFzIGFueSlcbiAgICAgIC5mcm9tKFwiZG9jdW1lbnRfdGVtcGxhdGVzXCIpXG4gICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgLmVxKGlkRmllbGQsIHRlbXBsYXRlSWQpXG4gICAgICAubWF5YmVTaW5nbGUoKTtcbiAgICBpZiAoIWVycm9yKSB7XG4gICAgICBpZiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgIH1cbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBtc2cgPSBlcnJvci5tZXNzYWdlIHx8IFwiXCI7XG4gICAgaWYgKC9jb2x1bW4gLiogZG9lcyBub3QgZXhpc3QvaS50ZXN0KG1zZykpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IobXNnIHx8IFwi5p+l6K+i5aSx6LSlXCIpO1xuICB9XG4gIHJldHVybiBudWxsO1xufVxuXG5hc3luYyBmdW5jdGlvbiBkZWxldGVUZW1wbGF0ZUJ5SWQodGVtcGxhdGVJZDogc3RyaW5nKSB7XG4gIGNvbnN0IGlkRmllbGRzID0gW1wiaWRcIiwgXCJ0ZW1wX2lkXCIsIFwidGVtcGxhdGVfaWRcIl07XG4gIGxldCBsYXN0RXJyb3I6IGFueSA9IG51bGw7XG5cbiAgZm9yIChjb25zdCBpZEZpZWxkIG9mIGlkRmllbGRzKSB7XG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgKGFkbWluU3VwYWJhc2UgYXMgYW55KVxuICAgICAgLmZyb20oXCJkb2N1bWVudF90ZW1wbGF0ZXNcIilcbiAgICAgIC5kZWxldGUoKVxuICAgICAgLmVxKGlkRmllbGQsIHRlbXBsYXRlSWQpO1xuICAgIGlmICghZXJyb3IpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGFzdEVycm9yID0gZXJyb3I7XG4gICAgY29uc3QgbXNnID0gZXJyb3IubWVzc2FnZSB8fCBcIlwiO1xuICAgIGlmICgvY29sdW1uIC4qIGRvZXMgbm90IGV4aXN0L2kudGVzdChtc2cpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgaWYgKC9jb3VsZCBub3QgZmluZCB0aGUgJ2RvY3VtZW50X3RlbXBsYXRlcycgdGFibGUgaW4gdGhlIHNjaGVtYSBjYWNoZS9pLnRlc3QobXNnKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2XkuK3mnKrmib7liLBkb2N1bWVudF90ZW1wbGF0ZXPooajvvIhzY2hlbWEgY2FjaGXvvInvvIzor7fnoa7orqTmlbDmja7lupPooajlkI3miJbmnYPpmZBcIik7XG4gICAgfVxuICAgIGJyZWFrO1xuICB9XG5cbiAgaWYgKGxhc3RFcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihsYXN0RXJyb3IubWVzc2FnZSB8fCBcIuWIoOmZpOWksei0pVwiKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcTogTmV4dEFwaVJlcXVlc3QsIHJlczogTmV4dEFwaVJlc3BvbnNlKSB7XG4gIGNvbnN0IGV4cGVjdGVkVG9rZW4gPSBwcm9jZXNzLmVudi5DUk1fQVBJX1RPS0VOO1xuICBjb25zdCBoZWFkZXJUb2tlbiA9IHJlcS5oZWFkZXJzW1wieC1jcm0tdG9rZW5cIl07XG4gIGNvbnN0IHRva2VuID0gQXJyYXkuaXNBcnJheShoZWFkZXJUb2tlbikgPyBoZWFkZXJUb2tlblswXSA6IGhlYWRlclRva2VuO1xuICBpZiAoZXhwZWN0ZWRUb2tlbiAmJiB0b2tlbiAhPT0gZXhwZWN0ZWRUb2tlbikge1xuICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VLZXkpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIlN1cGFiYXNl6YWN572u57y65aSxXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgeyBpZCB9ID0gcmVxLnF1ZXJ5O1xuICBjb25zdCB0ZW1wbGF0ZUlkID0gdHlwZW9mIGlkID09PSBcInN0cmluZ1wiID8gaWQgOiBcIlwiO1xuICBpZiAoIXRlbXBsYXRlSWQpIHtcbiAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIue8uuWwkeaooeadv0lEXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiR0VUXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IGZldGNoVGVtcGxhdGVCeUlkKHRlbXBsYXRlSWQpO1xuICAgICAgY29uc3QgYXR0YWNobWVudHNSb3dzID0gYXdhaXQgZmV0Y2hBdHRhY2htZW50c0J5VGVtcGxhdGVJZCh0ZW1wbGF0ZUlkKTtcbiAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgaXRlbTogZGF0YSA/IG5vcm1hbGl6ZVRlbXBsYXRlUm93KGRhdGEpIDogbnVsbCxcbiAgICAgICAgYXR0YWNobWVudHM6IGF0dGFjaG1lbnRzUm93cy5tYXAoKHJvdykgPT4gbm9ybWFsaXplQXR0YWNobWVudFJvdyhyb3cpKVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlPy5tZXNzYWdlIHx8IFwi5p+l6K+i5aSx6LSlXCIgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiUFVUXCIpIHtcbiAgICBjb25zdCBib2R5ID0gKHJlcS5ib2R5IHx8IHt9KSBhcyBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICAgIGNvbnN0IHRleHQgPSB0b1N0cmluZ1NhZmUoYm9keS50ZXh0KTtcbiAgICBjb25zdCBuYW1lID0gYm9keS5uYW1lICE9PSB1bmRlZmluZWQgPyB0b1N0cmluZ1NhZmUoYm9keS5uYW1lKSA6IHVuZGVmaW5lZDtcbiAgICBjb25zdCByZXBvcnRUaXRsZSA9XG4gICAgICBib2R5LnJlcG9ydFRpdGxlICE9PSB1bmRlZmluZWQgPyB0b1N0cmluZ1NhZmUoYm9keS5yZXBvcnRUaXRsZSkgOiB1bmRlZmluZWQ7XG4gICAgY29uc3QgcGFyYW1UeXBlID1cbiAgICAgIGJvZHkucGFyYW1UeXBlICE9PSB1bmRlZmluZWQgPyB0b1N0cmluZ1NhZmUoYm9keS5wYXJhbVR5cGUpIDogdW5kZWZpbmVkO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1cGRhdGVkID0gYXdhaXQgdXBkYXRlVGVtcGxhdGUoe1xuICAgICAgICBpZDogdGVtcGxhdGVJZCxcbiAgICAgICAgdGV4dCxcbiAgICAgICAgbmFtZSxcbiAgICAgICAgcmVwb3J0VGl0bGUsXG4gICAgICAgIHBhcmFtVHlwZVxuICAgICAgfSk7XG4gICAgICBjb25zdCBhdHRhY2htZW50c1Jvd3MgPSBhd2FpdCBmZXRjaEF0dGFjaG1lbnRzQnlUZW1wbGF0ZUlkKHRlbXBsYXRlSWQpO1xuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICBpdGVtOiBub3JtYWxpemVUZW1wbGF0ZVJvdyh1cGRhdGVkKSxcbiAgICAgICAgYXR0YWNobWVudHM6IGF0dGFjaG1lbnRzUm93cy5tYXAoKHJvdykgPT4gbm9ybWFsaXplQXR0YWNobWVudFJvdyhyb3cpKVxuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfSBjYXRjaCAoZTogYW55KSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlPy5tZXNzYWdlIHx8IFwi5L+d5a2Y5aSx6LSlXCIgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG5cbiAgaWYgKHJlcS5tZXRob2QgPT09IFwiREVMRVRFXCIpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZGVsZXRlVGVtcGxhdGVCeUlkKHRlbXBsYXRlSWQpO1xuICAgICAgcmVzLnN0YXR1cygyMDQpLmVuZCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZT8ubWVzc2FnZSB8fCBcIuWIoOmZpOWksei0pVwiIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIHJlcy5zZXRIZWFkZXIoXCJBbGxvd1wiLCBcIkdFVCxQVVQsREVMRVRFXCIpO1xuICByZXMuc3RhdHVzKDQwNSkuZW5kKFwiTWV0aG9kIE5vdCBBbGxvd2VkXCIpO1xufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInJlYWRFbnYiLCJ2YWx1ZSIsInJhdyIsInVuZGVmaW5lZCIsIlN0cmluZyIsInRyaW0iLCJyZXBsYWNlIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VLZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwic3VwYWJhc2VTZXJ2aWNlS2V5Iiwic3VwYWJhc2UiLCJhZG1pblN1cGFiYXNlIiwiZ2V0VGVtcGxhdGVJZCIsInNvdXJjZSIsImlkIiwidGVtcF9pZCIsInRlbXBsYXRlX2lkIiwidGVtcElkIiwidGVtcGxhdGVJZCIsInV1aWQiLCJub3JtYWxpemVUZW1wbGF0ZVJvdyIsInJvdyIsInJhd1BhdGgiLCJ0ZW1wX3BhdGgiLCJwYXRoIiwiZmlsZV9wYXRoIiwiZmlsZVBhdGgiLCJ0ZXh0IiwidGVtcF9jb250ZW50IiwidGVtcF90ZXh0IiwidGVtcF9kZXNjIiwiZGVzY3JpcHRpb24iLCJjb250ZW50IiwicmVwb3J0VGl0bGUiLCJyZXBvcnRfdGl0bGUiLCJwYXJhbVR5cGUiLCJwYXJhbV90eXBlIiwibmFtZSIsInRlbXBfbmFtZSIsInR5cGUiLCJ0ZW1wX3R5cGUiLCJjcmVhdG9yIiwiY3JlYXRlZF9ieSIsImNyZWF0ZWRBdCIsImNyZWF0ZWRfYXQiLCJ1cGRhdGVkQXQiLCJ1cGRhdGVkX2F0Iiwibm9ybWFsaXplQXR0YWNobWVudFJvdyIsImZpbGVOYW1lIiwiZmlsZV9uYW1lIiwiZmlsZVNpemUiLCJmaWxlX3NpemUiLCJOdW1iZXIiLCJtaW1lVHlwZSIsIm1pbWVfdHlwZSIsImNyZWF0ZWRCeSIsImZldGNoQXR0YWNobWVudHNCeVRlbXBsYXRlSWQiLCJzZWxlY3RDb2x1bW5zQ2FuZGlkYXRlcyIsInRyeUZpZWxkcyIsImxhc3RFcnJvciIsInNlbGVjdENvbHVtbnMiLCJmaWVsZCIsImRhdGEiLCJlcnJvciIsImZyb20iLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiQXJyYXkiLCJpc0FycmF5IiwidGVzdCIsIm1lc3NhZ2UiLCJFcnJvciIsInRvU3RyaW5nU2FmZSIsInVwZGF0ZVRlbXBsYXRlIiwicGFyYW1zIiwibm93SXNvIiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiaWRGaWVsZHMiLCJpc1NjaGVtYUNhY2hlTWlzc2luZyIsIm1zZyIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJnZXRNaXNzaW5nQ29sdW1uTmFtZSIsImZyb21Eb2VzTm90RXhpc3QiLCJtYXRjaCIsImZyb21TY2hlbWFDYWNoZSIsInRleHRDYW5kaWRhdGVzIiwibmFtZUNhbmRpZGF0ZXMiLCJyZXBvcnRUaXRsZUNhbmRpZGF0ZXMiLCJwYXJhbVR5cGVDYW5kaWRhdGVzIiwiaWRGaWVsZCIsInRleHRDb2x1bW4iLCJ1cGRhdGVkQXRFbmFibGVkIiwibmFtZUluZGV4IiwicmVwb3J0VGl0bGVJbmRleCIsInBhcmFtVHlwZUluZGV4IiwiYXR0ZW1wdHMiLCJwYXlsb2FkIiwibmFtZUNvbHVtbiIsInJlcG9ydFRpdGxlQ29sdW1uIiwicGFyYW1UeXBlQ29sdW1uIiwiYXR0ZW1wdCIsInVwZGF0ZSIsIm1heWJlU2luZ2xlIiwibWlzc2luZ0NvbHVtbiIsInVwZGF0ZWRBdE1pc3NpbmciLCJsZW5ndGgiLCJmZXRjaFRlbXBsYXRlQnlJZCIsImRlbGV0ZVRlbXBsYXRlQnlJZCIsImRlbGV0ZSIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJleHBlY3RlZFRva2VuIiwiQ1JNX0FQSV9UT0tFTiIsImhlYWRlclRva2VuIiwiaGVhZGVycyIsInRva2VuIiwic3RhdHVzIiwianNvbiIsInF1ZXJ5IiwibWV0aG9kIiwiYXR0YWNobWVudHNSb3dzIiwiaXRlbSIsImF0dGFjaG1lbnRzIiwibWFwIiwiZSIsImJvZHkiLCJ1cGRhdGVkIiwiZW5kIiwic2V0SGVhZGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/templates/[id].ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ftemplates%2F%5Bid%5D&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Ctemplates%5C%5Bid%5D.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();