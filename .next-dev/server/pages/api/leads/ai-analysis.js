"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/leads/ai-analysis";
exports.ids = ["pages/api/leads/ai-analysis"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fai-analysis&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Cai-analysis.ts&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fai-analysis&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Cai-analysis.ts&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\leads\\ai-analysis.ts */ \"(api)/./pages/api/leads/ai-analysis.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/leads/ai-analysis\",\n        pathname: \"/api/leads/ai-analysis\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_leads_ai_analysis_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmxlYWRzJTJGYWktYW5hbHlzaXMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2xlYWRzJTVDYWktYW5hbHlzaXMudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDZ0U7QUFDaEU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLDREQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyw0REFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcm0tYWdlbnQtd2ViLz83MGRjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcbGVhZHNcXFxcYWktYW5hbHlzaXMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9sZWFkcy9haS1hbmFseXNpc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2xlYWRzL2FpLWFuYWx5c2lzXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fai-analysis&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Cai-analysis.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/leads/ai-analysis.ts":
/*!****************************************!*\
  !*** ./pages/api/leads/ai-analysis.ts ***!
  \****************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nfunction readEnv(value) {\n    const raw = value !== null && value !== undefined ? String(value).trim() : \"\";\n    if (!raw) {\n        return \"\";\n    }\n    return raw.replace(/^['\"`]/, \"\").replace(/['\"`]$/, \"\").trim();\n}\nconst supabaseUrl = readEnv(\"https://vvrokpefmojngpoxvsan.supabase.co\");\nconst supabaseKey = readEnv(\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cm9rcGVmbW9qbmdwb3h2c2FuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzUzNTIsImV4cCI6MjA4MzQxMTM1Mn0.t-tHn0A7uzizGEytzeaNvz-i5BGL9sqq-yGOvGE2crQ\" || 0);\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseKey || \"\");\nconst agentApiUrl = process.env.CRM_AGENT_V2_API_URL;\nasync function resolveLeadIds(leadId) {\n    const ids = [\n        leadId\n    ];\n    const { data } = await supabase.from(\"customer_leads\").select(\"id\").eq(\"线索ID\", leadId).limit(1);\n    if (data && data.length > 0 && data[0].id) {\n        const rowId = String(data[0].id);\n        if (!ids.includes(rowId)) {\n            ids.push(rowId);\n        }\n    }\n    return ids;\n}\nfunction buildLocalSummary() {\n    return [\n        \"客户的购买意向：根据当前沟通记录，客户对产品/课程表现出一定兴趣，建议继续保持高质量跟进，确认决策时间与预算安排。\",\n        \"客户感兴趣的产品：可以重点关注沟通中多次出现的需求关键词，结合已有课程或产品方案进行匹配推荐。\",\n        \"交易未达成的原因：目前仍处于沟通和需求澄清阶段，客户可能在比较不同方案或等待内部决策，需要在节奏与频率上合理跟进。\",\n        \"关于竞品：对话中如出现其他机构或解决方案，可在后续沟通中有针对性地突出自身优势和成功案例。\",\n        \"后续跟进的建议：建议整理本次沟通中的核心需求点和关键疑问，在下一轮沟通中给出更具体的方案、时间安排和报价说明。\"\n    ].join(\"\\n\");\n}\nasync function generateAnalysisFromAgent(leadId) {\n    const leadIds = await resolveLeadIds(leadId);\n    const { data, error } = await supabase.from(\"customer_communications\").select(\"*\");\n    if (error) {\n        throw new Error(error.message);\n    }\n    const rows = data || [];\n    const getRowLeadId = (row)=>row.lead_id ?? row[\"线索ID\"] ?? row[\"客户线索ID\"] ?? row.leadId ?? null;\n    const getRowTime = (row)=>row[\"发送时间\"] ?? row.created_at ?? row[\"创建时间\"] ?? row[\"createdAt\"] ?? row[\"时间\"] ?? \"\";\n    const getRowRole = (row)=>row.role ?? row[\"角色\"] ?? row[\"身份\"] ?? row[\"说话方\"] ?? row[\"说话人\"] ?? row[\"发送人\"] ?? row[\"发送方\"] ?? row[\"sender\"] ?? row[\"author\"] ?? \"未知角色\";\n    const getRowContent = (row)=>row.content ?? row[\"沟通内容\"] ?? row[\"内容\"] ?? row[\"发送内容\"] ?? row[\"消息内容\"] ?? row[\"文本\"] ?? \"\";\n    const records = rows.filter((row)=>{\n        const rowLeadId = getRowLeadId(row);\n        if (!rowLeadId) {\n            return false;\n        }\n        return leadIds.includes(String(rowLeadId));\n    });\n    if (!records.length) {\n        return [\n            \"客户的购买意向：暂无沟通记录，无法判断。\",\n            \"客户感兴趣的产品：暂无沟通记录。\",\n            \"交易未达成的原因：暂无沟通记录。\",\n            \"关于竞品：暂无沟通记录。\",\n            \"后续跟进的建议：尽快与客户建立首次沟通，了解基础需求。\"\n        ].join(\"\\n\");\n    }\n    records.sort((a, b)=>{\n        const ta = getRowTime(a);\n        const tb = getRowTime(b);\n        const taNum = ta ? new Date(String(ta)).getTime() : 0;\n        const tbNum = tb ? new Date(String(tb)).getTime() : 0;\n        return taNum - tbNum;\n    });\n    const lines = records.map((row)=>{\n        const time = getRowTime(row);\n        const role = getRowRole(row);\n        const content = getRowContent(row);\n        return `${time} ${role}：${content}`;\n    });\n    const conversation = lines.join(\"\\n\");\n    const prompt = [\n        \"下面是某个客户的全部沟通记录，请你用简短中文做结构化总结。\",\n        \"每个维度控制在1到2句话内，避免内容过长。\",\n        \"\",\n        \"【沟通记录】\",\n        conversation,\n        \"\",\n        \"请严格按照下面的格式输出（不要添加额外说明）：\",\n        \"\",\n        \"客户的购买意向：...\",\n        \"客户感兴趣的产品：...\",\n        \"交易未达成的原因：...\",\n        \"关于竞品：...\",\n        \"后续跟进的建议：...\"\n    ].join(\"\\n\");\n    if (!agentApiUrl) {\n        return buildLocalSummary();\n    }\n    try {\n        const agentResponse = await fetch(agentApiUrl, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                input: prompt\n            })\n        });\n        if (!agentResponse.ok) {\n            throw new Error(`Agent请求失败: ${agentResponse.status}`);\n        }\n        const agentData = await agentResponse.json();\n        const content = typeof agentData.output === \"string\" ? agentData.output : typeof agentData.result === \"string\" ? agentData.result : \"\";\n        if (!content) {\n            throw new Error(\"Agent未返回内容\");\n        }\n        return content;\n    } catch  {\n        return buildLocalSummary();\n    }\n}\nasync function handler(req, res) {\n    const expectedToken = process.env.CRM_API_TOKEN;\n    const headerToken = req.headers[\"x-crm-token\"];\n    const token = Array.isArray(headerToken) ? headerToken[0] : headerToken;\n    if (expectedToken && token !== expectedToken) {\n        res.status(401).json({\n            error: \"Unauthorized\"\n        });\n        return;\n    }\n    if (!supabaseUrl || !supabaseKey) {\n        res.status(500).json({\n            error: \"Supabase配置缺失\"\n        });\n        return;\n    }\n    const { leadId } = req.query;\n    if (!leadId || typeof leadId !== \"string\") {\n        res.status(400).json({\n            error: \"缺少leadId\"\n        });\n        return;\n    }\n    if (req.method === \"GET\") {\n        const { data, error } = await supabase.from(\"customer_ai_analysis\").select(\"*\").eq(\"clue_id\", leadId).order(\"ai_version\", {\n            ascending: false\n        }).limit(1);\n        if (error) {\n            res.status(500).json({\n                error: error.message\n            });\n            return;\n        }\n        const row = data && data.length > 0 ? data[0] : null;\n        if (!row) {\n            res.status(200).json({\n                item: null\n            });\n            return;\n        }\n        res.status(200).json({\n            item: {\n                id: row.id,\n                leadId: row.clue_id,\n                content: row.ai_content,\n                createdAt: row.created_at\n            }\n        });\n        return;\n    }\n    if (req.method === \"POST\") {\n        try {\n            const [content, leadOwnerRows] = await Promise.all([\n                generateAnalysisFromAgent(leadId),\n                supabase.from(\"customer_leads\").select(\"负责销售员\").eq(\"线索ID\", leadId).limit(1)\n            ]);\n            const leadOwner = leadOwnerRows && leadOwnerRows.data && leadOwnerRows.data.length > 0 && leadOwnerRows.data[0][\"负责销售员\"] ? String(leadOwnerRows.data[0][\"负责销售员\"]) : null;\n            const { data: latestVersionRows } = await supabase.from(\"customer_ai_analysis\").select(\"ai_version\").eq(\"clue_id\", leadId).order(\"ai_version\", {\n                ascending: false\n            }).limit(1);\n            const latestVersion = latestVersionRows && latestVersionRows.length > 0 ? Number(latestVersionRows[0].ai_version) || 0 : 0;\n            const nextVersion = latestVersion + 1;\n            await supabase.from(\"customer_ai_analysis\").update({\n                is_current: 0\n            }).eq(\"clue_id\", leadId).eq(\"is_current\", 1);\n            const insertPayload = {\n                clue_id: leadId,\n                ai_content: content,\n                is_current: 1,\n                ai_version: nextVersion,\n                generate_user: leadOwner,\n                generate_time: new Date().toISOString(),\n                communication_ids: null\n            };\n            const { data, error } = await supabase.from(\"customer_ai_analysis\").insert(insertPayload).select(\"*\").single();\n            if (error) {\n                res.status(500).json({\n                    error: error.message\n                });\n                return;\n            }\n            res.status(201).json({\n                item: {\n                    id: data.id,\n                    leadId: data.clue_id,\n                    content: data.ai_content,\n                    createdAt: data.created_at\n                }\n            });\n            return;\n        } catch (e) {\n            res.status(500).json({\n                error: e?.message || \"AI分析生成失败\"\n            });\n            return;\n        }\n    }\n    res.setHeader(\"Allow\", \"GET,POST\");\n    res.status(405).end(\"Method Not Allowed\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUt3RSxVQUFVO29CQUN4QkMsV0FBV3pFLEtBQUtzQixVQUFVO2dCQUM1QjtZQUNGO1lBQ0E7UUFDRixFQUFFLE9BQU9zRSxHQUFRO1lBQ2ZoQyxJQUFJUCxNQUFNLENBQUMsS0FBS0UsSUFBSSxDQUFDO2dCQUFFekMsT0FBTzhFLEdBQUc1RSxXQUFXO1lBQVc7WUFDdkQ7UUFDRjtJQUNGO0lBRUE0QyxJQUFJaUMsU0FBUyxDQUFDLFNBQVM7SUFDdkJqQyxJQUFJUCxNQUFNLENBQUMsS0FBS3lDLEdBQUcsQ0FBQztBQUN0QiIsInNvdXJjZXMiOlsid2VicGFjazovL2NybS1hZ2VudC13ZWIvLi9wYWdlcy9hcGkvbGVhZHMvYWktYW5hbHlzaXMudHM/ZDQ4NyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tIFwibmV4dFwiO1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5mdW5jdGlvbiByZWFkRW52KHZhbHVlOiB1bmtub3duKSB7XG4gIGNvbnN0IHJhdyA9IHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgPyBTdHJpbmcodmFsdWUpLnRyaW0oKSA6IFwiXCI7XG4gIGlmICghcmF3KSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgcmV0dXJuIHJhdy5yZXBsYWNlKC9eWydcImBdLywgXCJcIikucmVwbGFjZSgvWydcImBdJC8sIFwiXCIpLnRyaW0oKTtcbn1cblxuY29uc3Qgc3VwYWJhc2VVcmwgPSByZWFkRW52KHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCk7XG5jb25zdCBzdXBhYmFzZUtleSA9IHJlYWRFbnYoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfS0VZXG4pO1xuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VLZXkgfHwgXCJcIik7XG5cbmNvbnN0IGFnZW50QXBpVXJsID0gcHJvY2Vzcy5lbnYuQ1JNX0FHRU5UX1YyX0FQSV9VUkw7XG5cbmFzeW5jIGZ1bmN0aW9uIHJlc29sdmVMZWFkSWRzKGxlYWRJZDogc3RyaW5nKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICBjb25zdCBpZHM6IHN0cmluZ1tdID0gW2xlYWRJZF07XG5cbiAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKFwiY3VzdG9tZXJfbGVhZHNcIilcbiAgICAuc2VsZWN0KFwiaWRcIilcbiAgICAuZXEoXCLnur/ntKJJRFwiLCBsZWFkSWQpXG4gICAgLmxpbWl0KDEpO1xuXG4gIGlmIChkYXRhICYmIGRhdGEubGVuZ3RoID4gMCAmJiAoZGF0YVswXSBhcyBhbnkpLmlkKSB7XG4gICAgY29uc3Qgcm93SWQgPSBTdHJpbmcoKGRhdGFbMF0gYXMgYW55KS5pZCk7XG4gICAgaWYgKCFpZHMuaW5jbHVkZXMocm93SWQpKSB7XG4gICAgICBpZHMucHVzaChyb3dJZCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGlkcztcbn1cblxuZnVuY3Rpb24gYnVpbGRMb2NhbFN1bW1hcnkoKTogc3RyaW5nIHtcbiAgcmV0dXJuIFtcbiAgICBcIuWuouaIt+eahOi0reS5sOaEj+WQke+8muagueaNruW9k+WJjeayn+mAmuiusOW9le+8jOWuouaIt+WvueS6p+WTgS/or77nqIvooajnjrDlh7rkuIDlrprlhbTotqPvvIzlu7rorq7nu6fnu63kv53mjIHpq5jotKjph4/ot5/ov5vvvIznoa7orqTlhrPnrZbml7bpl7TkuI7pooTnrpflronmjpLjgIJcIixcbiAgICBcIuWuouaIt+aEn+WFtOi2o+eahOS6p+WTge+8muWPr+S7pemHjeeCueWFs+azqOayn+mAmuS4reWkmuasoeWHuueOsOeahOmcgOaxguWFs+mUruivje+8jOe7k+WQiOW3suacieivvueoi+aIluS6p+WTgeaWueahiOi/m+ihjOWMuemFjeaOqOiNkOOAglwiLFxuICAgIFwi5Lqk5piT5pyq6L6+5oiQ55qE5Y6f5Zug77ya55uu5YmN5LuN5aSE5LqO5rKf6YCa5ZKM6ZyA5rGC5r6E5riF6Zi25q6177yM5a6i5oi35Y+v6IO95Zyo5q+U6L6D5LiN5ZCM5pa55qGI5oiW562J5b6F5YaF6YOo5Yaz562W77yM6ZyA6KaB5Zyo6IqC5aWP5LiO6aKR546H5LiK5ZCI55CG6Lef6L+b44CCXCIsXG4gICAgXCLlhbPkuo7nq57lk4HvvJrlr7nor53kuK3lpoLlh7rnjrDlhbbku5bmnLrmnoTmiJbop6PlhrPmlrnmoYjvvIzlj6/lnKjlkI7nu63msp/pgJrkuK3mnInpkojlr7nmgKflnLDnqoHlh7roh6rouqvkvJjlir/lkozmiJDlip/moYjkvovjgIJcIixcbiAgICBcIuWQjue7rei3n+i/m+eahOW7uuiuru+8muW7uuiuruaVtOeQhuacrOasoeayn+mAmuS4reeahOaguOW/g+mcgOaxgueCueWSjOWFs+mUrueWkemXru+8jOWcqOS4i+S4gOi9ruayn+mAmuS4ree7meWHuuabtOWFt+S9k+eahOaWueahiOOAgeaXtumXtOWuieaOkuWSjOaKpeS7t+ivtOaYjuOAglwiXG4gIF0uam9pbihcIlxcblwiKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVBbmFseXNpc0Zyb21BZ2VudChsZWFkSWQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIGNvbnN0IGxlYWRJZHMgPSBhd2FpdCByZXNvbHZlTGVhZElkcyhsZWFkSWQpO1xuXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgLmZyb20oXCJjdXN0b21lcl9jb21tdW5pY2F0aW9uc1wiKVxuICAgIC5zZWxlY3QoXCIqXCIpO1xuXG4gIGlmIChlcnJvcikge1xuICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5tZXNzYWdlKTtcbiAgfVxuXG4gIGNvbnN0IHJvd3MgPSBkYXRhIHx8IFtdO1xuXG4gIGNvbnN0IGdldFJvd0xlYWRJZCA9IChyb3c6IGFueSkgPT5cbiAgICByb3cubGVhZF9pZCA/P1xuICAgIHJvd1tcIue6v+e0oklEXCJdID8/XG4gICAgcm93W1wi5a6i5oi357q/57SiSURcIl0gPz9cbiAgICByb3cubGVhZElkID8/XG4gICAgbnVsbDtcblxuICBjb25zdCBnZXRSb3dUaW1lID0gKHJvdzogYW55KSA9PlxuICAgIHJvd1tcIuWPkemAgeaXtumXtFwiXSA/P1xuICAgIHJvdy5jcmVhdGVkX2F0ID8/XG4gICAgcm93W1wi5Yib5bu65pe26Ze0XCJdID8/XG4gICAgcm93W1wiY3JlYXRlZEF0XCJdID8/XG4gICAgcm93W1wi5pe26Ze0XCJdID8/XG4gICAgXCJcIjtcblxuICBjb25zdCBnZXRSb3dSb2xlID0gKHJvdzogYW55KSA9PlxuICAgIHJvdy5yb2xlID8/XG4gICAgcm93W1wi6KeS6ImyXCJdID8/XG4gICAgcm93W1wi6Lqr5Lu9XCJdID8/XG4gICAgcm93W1wi6K+06K+d5pa5XCJdID8/XG4gICAgcm93W1wi6K+06K+d5Lq6XCJdID8/XG4gICAgcm93W1wi5Y+R6YCB5Lq6XCJdID8/XG4gICAgcm93W1wi5Y+R6YCB5pa5XCJdID8/XG4gICAgcm93W1wic2VuZGVyXCJdID8/XG4gICAgcm93W1wiYXV0aG9yXCJdID8/XG4gICAgXCLmnKrnn6Xop5LoibJcIjtcblxuICBjb25zdCBnZXRSb3dDb250ZW50ID0gKHJvdzogYW55KSA9PlxuICAgIHJvdy5jb250ZW50ID8/XG4gICAgcm93W1wi5rKf6YCa5YaF5a65XCJdID8/XG4gICAgcm93W1wi5YaF5a65XCJdID8/XG4gICAgcm93W1wi5Y+R6YCB5YaF5a65XCJdID8/XG4gICAgcm93W1wi5raI5oGv5YaF5a65XCJdID8/XG4gICAgcm93W1wi5paH5pysXCJdID8/XG4gICAgXCJcIjtcblxuICBjb25zdCByZWNvcmRzID0gcm93cy5maWx0ZXIoKHJvdzogYW55KSA9PiB7XG4gICAgY29uc3Qgcm93TGVhZElkID0gZ2V0Um93TGVhZElkKHJvdyk7XG4gICAgaWYgKCFyb3dMZWFkSWQpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGxlYWRJZHMuaW5jbHVkZXMoU3RyaW5nKHJvd0xlYWRJZCkpO1xuICB9KTtcblxuICBpZiAoIXJlY29yZHMubGVuZ3RoKSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIFwi5a6i5oi355qE6LSt5Lmw5oSP5ZCR77ya5pqC5peg5rKf6YCa6K6w5b2V77yM5peg5rOV5Yik5pat44CCXCIsXG4gICAgICBcIuWuouaIt+aEn+WFtOi2o+eahOS6p+WTge+8muaaguaXoOayn+mAmuiusOW9leOAglwiLFxuICAgICAgXCLkuqTmmJPmnKrovr7miJDnmoTljp/lm6DvvJrmmoLml6Dmsp/pgJrorrDlvZXjgIJcIixcbiAgICAgIFwi5YWz5LqO56ue5ZOB77ya5pqC5peg5rKf6YCa6K6w5b2V44CCXCIsXG4gICAgICBcIuWQjue7rei3n+i/m+eahOW7uuiuru+8muWwveW/q+S4juWuouaIt+W7uueri+mmluasoeayn+mAmu+8jOS6huino+WfuuehgOmcgOaxguOAglwiXG4gICAgXS5qb2luKFwiXFxuXCIpO1xuICB9XG5cbiAgcmVjb3Jkcy5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgIGNvbnN0IHRhID0gZ2V0Um93VGltZShhKTtcbiAgICBjb25zdCB0YiA9IGdldFJvd1RpbWUoYik7XG4gICAgY29uc3QgdGFOdW0gPSB0YSA/IG5ldyBEYXRlKFN0cmluZyh0YSkpLmdldFRpbWUoKSA6IDA7XG4gICAgY29uc3QgdGJOdW0gPSB0YiA/IG5ldyBEYXRlKFN0cmluZyh0YikpLmdldFRpbWUoKSA6IDA7XG4gICAgcmV0dXJuIHRhTnVtIC0gdGJOdW07XG4gIH0pO1xuXG4gIGNvbnN0IGxpbmVzID0gcmVjb3Jkcy5tYXAoKHJvdzogYW55KSA9PiB7XG4gICAgY29uc3QgdGltZSA9IGdldFJvd1RpbWUocm93KTtcbiAgICBjb25zdCByb2xlID0gZ2V0Um93Um9sZShyb3cpO1xuICAgIGNvbnN0IGNvbnRlbnQgPSBnZXRSb3dDb250ZW50KHJvdyk7XG4gICAgcmV0dXJuIGAke3RpbWV9ICR7cm9sZX3vvJoke2NvbnRlbnR9YDtcbiAgfSk7XG5cbiAgY29uc3QgY29udmVyc2F0aW9uID0gbGluZXMuam9pbihcIlxcblwiKTtcblxuICBjb25zdCBwcm9tcHQgPSBbXG4gICAgXCLkuIvpnaLmmK/mn5DkuKrlrqLmiLfnmoTlhajpg6jmsp/pgJrorrDlvZXvvIzor7fkvaDnlKjnroDnn63kuK3mloflgZrnu5PmnoTljJbmgLvnu5PjgIJcIixcbiAgICBcIuavj+S4que7tOW6puaOp+WItuWcqDHliLAy5Y+l6K+d5YaF77yM6YG/5YWN5YaF5a656L+H6ZW/44CCXCIsXG4gICAgXCJcIixcbiAgICBcIuOAkOayn+mAmuiusOW9leOAkVwiLFxuICAgIGNvbnZlcnNhdGlvbixcbiAgICBcIlwiLFxuICAgIFwi6K+35Lil5qC85oyJ54Wn5LiL6Z2i55qE5qC85byP6L6T5Ye677yI5LiN6KaB5re75Yqg6aKd5aSW6K+05piO77yJ77yaXCIsXG4gICAgXCJcIixcbiAgICBcIuWuouaIt+eahOi0reS5sOaEj+WQke+8mi4uLlwiLFxuICAgIFwi5a6i5oi35oSf5YW06Laj55qE5Lqn5ZOB77yaLi4uXCIsXG4gICAgXCLkuqTmmJPmnKrovr7miJDnmoTljp/lm6DvvJouLi5cIixcbiAgICBcIuWFs+S6juernuWTge+8mi4uLlwiLFxuICAgIFwi5ZCO57ut6Lef6L+b55qE5bu66K6u77yaLi4uXCJcbiAgXS5qb2luKFwiXFxuXCIpO1xuXG4gIGlmICghYWdlbnRBcGlVcmwpIHtcbiAgICByZXR1cm4gYnVpbGRMb2NhbFN1bW1hcnkoKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgYWdlbnRSZXNwb25zZSA9IGF3YWl0IGZldGNoKGFnZW50QXBpVXJsLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgaW5wdXQ6IHByb21wdFxuICAgICAgfSlcbiAgICB9KTtcblxuICAgIGlmICghYWdlbnRSZXNwb25zZS5vaykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBZ2VudOivt+axguWksei0pTogJHthZ2VudFJlc3BvbnNlLnN0YXR1c31gKTtcbiAgICB9XG5cbiAgICBjb25zdCBhZ2VudERhdGEgPSBhd2FpdCBhZ2VudFJlc3BvbnNlLmpzb24oKTtcbiAgICBjb25zdCBjb250ZW50ID1cbiAgICAgIHR5cGVvZiBhZ2VudERhdGEub3V0cHV0ID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gYWdlbnREYXRhLm91dHB1dFxuICAgICAgICA6IHR5cGVvZiBhZ2VudERhdGEucmVzdWx0ID09PSBcInN0cmluZ1wiXG4gICAgICAgID8gYWdlbnREYXRhLnJlc3VsdFxuICAgICAgICA6IFwiXCI7XG5cbiAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcIkFnZW505pyq6L+U5Zue5YaF5a65XCIpO1xuICAgIH1cblxuICAgIHJldHVybiBjb250ZW50O1xuICB9IGNhdGNoIHtcbiAgICByZXR1cm4gYnVpbGRMb2NhbFN1bW1hcnkoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZVxuKSB7XG4gIGNvbnN0IGV4cGVjdGVkVG9rZW4gPSBwcm9jZXNzLmVudi5DUk1fQVBJX1RPS0VOO1xuICBjb25zdCBoZWFkZXJUb2tlbiA9IHJlcS5oZWFkZXJzW1wieC1jcm0tdG9rZW5cIl07XG4gIGNvbnN0IHRva2VuID0gQXJyYXkuaXNBcnJheShoZWFkZXJUb2tlbikgPyBoZWFkZXJUb2tlblswXSA6IGhlYWRlclRva2VuO1xuICBpZiAoZXhwZWN0ZWRUb2tlbiAmJiB0b2tlbiAhPT0gZXhwZWN0ZWRUb2tlbikge1xuICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VLZXkpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIlN1cGFiYXNl6YWN572u57y65aSxXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgeyBsZWFkSWQgfSA9IHJlcS5xdWVyeTtcblxuICBpZiAoIWxlYWRJZCB8fCB0eXBlb2YgbGVhZElkICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCLnvLrlsJFsZWFkSWRcIiB9KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJHRVRcIikge1xuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShcImN1c3RvbWVyX2FpX2FuYWx5c2lzXCIpXG4gICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgLmVxKFwiY2x1ZV9pZFwiLCBsZWFkSWQpXG4gICAgICAub3JkZXIoXCJhaV92ZXJzaW9uXCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHJvdyA9IGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwID8gZGF0YVswXSA6IG51bGw7XG5cbiAgICBpZiAoIXJvdykge1xuICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBpdGVtOiBudWxsIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgIGl0ZW06IHtcbiAgICAgICAgaWQ6IHJvdy5pZCxcbiAgICAgICAgbGVhZElkOiByb3cuY2x1ZV9pZCxcbiAgICAgICAgY29udGVudDogcm93LmFpX2NvbnRlbnQsXG4gICAgICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXRcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJQT1NUXCIpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgW2NvbnRlbnQsIGxlYWRPd25lclJvd3NdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBnZW5lcmF0ZUFuYWx5c2lzRnJvbUFnZW50KGxlYWRJZCksXG4gICAgICAgIHN1cGFiYXNlXG4gICAgICAgICAgLmZyb20oXCJjdXN0b21lcl9sZWFkc1wiKVxuICAgICAgICAgIC5zZWxlY3QoXCLotJ/otKPplIDllK7lkZhcIilcbiAgICAgICAgICAuZXEoXCLnur/ntKJJRFwiLCBsZWFkSWQpXG4gICAgICAgICAgLmxpbWl0KDEpXG4gICAgICBdKTtcblxuICAgICAgY29uc3QgbGVhZE93bmVyID1cbiAgICAgICAgbGVhZE93bmVyUm93cyAmJlxuICAgICAgICBsZWFkT3duZXJSb3dzLmRhdGEgJiZcbiAgICAgICAgbGVhZE93bmVyUm93cy5kYXRhLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgKGxlYWRPd25lclJvd3MuZGF0YVswXSBhcyBhbnkpW1wi6LSf6LSj6ZSA5ZSu5ZGYXCJdXG4gICAgICAgICAgPyBTdHJpbmcoKGxlYWRPd25lclJvd3MuZGF0YVswXSBhcyBhbnkpW1wi6LSf6LSj6ZSA5ZSu5ZGYXCJdKVxuICAgICAgICAgIDogbnVsbDtcblxuICAgICAgY29uc3QgeyBkYXRhOiBsYXRlc3RWZXJzaW9uUm93cyB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oXCJjdXN0b21lcl9haV9hbmFseXNpc1wiKVxuICAgICAgICAuc2VsZWN0KFwiYWlfdmVyc2lvblwiKVxuICAgICAgICAuZXEoXCJjbHVlX2lkXCIsIGxlYWRJZClcbiAgICAgICAgLm9yZGVyKFwiYWlfdmVyc2lvblwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBjb25zdCBsYXRlc3RWZXJzaW9uID1cbiAgICAgICAgbGF0ZXN0VmVyc2lvblJvd3MgJiYgbGF0ZXN0VmVyc2lvblJvd3MubGVuZ3RoID4gMFxuICAgICAgICAgID8gTnVtYmVyKChsYXRlc3RWZXJzaW9uUm93c1swXSBhcyBhbnkpLmFpX3ZlcnNpb24pIHx8IDBcbiAgICAgICAgICA6IDA7XG4gICAgICBjb25zdCBuZXh0VmVyc2lvbiA9IGxhdGVzdFZlcnNpb24gKyAxO1xuXG4gICAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbShcImN1c3RvbWVyX2FpX2FuYWx5c2lzXCIpXG4gICAgICAgIC51cGRhdGUoeyBpc19jdXJyZW50OiAwIH0pXG4gICAgICAgIC5lcShcImNsdWVfaWRcIiwgbGVhZElkKVxuICAgICAgICAuZXEoXCJpc19jdXJyZW50XCIsIDEpO1xuXG4gICAgICBjb25zdCBpbnNlcnRQYXlsb2FkID0ge1xuICAgICAgICBjbHVlX2lkOiBsZWFkSWQsXG4gICAgICAgIGFpX2NvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgIGlzX2N1cnJlbnQ6IDEsXG4gICAgICAgIGFpX3ZlcnNpb246IG5leHRWZXJzaW9uLFxuICAgICAgICBnZW5lcmF0ZV91c2VyOiBsZWFkT3duZXIsXG4gICAgICAgIGdlbmVyYXRlX3RpbWU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgY29tbXVuaWNhdGlvbl9pZHM6IG51bGxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKFwiY3VzdG9tZXJfYWlfYW5hbHlzaXNcIilcbiAgICAgICAgLmluc2VydChpbnNlcnRQYXlsb2FkKVxuICAgICAgICAuc2VsZWN0KFwiKlwiKVxuICAgICAgICAuc2luZ2xlKCk7XG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgaXRlbToge1xuICAgICAgICAgIGlkOiBkYXRhLmlkLFxuICAgICAgICAgIGxlYWRJZDogZGF0YS5jbHVlX2lkLFxuICAgICAgICAgIGNvbnRlbnQ6IGRhdGEuYWlfY29udGVudCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGRhdGEuY3JlYXRlZF9hdFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9IGNhdGNoIChlOiBhbnkpIHtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGU/Lm1lc3NhZ2UgfHwgXCJBSeWIhuaekOeUn+aIkOWksei0pVwiIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIHJlcy5zZXRIZWFkZXIoXCJBbGxvd1wiLCBcIkdFVCxQT1NUXCIpO1xuICByZXMuc3RhdHVzKDQwNSkuZW5kKFwiTWV0aG9kIE5vdCBBbGxvd2VkXCIpO1xufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInJlYWRFbnYiLCJ2YWx1ZSIsInJhdyIsInVuZGVmaW5lZCIsIlN0cmluZyIsInRyaW0iLCJyZXBsYWNlIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VLZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwic3VwYWJhc2UiLCJhZ2VudEFwaVVybCIsIkNSTV9BR0VOVF9WMl9BUElfVVJMIiwicmVzb2x2ZUxlYWRJZHMiLCJsZWFkSWQiLCJpZHMiLCJkYXRhIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibGltaXQiLCJsZW5ndGgiLCJpZCIsInJvd0lkIiwiaW5jbHVkZXMiLCJwdXNoIiwiYnVpbGRMb2NhbFN1bW1hcnkiLCJqb2luIiwiZ2VuZXJhdGVBbmFseXNpc0Zyb21BZ2VudCIsImxlYWRJZHMiLCJlcnJvciIsIkVycm9yIiwibWVzc2FnZSIsInJvd3MiLCJnZXRSb3dMZWFkSWQiLCJyb3ciLCJsZWFkX2lkIiwiZ2V0Um93VGltZSIsImNyZWF0ZWRfYXQiLCJnZXRSb3dSb2xlIiwicm9sZSIsImdldFJvd0NvbnRlbnQiLCJjb250ZW50IiwicmVjb3JkcyIsImZpbHRlciIsInJvd0xlYWRJZCIsInNvcnQiLCJhIiwiYiIsInRhIiwidGIiLCJ0YU51bSIsIkRhdGUiLCJnZXRUaW1lIiwidGJOdW0iLCJsaW5lcyIsIm1hcCIsInRpbWUiLCJjb252ZXJzYXRpb24iLCJwcm9tcHQiLCJhZ2VudFJlc3BvbnNlIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbnB1dCIsIm9rIiwic3RhdHVzIiwiYWdlbnREYXRhIiwianNvbiIsIm91dHB1dCIsInJlc3VsdCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJleHBlY3RlZFRva2VuIiwiQ1JNX0FQSV9UT0tFTiIsImhlYWRlclRva2VuIiwidG9rZW4iLCJBcnJheSIsImlzQXJyYXkiLCJxdWVyeSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiaXRlbSIsImNsdWVfaWQiLCJhaV9jb250ZW50IiwiY3JlYXRlZEF0IiwibGVhZE93bmVyUm93cyIsIlByb21pc2UiLCJhbGwiLCJsZWFkT3duZXIiLCJsYXRlc3RWZXJzaW9uUm93cyIsImxhdGVzdFZlcnNpb24iLCJOdW1iZXIiLCJhaV92ZXJzaW9uIiwibmV4dFZlcnNpb24iLCJ1cGRhdGUiLCJpc19jdXJyZW50IiwiaW5zZXJ0UGF5bG9hZCIsImdlbmVyYXRlX3VzZXIiLCJnZW5lcmF0ZV90aW1lIiwidG9JU09TdHJpbmciLCJjb21tdW5pY2F0aW9uX2lkcyIsImluc2VydCIsInNpbmdsZSIsImUiLCJzZXRIZWFkZXIiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/leads/ai-analysis.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fai-analysis&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Cai-analysis.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();