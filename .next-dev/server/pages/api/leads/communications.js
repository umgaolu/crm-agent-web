"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/leads/communications";
exports.ids = ["pages/api/leads/communications"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "@supabase/supabase-js":
/*!****************************************!*\
  !*** external "@supabase/supabase-js" ***!
  \****************************************/
/***/ ((module) => {

module.exports = import("@supabase/supabase-js");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fcommunications&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Ccommunications.ts&middlewareConfigBase64=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fcommunications&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Ccommunications.ts&middlewareConfigBase64=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\leads\\communications.ts */ \"(api)/./pages/api/leads/communications.ts\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/leads/communications\",\n        pathname: \"/api/leads/communications\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_leads_communications_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmxlYWRzJTJGY29tbXVuaWNhdGlvbnMmcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2xlYWRzJTVDY29tbXVuaWNhdGlvbnMudHMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ0w7QUFDMUQ7QUFDbUU7QUFDbkU7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLCtEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQywrREFBUTtBQUNwQztBQUNPLHdCQUF3QixnSEFBbUI7QUFDbEQ7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcm0tYWdlbnQtd2ViLz83MTBkIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhZ2VzQVBJUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgaG9pc3QgfSBmcm9tIFwibmV4dC9kaXN0L2J1aWxkL3RlbXBsYXRlcy9oZWxwZXJzXCI7XG4vLyBJbXBvcnQgdGhlIHVzZXJsYW5kIGNvZGUuXG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiLi9wYWdlc1xcXFxhcGlcXFxcbGVhZHNcXFxcY29tbXVuaWNhdGlvbnMudHNcIjtcbi8vIFJlLWV4cG9ydCB0aGUgaGFuZGxlciAoc2hvdWxkIGJlIHRoZSBkZWZhdWx0IGV4cG9ydCkuXG5leHBvcnQgZGVmYXVsdCBob2lzdCh1c2VybGFuZCwgXCJkZWZhdWx0XCIpO1xuLy8gUmUtZXhwb3J0IGNvbmZpZy5cbmV4cG9ydCBjb25zdCBjb25maWcgPSBob2lzdCh1c2VybGFuZCwgXCJjb25maWdcIik7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9sZWFkcy9jb21tdW5pY2F0aW9uc1wiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2xlYWRzL2NvbW11bmljYXRpb25zXCIsXG4gICAgICAgIC8vIFRoZSBmb2xsb3dpbmcgYXJlbid0IHVzZWQgaW4gcHJvZHVjdGlvbi5cbiAgICAgICAgYnVuZGxlUGF0aDogXCJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwiXCJcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fcommunications&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Ccommunications.ts&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/leads/communications.ts":
/*!*******************************************!*\
  !*** ./pages/api/leads/communications.ts ***!
  \*******************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"@supabase/supabase-js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__]);\n_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\nfunction readEnv(value) {\n    const raw = value !== null && value !== undefined ? String(value).trim() : \"\";\n    if (!raw) {\n        return \"\";\n    }\n    return raw.replace(/^['\"`]/, \"\").replace(/['\"`]$/, \"\").trim();\n}\nconst supabaseUrl = readEnv(\"https://vvrokpefmojngpoxvsan.supabase.co\");\nconst supabaseKey = readEnv(\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2cm9rcGVmbW9qbmdwb3h2c2FuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4MzUzNTIsImV4cCI6MjA4MzQxMTM1Mn0.t-tHn0A7uzizGEytzeaNvz-i5BGL9sqq-yGOvGE2crQ\" || 0);\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseKey || \"\");\nasync function handler(req, res) {\n    const expectedToken = process.env.CRM_API_TOKEN;\n    const headerToken = req.headers[\"x-crm-token\"];\n    const token = Array.isArray(headerToken) ? headerToken[0] : headerToken;\n    if (expectedToken && token !== expectedToken) {\n        res.status(401).json({\n            error: \"Unauthorized\"\n        });\n        return;\n    }\n    if (!supabaseUrl || !supabaseKey) {\n        res.status(500).json({\n            error: \"Supabase配置缺失\"\n        });\n        return;\n    }\n    const { leadId } = req.query;\n    if (!leadId || typeof leadId !== \"string\") {\n        res.status(400).json({\n            error: \"缺少leadId\"\n        });\n        return;\n    }\n    if (req.method === \"GET\") {\n        const leadIds = [\n            leadId\n        ];\n        const { data: leadRows } = await supabase.from(\"customer_leads\").select(\"id\").eq(\"线索ID\", leadId).limit(1);\n        if (leadRows && leadRows.length > 0 && leadRows[0].id) {\n            const rowId = String(leadRows[0].id);\n            if (!leadIds.includes(rowId)) {\n                leadIds.push(rowId);\n            }\n        }\n        const { data, error } = await supabase.from(\"customer_communications\").select(\"*\");\n        if (error) {\n            res.status(500).json({\n                error: error.message\n            });\n            return;\n        }\n        const rows = data || [];\n        const getRowLeadId = (row)=>row.lead_id ?? row[\"线索ID\"] ?? row[\"客户线索ID\"] ?? row.leadId ?? null;\n        const getRowTime = (row)=>row[\"发送时间\"] ?? row.created_at ?? row[\"创建时间\"] ?? row[\"createdAt\"] ?? row[\"时间\"] ?? null;\n        const getRowRole = (row)=>row.role ?? row[\"角色\"] ?? row[\"身份\"] ?? row[\"说话方\"] ?? row[\"说话人\"] ?? row[\"发送人\"] ?? row[\"发送方\"] ?? row[\"sender\"] ?? row[\"author\"] ?? null;\n        const filtered = rows.filter((row)=>{\n            const rowLeadId = getRowLeadId(row);\n            if (!rowLeadId) {\n                return false;\n            }\n            return leadIds.includes(String(rowLeadId));\n        });\n        filtered.sort((a, b)=>{\n            const ta = getRowTime(a);\n            const tb = getRowTime(b);\n            const taNum = ta ? new Date(String(ta)).getTime() : 0;\n            const tbNum = tb ? new Date(String(tb)).getTime() : 0;\n            return taNum - tbNum;\n        });\n        const items = filtered.map((row)=>{\n            const rowLeadId = getRowLeadId(row);\n            const rowTime = getRowTime(row);\n            const rowRole = getRowRole(row);\n            const rowContent = row.content ?? row[\"沟通内容\"] ?? row[\"内容\"] ?? row[\"发送内容\"] ?? row[\"消息内容\"] ?? row[\"文本\"] ?? null;\n            return {\n                id: row.id ?? String(row[\"id\"]),\n                leadId: rowLeadId ? String(rowLeadId) : \"\",\n                role: rowRole,\n                content: rowContent,\n                createdAt: rowTime\n            };\n        });\n        res.status(200).json({\n            items\n        });\n        return;\n    }\n    res.setHeader(\"Allow\", \"GET\");\n    res.status(405).end(\"Method Not Allowed\");\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVNEO2dCQUNURSxXQUFXSjtZQUNiO1FBQ0Y7UUFFQWpELElBQUlRLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRXNDO1FBQU07UUFDN0I7SUFDRjtJQUVBL0MsSUFBSXNELFNBQVMsQ0FBQyxTQUFTO0lBQ3ZCdEQsSUFBSVEsTUFBTSxDQUFDLEtBQUsrQyxHQUFHLENBQUM7QUFDdEIiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jcm0tYWdlbnQtd2ViLy4vcGFnZXMvYXBpL2xlYWRzL2NvbW11bmljYXRpb25zLnRzPzlmOGIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBOZXh0QXBpUmVxdWVzdCwgTmV4dEFwaVJlc3BvbnNlIH0gZnJvbSBcIm5leHRcIjtcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gXCJAc3VwYWJhc2Uvc3VwYWJhc2UtanNcIjtcblxuZnVuY3Rpb24gcmVhZEVudih2YWx1ZTogdW5rbm93bikge1xuICBjb25zdCByYXcgPSB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gU3RyaW5nKHZhbHVlKS50cmltKCkgOiBcIlwiO1xuICBpZiAoIXJhdykge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHJldHVybiByYXcucmVwbGFjZSgvXlsnXCJgXS8sIFwiXCIpLnJlcGxhY2UoL1snXCJgXSQvLCBcIlwiKS50cmltKCk7XG59XG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcmVhZEVudihwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwpO1xuY29uc3Qgc3VwYWJhc2VLZXkgPSByZWFkRW52KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX0tFWVxuKTtcblxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoc3VwYWJhc2VVcmwsIHN1cGFiYXNlS2V5IHx8IFwiXCIpO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKFxuICByZXE6IE5leHRBcGlSZXF1ZXN0LFxuICByZXM6IE5leHRBcGlSZXNwb25zZVxuKSB7XG4gIGNvbnN0IGV4cGVjdGVkVG9rZW4gPSBwcm9jZXNzLmVudi5DUk1fQVBJX1RPS0VOO1xuICBjb25zdCBoZWFkZXJUb2tlbiA9IHJlcS5oZWFkZXJzW1wieC1jcm0tdG9rZW5cIl07XG4gIGNvbnN0IHRva2VuID0gQXJyYXkuaXNBcnJheShoZWFkZXJUb2tlbikgPyBoZWFkZXJUb2tlblswXSA6IGhlYWRlclRva2VuO1xuICBpZiAoZXhwZWN0ZWRUb2tlbiAmJiB0b2tlbiAhPT0gZXhwZWN0ZWRUb2tlbikge1xuICAgIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgZXJyb3I6IFwiVW5hdXRob3JpemVkXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VLZXkpIHtcbiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBcIlN1cGFiYXNl6YWN572u57y65aSxXCIgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgY29uc3QgeyBsZWFkSWQgfSA9IHJlcS5xdWVyeTtcblxuICBpZiAoIWxlYWRJZCB8fCB0eXBlb2YgbGVhZElkICE9PSBcInN0cmluZ1wiKSB7XG4gICAgcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogXCLnvLrlsJFsZWFkSWRcIiB9KTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAocmVxLm1ldGhvZCA9PT0gXCJHRVRcIikge1xuICAgIGNvbnN0IGxlYWRJZHM6IHN0cmluZ1tdID0gW2xlYWRJZF07XG5cbiAgICBjb25zdCB7IGRhdGE6IGxlYWRSb3dzIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oXCJjdXN0b21lcl9sZWFkc1wiKVxuICAgICAgLnNlbGVjdChcImlkXCIpXG4gICAgICAuZXEoXCLnur/ntKJJRFwiLCBsZWFkSWQpXG4gICAgICAubGltaXQoMSk7XG5cbiAgICBpZiAobGVhZFJvd3MgJiYgbGVhZFJvd3MubGVuZ3RoID4gMCAmJiAobGVhZFJvd3NbMF0gYXMgYW55KS5pZCkge1xuICAgICAgY29uc3Qgcm93SWQgPSBTdHJpbmcoKGxlYWRSb3dzWzBdIGFzIGFueSkuaWQpO1xuICAgICAgaWYgKCFsZWFkSWRzLmluY2x1ZGVzKHJvd0lkKSkge1xuICAgICAgICBsZWFkSWRzLnB1c2gocm93SWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbShcImN1c3RvbWVyX2NvbW11bmljYXRpb25zXCIpXG4gICAgICAuc2VsZWN0KFwiKlwiKTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCByb3dzID0gZGF0YSB8fCBbXTtcblxuICAgIGNvbnN0IGdldFJvd0xlYWRJZCA9IChyb3c6IGFueSkgPT5cbiAgICAgIHJvdy5sZWFkX2lkID8/XG4gICAgICByb3dbXCLnur/ntKJJRFwiXSA/P1xuICAgICAgcm93W1wi5a6i5oi357q/57SiSURcIl0gPz9cbiAgICAgIHJvdy5sZWFkSWQgPz9cbiAgICAgIG51bGw7XG5cbiAgICBjb25zdCBnZXRSb3dUaW1lID0gKHJvdzogYW55KSA9PlxuICAgICAgcm93W1wi5Y+R6YCB5pe26Ze0XCJdID8/XG4gICAgICByb3cuY3JlYXRlZF9hdCA/P1xuICAgICAgcm93W1wi5Yib5bu65pe26Ze0XCJdID8/XG4gICAgICByb3dbXCJjcmVhdGVkQXRcIl0gPz9cbiAgICAgIHJvd1tcIuaXtumXtFwiXSA/P1xuICAgICAgbnVsbDtcblxuICAgIGNvbnN0IGdldFJvd1JvbGUgPSAocm93OiBhbnkpID0+XG4gICAgICByb3cucm9sZSA/P1xuICAgICAgcm93W1wi6KeS6ImyXCJdID8/XG4gICAgICByb3dbXCLouqvku71cIl0gPz9cbiAgICAgIHJvd1tcIuivtOivneaWuVwiXSA/P1xuICAgICAgcm93W1wi6K+06K+d5Lq6XCJdID8/XG4gICAgICByb3dbXCLlj5HpgIHkurpcIl0gPz9cbiAgICAgIHJvd1tcIuWPkemAgeaWuVwiXSA/P1xuICAgICAgcm93W1wic2VuZGVyXCJdID8/XG4gICAgICByb3dbXCJhdXRob3JcIl0gPz9cbiAgICAgIG51bGw7XG5cbiAgICBjb25zdCBmaWx0ZXJlZCA9IHJvd3MuZmlsdGVyKChyb3c6IGFueSkgPT4ge1xuICAgICAgY29uc3Qgcm93TGVhZElkID0gZ2V0Um93TGVhZElkKHJvdyk7XG4gICAgICBpZiAoIXJvd0xlYWRJZCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gbGVhZElkcy5pbmNsdWRlcyhTdHJpbmcocm93TGVhZElkKSk7XG4gICAgfSk7XG5cbiAgICBmaWx0ZXJlZC5zb3J0KChhOiBhbnksIGI6IGFueSkgPT4ge1xuICAgICAgY29uc3QgdGEgPSBnZXRSb3dUaW1lKGEpO1xuICAgICAgY29uc3QgdGIgPSBnZXRSb3dUaW1lKGIpO1xuICAgICAgY29uc3QgdGFOdW0gPSB0YSA/IG5ldyBEYXRlKFN0cmluZyh0YSkpLmdldFRpbWUoKSA6IDA7XG4gICAgICBjb25zdCB0Yk51bSA9IHRiID8gbmV3IERhdGUoU3RyaW5nKHRiKSkuZ2V0VGltZSgpIDogMDtcbiAgICAgIHJldHVybiB0YU51bSAtIHRiTnVtO1xuICAgIH0pO1xuXG4gICAgY29uc3QgaXRlbXMgPSBmaWx0ZXJlZC5tYXAoKHJvdzogYW55KSA9PiB7XG4gICAgICBjb25zdCByb3dMZWFkSWQgPSBnZXRSb3dMZWFkSWQocm93KTtcbiAgICAgIGNvbnN0IHJvd1RpbWUgPSBnZXRSb3dUaW1lKHJvdyk7XG4gICAgICBjb25zdCByb3dSb2xlID0gZ2V0Um93Um9sZShyb3cpO1xuICAgICAgY29uc3Qgcm93Q29udGVudCA9XG4gICAgICAgIHJvdy5jb250ZW50ID8/XG4gICAgICAgIHJvd1tcIuayn+mAmuWGheWuuVwiXSA/P1xuICAgICAgICByb3dbXCLlhoXlrrlcIl0gPz9cbiAgICAgICAgcm93W1wi5Y+R6YCB5YaF5a65XCJdID8/XG4gICAgICAgIHJvd1tcIua2iOaBr+WGheWuuVwiXSA/P1xuICAgICAgICByb3dbXCLmlofmnKxcIl0gPz9cbiAgICAgICAgbnVsbDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiByb3cuaWQgPz8gU3RyaW5nKHJvd1tcImlkXCJdKSxcbiAgICAgICAgbGVhZElkOiByb3dMZWFkSWQgPyBTdHJpbmcocm93TGVhZElkKSA6IFwiXCIsXG4gICAgICAgIHJvbGU6IHJvd1JvbGUsXG4gICAgICAgIGNvbnRlbnQ6IHJvd0NvbnRlbnQsXG4gICAgICAgIGNyZWF0ZWRBdDogcm93VGltZVxuICAgICAgfTtcbiAgICB9KTtcblxuICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgaXRlbXMgfSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgcmVzLnNldEhlYWRlcihcIkFsbG93XCIsIFwiR0VUXCIpO1xuICByZXMuc3RhdHVzKDQwNSkuZW5kKFwiTWV0aG9kIE5vdCBBbGxvd2VkXCIpO1xufVxuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInJlYWRFbnYiLCJ2YWx1ZSIsInJhdyIsInVuZGVmaW5lZCIsIlN0cmluZyIsInRyaW0iLCJyZXBsYWNlIiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VLZXkiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsIlNVUEFCQVNFX1NFUlZJQ0VfS0VZIiwic3VwYWJhc2UiLCJoYW5kbGVyIiwicmVxIiwicmVzIiwiZXhwZWN0ZWRUb2tlbiIsIkNSTV9BUElfVE9LRU4iLCJoZWFkZXJUb2tlbiIsImhlYWRlcnMiLCJ0b2tlbiIsIkFycmF5IiwiaXNBcnJheSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImxlYWRJZCIsInF1ZXJ5IiwibWV0aG9kIiwibGVhZElkcyIsImRhdGEiLCJsZWFkUm93cyIsImZyb20iLCJzZWxlY3QiLCJlcSIsImxpbWl0IiwibGVuZ3RoIiwiaWQiLCJyb3dJZCIsImluY2x1ZGVzIiwicHVzaCIsIm1lc3NhZ2UiLCJyb3dzIiwiZ2V0Um93TGVhZElkIiwicm93IiwibGVhZF9pZCIsImdldFJvd1RpbWUiLCJjcmVhdGVkX2F0IiwiZ2V0Um93Um9sZSIsInJvbGUiLCJmaWx0ZXJlZCIsImZpbHRlciIsInJvd0xlYWRJZCIsInNvcnQiLCJhIiwiYiIsInRhIiwidGIiLCJ0YU51bSIsIkRhdGUiLCJnZXRUaW1lIiwidGJOdW0iLCJpdGVtcyIsIm1hcCIsInJvd1RpbWUiLCJyb3dSb2xlIiwicm93Q29udGVudCIsImNvbnRlbnQiLCJjcmVhdGVkQXQiLCJzZXRIZWFkZXIiLCJlbmQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/leads/communications.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fleads%2Fcommunications&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cleads%5Ccommunications.ts&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();